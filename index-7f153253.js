var Cm=Object.defineProperty;var km=(n,t,e)=>t in n?Cm(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var A=(n,t,e)=>(km(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class uc extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get styles(){return`
      :host {
        
      }

      .container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
      }

      .logo-app {
        display: flex;
        gap: 8px;
      }

      .logo-app img {
        height: 32px;
      }

      .title {
        font-size: var(--st-display);
        font-variation-settings: "wght" 900;
        font-style: italic;
        margin: 0;
      }
    `}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML=`
    <style>${uc.styles}</style>
    <div class="container">
      <div class="logo-app">
        <img src="./icons/logo-vite.svg" alt="logo-vite">
        <h1 class="title">Power Monitor</h1>
      </div>
      <img src="./icons/icon-menu.svg" alt="icon-menu" class="menu">
    </div>`}}customElements.define("header-menu-bar",uc);class dc extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}handleEvent(t){if(t.type==="click"&&t.target.nodeName==="BUTTON"){this.resetButtons();const e=t.composedPath()[0];e.classList.add("active");const i=new CustomEvent("btn:range-date",{detail:{from:"range-date",message:e.classList[0]},bubbles:!0,composed:!0});this.dispatchEvent(i)}}resetButtons(){this.buttons.forEach(t=>{t.classList.remove("active")})}static get styles(){return`
      :host {
        
      }

      .container {
        display: flex;
      }

      button {
        margin: 0;
        padding: 12px 1rem;
        font-family: Inter, sans-serif;
        font-size: var(--it-h2);
        font-weight: 500;
        background: var(--bg-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 0;
      }

      .year {
        border-top-left-radius: 8px;
        border-bottom-left-radius: 8px;
      }

      .date {
        border-top-right-radius: 8px;
        border-bottom-right-radius: 8px;
      }

      .active {
        --bg-color: var(--accent-button);
        --border-color: var(--accent-button);
        --text-color: var(--text-white);
      }
    `}init(){this.container=this.shadowRoot.querySelector(".container"),this.buttons=this.shadowRoot.querySelectorAll("button"),this.container.addEventListener("click",this)}connectedCallback(){this.render(),this.init()}render(){this.shadowRoot.innerHTML=`
    <style>${dc.styles}</style>
    <div class="container">
      <button class="year">12m</button>
      <button class="month">30d</button>
      <button class="week">7d</button>
      <button class="date active">24h</button>
    </div>`}}customElements.define("range-date",dc);class fc extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}handleEvent(t){if(t.type==="click"){const e=new CustomEvent("btn:add-parameter",{detail:{from:"add-parameters",message:"active"},bubbles:!0,composed:!0});this.dispatchEvent(e)}}static get styles(){return`
      :host {
        
      }

      .add {
        font-size: var(--st-h2);
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        background: var(--accent-button);
        color: var(--text-white);
        cursor: pointer;
      }
    `}init(){this.buttonAdd=this.shadowRoot.querySelector(".add"),this.buttonAdd.addEventListener("click",this)}connectedCallback(){this.render(),this.init()}render(){this.shadowRoot.innerHTML=`
    <style>${fc.styles}</style>
    <div class="container">
      <button class="add">+ Add</button>
    </div>`}}customElements.define("add-parameters",fc);const Am={apiKey:"AIzaSyCV-VH5PUNT39c0NolUn08d8vI-pgeeDCo",authDomain:"idm144-abb.firebaseapp.com",projectId:"idm144-abb",storageBucket:"idm144-abb.appspot.com",messagingSenderId:"792421020780",appId:"1:792421020780:web:19e19311f5712f156e5449",measurementId:"G-BLV937Y7C0"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd=function(n){const t=[];let e=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Mm=function(n){const t=[];let e=0,i=0;for(;e<n.length;){const s=n[e++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[e++];t[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[e++],o=n[e++],a=n[e++],c=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(c>>10)),t[i++]=String.fromCharCode(56320+(c&1023))}else{const r=n[e++],o=n[e++];t[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return t.join("")},Ed={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,l=c?n[s+2]:0,h=r>>2,u=(r&3)<<4|a>>4;let d=(a&15)<<2|l>>6,f=l&63;c||(f=64,o||(d=64)),i.push(e[h],e[u],e[d],e[f])}return i.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Sd(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Mm(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=e[n.charAt(s++)],a=s<n.length?e[n.charAt(s)]:0;++s;const l=s<n.length?e[n.charAt(s)]:64;++s;const u=s<n.length?e[n.charAt(s)]:64;if(++s,r==null||a==null||l==null||u==null)throw Error();const d=r<<2|a>>4;if(i.push(d),l!==64){const f=a<<4&240|l>>2;if(i.push(f),u!==64){const g=l<<6&192|u;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Om=function(n){const t=Sd(n);return Ed.encodeByteArray(t,!0)},_r=function(n){return Om(n).replace(/\./g,"")},Pm=function(n){try{return Ed.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rm=()=>Lm().__FIREBASE_DEFAULTS__,Nm=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Fm=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&Pm(n[1]);return t&&JSON.parse(t)},gc=()=>{try{return Rm()||Nm()||Fm()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Vm=n=>{var t,e;return(e=(t=gc())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},Bm=n=>{const t=Vm(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]},zm=()=>{var n;return(n=gc())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Um(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},i=t||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[_r(JSON.stringify(e)),_r(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function jm(){var n;const t=(n=gc())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function qm(){return!jm()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Id(){try{return typeof indexedDB=="object"}catch{return!1}}function Hm(){return new Promise((n,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var r;t(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wm="FirebaseError";class ri extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Wm,Object.setPrototypeOf(this,ri.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Td.prototype.create)}}class Td{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],o=r?Km(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ri(s,a,i)}}function Km(n,t){return n.replace(Gm,(e,i)=>{const s=t[i];return s!=null?String(s):`<${i}?>`})}const Gm=/\{\$([^}]+)}/g;function fa(n,t){if(n===t)return!0;const e=Object.keys(n),i=Object.keys(t);for(const s of e){if(!i.includes(s))return!1;const r=n[s],o=t[s];if(Ll(r)&&Ll(o)){if(!fa(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!e.includes(s))return!1;return!0}function Ll(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n){return n&&n._delegate?n._delegate:n}class Gi{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Je="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const i=new $m;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),s=(e=t==null?void 0:t.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Xm(t))try{this.getOrInitializeService({instanceIdentifier:Je})}catch{}for(const[e,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(t=Je){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Je){return this.instances.has(t)}getOptions(t=Je){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(t,e){var i;const s=this.normalizeInstanceIdentifier(e),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(t),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&t(o,s),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const s of i)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Qm(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=Je){return this.component?this.component.multipleInstances?t:Je:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Qm(n){return n===Je?void 0:n}function Xm(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Ym(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var G;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(G||(G={}));const Zm={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},ty=G.INFO,ey={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},ny=(n,t,...e)=>{if(t<n.logLevel)return;const i=new Date().toISOString(),s=ey[t];if(s)console[s](`[${i}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Dd{constructor(t){this.name=t,this._logLevel=ty,this._logHandler=ny,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in G))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Zm[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...t),this._logHandler(this,G.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...t),this._logHandler(this,G.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,G.INFO,...t),this._logHandler(this,G.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,G.WARN,...t),this._logHandler(this,G.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...t),this._logHandler(this,G.ERROR,...t)}}const iy=(n,t)=>t.some(e=>n instanceof e);let Rl,Nl;function sy(){return Rl||(Rl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ry(){return Nl||(Nl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Cd=new WeakMap,ga=new WeakMap,kd=new WeakMap,Vo=new WeakMap,pc=new WeakMap;function oy(n){const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{e(Oe(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&Cd.set(e,n)}).catch(()=>{}),pc.set(t,n),t}function ay(n){if(ga.has(n))return;const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{e(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});ga.set(n,t)}let pa={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return ga.get(n);if(t==="objectStoreNames")return n.objectStoreNames||kd.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Oe(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function cy(n){pa=n(pa)}function ly(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=n.call(Bo(this),t,...e);return kd.set(i,t.sort?t.sort():[t]),Oe(i)}:ry().includes(n)?function(...t){return n.apply(Bo(this),t),Oe(Cd.get(this))}:function(...t){return Oe(n.apply(Bo(this),t))}}function hy(n){return typeof n=="function"?ly(n):(n instanceof IDBTransaction&&ay(n),iy(n,sy())?new Proxy(n,pa):n)}function Oe(n){if(n instanceof IDBRequest)return oy(n);if(Vo.has(n))return Vo.get(n);const t=hy(n);return t!==n&&(Vo.set(n,t),pc.set(t,n)),t}const Bo=n=>pc.get(n);function uy(n,t,{blocked:e,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(n,t),a=Oe(o);return i&&o.addEventListener("upgradeneeded",c=>{i(Oe(o.result),c.oldVersion,c.newVersion,Oe(o.transaction))}),e&&o.addEventListener("blocked",()=>e()),a.then(c=>{r&&c.addEventListener("close",()=>r()),s&&c.addEventListener("versionchange",()=>s())}).catch(()=>{}),a}const dy=["get","getKey","getAll","getAllKeys","count"],fy=["put","add","delete","clear"],zo=new Map;function Fl(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(zo.get(t))return zo.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,s=fy.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||dy.includes(e)))return;const r=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let l=c.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[e](...a),s&&c.done]))[0]};return zo.set(t,r),r}cy(n=>({...n,get:(t,e,i)=>Fl(t,e)||n.get(t,e,i),has:(t,e)=>!!Fl(t,e)||n.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gy{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(py(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function py(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const ma="@firebase/app",Vl="0.9.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gn=new Dd("@firebase/app"),my="@firebase/app-compat",yy="@firebase/analytics-compat",by="@firebase/analytics",vy="@firebase/app-check-compat",xy="@firebase/app-check",wy="@firebase/auth",_y="@firebase/auth-compat",Sy="@firebase/database",Ey="@firebase/database-compat",Iy="@firebase/functions",Ty="@firebase/functions-compat",Dy="@firebase/installations",Cy="@firebase/installations-compat",ky="@firebase/messaging",Ay="@firebase/messaging-compat",My="@firebase/performance",Oy="@firebase/performance-compat",Py="@firebase/remote-config",Ly="@firebase/remote-config-compat",Ry="@firebase/storage",Ny="@firebase/storage-compat",Fy="@firebase/firestore",Vy="@firebase/firestore-compat",By="firebase",zy="9.16.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ya="[DEFAULT]",$y={[ma]:"fire-core",[my]:"fire-core-compat",[by]:"fire-analytics",[yy]:"fire-analytics-compat",[xy]:"fire-app-check",[vy]:"fire-app-check-compat",[wy]:"fire-auth",[_y]:"fire-auth-compat",[Sy]:"fire-rtdb",[Ey]:"fire-rtdb-compat",[Iy]:"fire-fn",[Ty]:"fire-fn-compat",[Dy]:"fire-iid",[Cy]:"fire-iid-compat",[ky]:"fire-fcm",[Ay]:"fire-fcm-compat",[My]:"fire-perf",[Oy]:"fire-perf-compat",[Py]:"fire-rc",[Ly]:"fire-rc-compat",[Ry]:"fire-gcs",[Ny]:"fire-gcs-compat",[Fy]:"fire-fst",[Vy]:"fire-fst-compat","fire-js":"fire-js",[By]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sr=new Map,ba=new Map;function Uy(n,t){try{n.container.addComponent(t)}catch(e){gn.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function Er(n){const t=n.name;if(ba.has(t))return gn.debug(`There were multiple attempts to register component ${t}.`),!1;ba.set(t,n);for(const e of Sr.values())Uy(e,n);return!0}function jy(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Pe=new Td("app","Firebase",qy);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Gi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Pe.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=zy;function Ad(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const i=Object.assign({name:ya,automaticDataCollectionEnabled:!1},t),s=i.name;if(typeof s!="string"||!s)throw Pe.create("bad-app-name",{appName:String(s)});if(e||(e=zm()),!e)throw Pe.create("no-options");const r=Sr.get(s);if(r){if(fa(e,r.options)&&fa(i,r.config))return r;throw Pe.create("duplicate-app",{appName:s})}const o=new Jm(s);for(const c of ba.values())o.addComponent(c);const a=new Hy(e,i,o);return Sr.set(s,a),a}function Ky(n=ya){const t=Sr.get(n);if(!t&&n===ya)return Ad();if(!t)throw Pe.create("no-app",{appName:n});return t}function zn(n,t,e){var i;let s=(i=$y[n])!==null&&i!==void 0?i:n;e&&(s+=`-${e}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${t}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),gn.warn(a.join(" "));return}Er(new Gi(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy="firebase-heartbeat-database",Yy=1,Yi="firebase-heartbeat-store";let $o=null;function Md(){return $o||($o=uy(Gy,Yy,{upgrade:(n,t)=>{switch(t){case 0:n.createObjectStore(Yi)}}}).catch(n=>{throw Pe.create("idb-open",{originalErrorMessage:n.message})})),$o}async function Qy(n){try{return(await Md()).transaction(Yi).objectStore(Yi).get(Od(n))}catch(t){if(t instanceof ri)gn.warn(t.message);else{const e=Pe.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});gn.warn(e.message)}}}async function Bl(n,t){try{const i=(await Md()).transaction(Yi,"readwrite");return await i.objectStore(Yi).put(t,Od(n)),i.done}catch(e){if(e instanceof ri)gn.warn(e.message);else{const i=Pe.create("idb-set",{originalErrorMessage:e==null?void 0:e.message});gn.warn(i.message)}}}function Od(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy=1024,Jy=30*24*60*60*1e3;class Zy{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new eb(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=zl();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(s=>{const r=new Date(s.date).valueOf();return Date.now()-r<=Jy}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const t=zl(),{heartbeatsToSend:e,unsentEntries:i}=tb(this._heartbeatsCache.heartbeats),s=_r(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function zl(){return new Date().toISOString().substring(0,10)}function tb(n,t=Xy){const e=[];let i=n.slice();for(const s of n){const r=e.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),$l(e)>t){r.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),$l(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class eb{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Id()?Hm().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Qy(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const s=await this.read();return Bl(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const s=await this.read();return Bl(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function $l(n){return _r(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nb(n){Er(new Gi("platform-logger",t=>new gy(t),"PRIVATE")),Er(new Gi("heartbeat",t=>new Zy(t),"PRIVATE")),zn(ma,Vl,n),zn(ma,Vl,"esm2017"),zn("fire-js","")}nb("");var ib="firebase",sb="9.16.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zn(ib,sb,"app");var rb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},O,mc=mc||{},N=rb||self;function Ir(){}function Zr(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function bs(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function ob(n){return Object.prototype.hasOwnProperty.call(n,Uo)&&n[Uo]||(n[Uo]=++ab)}var Uo="closure_uid_"+(1e9*Math.random()>>>0),ab=0;function cb(n,t,e){return n.call.apply(n.bind,arguments)}function lb(n,t,e){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,i),n.apply(t,s)}}return function(){return n.apply(t,arguments)}}function Mt(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Mt=cb:Mt=lb,Mt.apply(null,arguments)}function Vs(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var i=e.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Dt(n,t){function e(){}e.prototype=t.prototype,n.X=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.Wb=function(i,s,r){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[s].apply(i,o)}}function Ue(){this.s=this.s,this.o=this.o}var hb=0;Ue.prototype.s=!1;Ue.prototype.na=function(){!this.s&&(this.s=!0,this.M(),hb!=0)&&ob(this)};Ue.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Pd=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function yc(n){const t=n.length;if(0<t){const e=Array(t);for(let i=0;i<t;i++)e[i]=n[i];return e}return[]}function Ul(n,t){for(let e=1;e<arguments.length;e++){const i=arguments[e];if(Zr(i)){const s=n.length||0,r=i.length||0;n.length=s+r;for(let o=0;o<r;o++)n[s+o]=i[o]}else n.push(i)}}function Ot(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}Ot.prototype.h=function(){this.defaultPrevented=!0};var ub=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{N.addEventListener("test",Ir,t),N.removeEventListener("test",Ir,t)}catch{}return n}();function Tr(n){return/^[\s\xa0]*$/.test(n)}var jl=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function jo(n,t){return n<t?-1:n>t?1:0}function to(){var n=N.navigator;return n&&(n=n.userAgent)?n:""}function oe(n){return to().indexOf(n)!=-1}function bc(n){return bc[" "](n),n}bc[" "]=Ir;function db(n){var t=pb;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=n(9)}var fb=oe("Opera"),Hn=oe("Trident")||oe("MSIE"),Ld=oe("Edge"),va=Ld||Hn,Rd=oe("Gecko")&&!(to().toLowerCase().indexOf("webkit")!=-1&&!oe("Edge"))&&!(oe("Trident")||oe("MSIE"))&&!oe("Edge"),gb=to().toLowerCase().indexOf("webkit")!=-1&&!oe("Edge");function Nd(){var n=N.document;return n?n.documentMode:void 0}var Dr;t:{var qo="",Ho=function(){var n=to();if(Rd)return/rv:([^\);]+)(\)|;)/.exec(n);if(Ld)return/Edge\/([\d\.]+)/.exec(n);if(Hn)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(gb)return/WebKit\/(\S+)/.exec(n);if(fb)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(Ho&&(qo=Ho?Ho[1]:""),Hn){var Wo=Nd();if(Wo!=null&&Wo>parseFloat(qo)){Dr=String(Wo);break t}}Dr=qo}var pb={};function mb(){return db(function(){let n=0;const t=jl(String(Dr)).split("."),e=jl("9").split("."),i=Math.max(t.length,e.length);for(let o=0;n==0&&o<i;o++){var s=t[o]||"",r=e[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s[0].length==0&&r[0].length==0)break;n=jo(s[1].length==0?0:parseInt(s[1],10),r[1].length==0?0:parseInt(r[1],10))||jo(s[2].length==0,r[2].length==0)||jo(s[2],r[2]),s=s[3],r=r[3]}while(n==0)}return 0<=n})}var xa;if(N.document&&Hn){var ql=Nd();xa=ql||parseInt(Dr,10)||void 0}else xa=void 0;var yb=xa;function Qi(n,t){if(Ot.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(Rd){t:{try{bc(t.nodeName);var s=!0;break t}catch{}s=!1}s||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:bb[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Qi.X.h.call(this)}}Dt(Qi,Ot);var bb={2:"touch",3:"pen",4:"mouse"};Qi.prototype.h=function(){Qi.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var vs="closure_listenable_"+(1e6*Math.random()|0),vb=0;function xb(n,t,e,i,s){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!i,this.ha=s,this.key=++vb,this.ba=this.ea=!1}function eo(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function vc(n,t,e){for(const i in n)t.call(e,n[i],i,n)}function Fd(n){const t={};for(const e in n)t[e]=n[e];return t}const Hl="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Vd(n,t){let e,i;for(let s=1;s<arguments.length;s++){i=arguments[s];for(e in i)n[e]=i[e];for(let r=0;r<Hl.length;r++)e=Hl[r],Object.prototype.hasOwnProperty.call(i,e)&&(n[e]=i[e])}}function no(n){this.src=n,this.g={},this.h=0}no.prototype.add=function(n,t,e,i,s){var r=n.toString();n=this.g[r],n||(n=this.g[r]=[],this.h++);var o=_a(n,t,i,s);return-1<o?(t=n[o],e||(t.ea=!1)):(t=new xb(t,this.src,r,!!i,s),t.ea=e,n.push(t)),t};function wa(n,t){var e=t.type;if(e in n.g){var i=n.g[e],s=Pd(i,t),r;(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(eo(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function _a(n,t,e,i){for(var s=0;s<n.length;++s){var r=n[s];if(!r.ba&&r.listener==t&&r.capture==!!e&&r.ha==i)return s}return-1}var xc="closure_lm_"+(1e6*Math.random()|0),Ko={};function Bd(n,t,e,i,s){if(i&&i.once)return $d(n,t,e,i,s);if(Array.isArray(t)){for(var r=0;r<t.length;r++)Bd(n,t[r],e,i,s);return null}return e=Sc(e),n&&n[vs]?n.N(t,e,bs(i)?!!i.capture:!!i,s):zd(n,t,e,!1,i,s)}function zd(n,t,e,i,s,r){if(!t)throw Error("Invalid event type");var o=bs(s)?!!s.capture:!!s,a=_c(n);if(a||(n[xc]=a=new no(n)),e=a.add(t,e,i,o,r),e.proxy)return e;if(i=wb(),e.proxy=i,i.src=n,i.listener=e,n.addEventListener)ub||(s=o),s===void 0&&(s=!1),n.addEventListener(t.toString(),i,s);else if(n.attachEvent)n.attachEvent(jd(t.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return e}function wb(){function n(e){return t.call(n.src,n.listener,e)}const t=_b;return n}function $d(n,t,e,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++)$d(n,t[r],e,i,s);return null}return e=Sc(e),n&&n[vs]?n.O(t,e,bs(i)?!!i.capture:!!i,s):zd(n,t,e,!0,i,s)}function Ud(n,t,e,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)Ud(n,t[r],e,i,s);else i=bs(i)?!!i.capture:!!i,e=Sc(e),n&&n[vs]?(n=n.i,t=String(t).toString(),t in n.g&&(r=n.g[t],e=_a(r,e,i,s),-1<e&&(eo(r[e]),Array.prototype.splice.call(r,e,1),r.length==0&&(delete n.g[t],n.h--)))):n&&(n=_c(n))&&(t=n.g[t.toString()],n=-1,t&&(n=_a(t,e,i,s)),(e=-1<n?t[n]:null)&&wc(e))}function wc(n){if(typeof n!="number"&&n&&!n.ba){var t=n.src;if(t&&t[vs])wa(t.i,n);else{var e=n.type,i=n.proxy;t.removeEventListener?t.removeEventListener(e,i,n.capture):t.detachEvent?t.detachEvent(jd(e),i):t.addListener&&t.removeListener&&t.removeListener(i),(e=_c(t))?(wa(e,n),e.h==0&&(e.src=null,t[xc]=null)):eo(n)}}}function jd(n){return n in Ko?Ko[n]:Ko[n]="on"+n}function _b(n,t){if(n.ba)n=!0;else{t=new Qi(t,this);var e=n.listener,i=n.ha||n.src;n.ea&&wc(n),n=e.call(i,t)}return n}function _c(n){return n=n[xc],n instanceof no?n:null}var Go="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sc(n){return typeof n=="function"?n:(n[Go]||(n[Go]=function(t){return n.handleEvent(t)}),n[Go])}function xt(){Ue.call(this),this.i=new no(this),this.P=this,this.I=null}Dt(xt,Ue);xt.prototype[vs]=!0;xt.prototype.removeEventListener=function(n,t,e,i){Ud(this,n,t,e,i)};function It(n,t){var e,i=n.I;if(i)for(e=[];i;i=i.I)e.push(i);if(n=n.P,i=t.type||t,typeof t=="string")t=new Ot(t,n);else if(t instanceof Ot)t.target=t.target||n;else{var s=t;t=new Ot(i,n),Vd(t,s)}if(s=!0,e)for(var r=e.length-1;0<=r;r--){var o=t.g=e[r];s=Bs(o,i,!0,t)&&s}if(o=t.g=n,s=Bs(o,i,!0,t)&&s,s=Bs(o,i,!1,t)&&s,e)for(r=0;r<e.length;r++)o=t.g=e[r],s=Bs(o,i,!1,t)&&s}xt.prototype.M=function(){if(xt.X.M.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],i=0;i<e.length;i++)eo(e[i]);delete n.g[t],n.h--}}this.I=null};xt.prototype.N=function(n,t,e,i){return this.i.add(String(n),t,!1,e,i)};xt.prototype.O=function(n,t,e,i){return this.i.add(String(n),t,!0,e,i)};function Bs(n,t,e,i){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var s=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.ba&&o.capture==e){var a=o.listener,c=o.ha||o.src;o.ea&&wa(n.i,o),s=a.call(c,i)!==!1&&s}}return s&&!i.defaultPrevented}var Ec=N.JSON.stringify;function Sb(){var n=Wd;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}class Eb{constructor(){this.h=this.g=null}add(t,e){const i=qd.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}}var qd=new class{constructor(n,t){this.i=n,this.j=t,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new Ib,n=>n.reset());class Ib{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Tb(n){N.setTimeout(()=>{throw n},0)}function Hd(n,t){Sa||Db(),Ea||(Sa(),Ea=!0),Wd.add(n,t)}var Sa;function Db(){var n=N.Promise.resolve(void 0);Sa=function(){n.then(Cb)}}var Ea=!1,Wd=new Eb;function Cb(){for(var n;n=Sb();){try{n.h.call(n.g)}catch(e){Tb(e)}var t=qd;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}Ea=!1}function io(n,t){xt.call(this),this.h=n||1,this.g=t||N,this.j=Mt(this.lb,this),this.l=Date.now()}Dt(io,xt);O=io.prototype;O.ca=!1;O.R=null;O.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),It(this,"tick"),this.ca&&(Ic(this),this.start()))}};O.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ic(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}O.M=function(){io.X.M.call(this),Ic(this),delete this.g};function Tc(n,t,e){if(typeof n=="function")e&&(n=Mt(n,e));else if(n&&typeof n.handleEvent=="function")n=Mt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:N.setTimeout(n,t||0)}function Kd(n){n.g=Tc(()=>{n.g=null,n.i&&(n.i=!1,Kd(n))},n.j);const t=n.h;n.h=null,n.m.apply(null,t)}class kb extends Ue{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Kd(this)}M(){super.M(),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xi(n){Ue.call(this),this.h=n,this.g={}}Dt(Xi,Ue);var Wl=[];function Gd(n,t,e,i){Array.isArray(e)||(e&&(Wl[0]=e.toString()),e=Wl);for(var s=0;s<e.length;s++){var r=Bd(t,e[s],i||n.handleEvent,!1,n.h||n);if(!r)break;n.g[r.key]=r}}function Yd(n){vc(n.g,function(t,e){this.g.hasOwnProperty(e)&&wc(t)},n),n.g={}}Xi.prototype.M=function(){Xi.X.M.call(this),Yd(this)};Xi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function so(){this.g=!0}so.prototype.Aa=function(){this.g=!1};function Ab(n,t,e,i,s,r){n.info(function(){if(n.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var h=l[0];l=l[1];var u=h.split("_");o=2<=u.length&&u[1]=="type"?o+(h+"="+l+"&"):o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+`
`+e+`
`+o})}function Mb(n,t,e,i,s,r,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+`
`+e+`
`+r+" "+o})}function Bn(n,t,e,i){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+Pb(n,e)+(i?" "+i:"")})}function Ob(n,t){n.info(function(){return"TIMEOUT: "+t})}so.prototype.info=function(){};function Pb(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var i=e[n];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if(r!="noop"&&r!="stop"&&r!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return Ec(e)}catch{return t}}var In={},Kl=null;function ro(){return Kl=Kl||new xt}In.Pa="serverreachability";function Qd(n){Ot.call(this,In.Pa,n)}Dt(Qd,Ot);function Ji(n){const t=ro();It(t,new Qd(t))}In.STAT_EVENT="statevent";function Xd(n,t){Ot.call(this,In.STAT_EVENT,n),this.stat=t}Dt(Xd,Ot);function Rt(n){const t=ro();It(t,new Xd(t,n))}In.Qa="timingevent";function Jd(n,t){Ot.call(this,In.Qa,n),this.size=t}Dt(Jd,Ot);function xs(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){n()},t)}var oo={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Zd={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Dc(){}Dc.prototype.h=null;function Gl(n){return n.h||(n.h=n.i())}function tf(){}var ws={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Cc(){Ot.call(this,"d")}Dt(Cc,Ot);function kc(){Ot.call(this,"c")}Dt(kc,Ot);var Ia;function ao(){}Dt(ao,Dc);ao.prototype.g=function(){return new XMLHttpRequest};ao.prototype.i=function(){return{}};Ia=new ao;function _s(n,t,e,i){this.l=n,this.j=t,this.m=e,this.U=i||1,this.S=new Xi(this),this.O=Lb,n=va?125:void 0,this.T=new io(n),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new ef}function ef(){this.i=null,this.g="",this.h=!1}var Lb=45e3,Ta={},Cr={};O=_s.prototype;O.setTimeout=function(n){this.O=n};function Da(n,t,e){n.K=1,n.v=lo(Se(t)),n.s=e,n.P=!0,nf(n,null)}function nf(n,t){n.F=Date.now(),Ss(n),n.A=Se(n.v);var e=n.A,i=n.U;Array.isArray(i)||(i=[String(i)]),uf(e.i,"t",i),n.C=0,e=n.l.H,n.h=new ef,n.g=Of(n.l,e?t:null,!n.s),0<n.N&&(n.L=new kb(Mt(n.La,n,n.g),n.N)),Gd(n.S,n.g,"readystatechange",n.ib),t=n.H?Fd(n.H):{},n.s?(n.u||(n.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,t)):(n.u="GET",n.g.da(n.A,n.u,null,t)),Ji(),Ab(n.j,n.u,n.A,n.m,n.U,n.s)}O.ib=function(n){n=n.target;const t=this.L;t&&ye(n)==3?t.l():this.La(n)};O.La=function(n){try{if(n==this.g)t:{const h=ye(this.g);var t=this.g.Ea();const u=this.g.aa();if(!(3>h)&&(h!=3||va||this.g&&(this.h.h||this.g.fa()||Jl(this.g)))){this.I||h!=4||t==7||(t==8||0>=u?Ji(3):Ji(2)),co(this);var e=this.g.aa();this.Y=e;e:if(sf(this)){var i=Jl(this.g);n="";var s=i.length,r=ye(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),Fi(this);var o="";break e}this.h.i=new N.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,n+=this.h.i.decode(i[t],{stream:r&&t==s-1});i.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=e==200,Mb(this.j,this.u,this.A,this.m,this.U,h,e),this.i){if(this.Z&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Tr(a)){var l=a;break e}}l=null}if(e=l)Bn(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ca(this,e);else{this.i=!1,this.o=3,Rt(12),an(this),Fi(this);break t}}this.P?(rf(this,h,o),va&&this.i&&h==3&&(Gd(this.S,this.T,"tick",this.hb),this.T.start())):(Bn(this.j,this.m,o,null),Ca(this,o)),h==4&&an(this),this.i&&!this.I&&(h==4?Cf(this.l,this):(this.i=!1,Ss(this)))}else e==400&&0<o.indexOf("Unknown SID")?(this.o=3,Rt(12)):(this.o=0,Rt(13)),an(this),Fi(this)}}}catch{}finally{}};function sf(n){return n.g?n.u=="GET"&&n.K!=2&&n.l.Da:!1}function rf(n,t,e){let i=!0,s;for(;!n.I&&n.C<e.length;)if(s=Rb(n,e),s==Cr){t==4&&(n.o=4,Rt(14),i=!1),Bn(n.j,n.m,null,"[Incomplete Response]");break}else if(s==Ta){n.o=4,Rt(15),Bn(n.j,n.m,e,"[Invalid Chunk]"),i=!1;break}else Bn(n.j,n.m,s,null),Ca(n,s);sf(n)&&s!=Cr&&s!=Ta&&(n.h.g="",n.C=0),t!=4||e.length!=0||n.h.h||(n.o=1,Rt(16),i=!1),n.i=n.i&&i,i?0<e.length&&!n.$&&(n.$=!0,t=n.l,t.g==n&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+e.length),Nc(t),t.K=!0,Rt(11))):(Bn(n.j,n.m,e,"[Invalid Chunked Response]"),an(n),Fi(n))}O.hb=function(){if(this.g){var n=ye(this.g),t=this.g.fa();this.C<t.length&&(co(this),rf(this,n,t),this.i&&n!=4&&Ss(this))}};function Rb(n,t){var e=n.C,i=t.indexOf(`
`,e);return i==-1?Cr:(e=Number(t.substring(e,i)),isNaN(e)?Ta:(i+=1,i+e>t.length?Cr:(t=t.substr(i,e),n.C=i+e,t)))}O.cancel=function(){this.I=!0,an(this)};function Ss(n){n.V=Date.now()+n.O,of(n,n.O)}function of(n,t){if(n.B!=null)throw Error("WatchDog timer not null");n.B=xs(Mt(n.gb,n),t)}function co(n){n.B&&(N.clearTimeout(n.B),n.B=null)}O.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(Ob(this.j,this.A),this.K!=2&&(Ji(),Rt(17)),an(this),this.o=2,Fi(this)):of(this,this.V-n)};function Fi(n){n.l.G==0||n.I||Cf(n.l,n)}function an(n){co(n);var t=n.L;t&&typeof t.na=="function"&&t.na(),n.L=null,Ic(n.T),Yd(n.S),n.g&&(t=n.g,n.g=null,t.abort(),t.na())}function Ca(n,t){try{var e=n.l;if(e.G!=0&&(e.g==n||ka(e.h,n))){if(!n.J&&ka(e.h,n)&&e.G==3){try{var i=e.Fa.g.parse(t)}catch{i=null}if(Array.isArray(i)&&i.length==3){var s=i;if(s[0]==0){t:if(!e.u){if(e.g)if(e.g.F+3e3<n.F)Mr(e),fo(e);else break t;Rc(e),Rt(18)}}else e.Ba=s[1],0<e.Ba-e.T&&37500>s[2]&&e.L&&e.A==0&&!e.v&&(e.v=xs(Mt(e.cb,e),6e3));if(1>=gf(e.h)&&e.ja){try{e.ja()}catch{}e.ja=void 0}}else cn(e,11)}else if((n.J||e.g==n)&&Mr(e),!Tr(t))for(s=e.Fa.g.parse(t),t=0;t<s.length;t++){let l=s[t];if(e.T=l[0],l=l[1],e.G==2)if(l[0]=="c"){e.I=l[1],e.ka=l[2];const h=l[3];h!=null&&(e.ma=h,e.j.info("VER="+e.ma));const u=l[4];u!=null&&(e.Ca=u,e.j.info("SVER="+e.Ca));const d=l[5];d!=null&&typeof d=="number"&&0<d&&(i=1.5*d,e.J=i,e.j.info("backChannelRequestTimeoutMs_="+i)),i=e;const f=n.g;if(f){const g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(g){var r=i.h;r.g||g.indexOf("spdy")==-1&&g.indexOf("quic")==-1&&g.indexOf("h2")==-1||(r.j=r.l,r.g=new Set,r.h&&(Ac(r,r.h),r.h=null))}if(i.D){const p=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;p&&(i.za=p,st(i.F,i.D,p))}}e.G=3,e.l&&e.l.xa(),e.$&&(e.P=Date.now()-n.F,e.j.info("Handshake RTT: "+e.P+"ms")),i=e;var o=n;if(i.sa=Mf(i,i.H?i.ka:null,i.V),o.J){pf(i.h,o);var a=o,c=i.J;c&&a.setTimeout(c),a.B&&(co(a),Ss(a)),i.g=o}else Tf(i);0<e.i.length&&go(e)}else l[0]!="stop"&&l[0]!="close"||cn(e,7);else e.G==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?cn(e,7):Lc(e):l[0]!="noop"&&e.l&&e.l.wa(l),e.A=0)}}Ji(4)}catch{}}function Nb(n){if(n.W&&typeof n.W=="function")return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Zr(n)){for(var t=[],e=n.length,i=0;i<e;i++)t.push(n[i]);return t}t=[],e=0;for(i in n)t[e++]=n[i];return t}function Fb(n){if(n.oa&&typeof n.oa=="function")return n.oa();if(!n.W||typeof n.W!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Zr(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(const i in n)t[e++]=i;return t}}}function af(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(Zr(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=Fb(n),i=Nb(n),s=i.length,r=0;r<s;r++)t.call(void 0,i[r],e&&e[r],n)}var cf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Vb(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var i=n[e].indexOf("="),s=null;if(0<=i){var r=n[e].substring(0,i);s=n[e].substring(i+1)}else r=n[e];t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function hn(n,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof hn){this.h=t!==void 0?t:n.h,kr(this,n.j),this.s=n.s,this.g=n.g,Ar(this,n.m),this.l=n.l,t=n.i;var e=new Zi;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),Yl(this,e),this.o=n.o}else n&&(e=String(n).match(cf))?(this.h=!!t,kr(this,e[1]||"",!0),this.s=Di(e[2]||""),this.g=Di(e[3]||"",!0),Ar(this,e[4]),this.l=Di(e[5]||"",!0),Yl(this,e[6]||"",!0),this.o=Di(e[7]||"")):(this.h=!!t,this.i=new Zi(null,this.h))}hn.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Ci(t,Ql,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(Ci(t,Ql,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(Ci(e,e.charAt(0)=="/"?$b:zb,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Ci(e,jb)),n.join("")};function Se(n){return new hn(n)}function kr(n,t,e){n.j=e?Di(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function Ar(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function Yl(n,t,e){t instanceof Zi?(n.i=t,qb(n.i,n.h)):(e||(t=Ci(t,Ub)),n.i=new Zi(t,n.h))}function st(n,t,e){n.i.set(t,e)}function lo(n){return st(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Di(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ci(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,Bb),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Bb(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Ql=/[#\/\?@]/g,zb=/[#\?:]/g,$b=/[#\?]/g,Ub=/[#\?@]/g,jb=/#/g;function Zi(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function je(n){n.g||(n.g=new Map,n.h=0,n.i&&Vb(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}O=Zi.prototype;O.add=function(n,t){je(this),this.i=null,n=oi(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function lf(n,t){je(n),t=oi(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function hf(n,t){return je(n),t=oi(n,t),n.g.has(t)}O.forEach=function(n,t){je(this),this.g.forEach(function(e,i){e.forEach(function(s){n.call(t,s,i,this)},this)},this)};O.oa=function(){je(this);const n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let i=0;i<t.length;i++){const s=n[i];for(let r=0;r<s.length;r++)e.push(t[i])}return e};O.W=function(n){je(this);let t=[];if(typeof n=="string")hf(this,n)&&(t=t.concat(this.g.get(oi(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};O.set=function(n,t){return je(this),this.i=null,n=oi(this,n),hf(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};O.get=function(n,t){return n?(n=this.W(n),0<n.length?String(n[0]):t):t};function uf(n,t,e){lf(n,t),0<e.length&&(n.i=null,n.g.set(oi(n,t),yc(e)),n.h+=e.length)}O.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var i=t[e];const r=encodeURIComponent(String(i)),o=this.W(i);for(i=0;i<o.length;i++){var s=r;o[i]!==""&&(s+="="+encodeURIComponent(String(o[i]))),n.push(s)}}return this.i=n.join("&")};function oi(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function qb(n,t){t&&!n.j&&(je(n),n.i=null,n.g.forEach(function(e,i){var s=i.toLowerCase();i!=s&&(lf(this,i),uf(this,s,e))},n)),n.j=t}var Hb=class{constructor(n,t){this.h=n,this.g=t}};function df(n){this.l=n||Wb,N.PerformanceNavigationTiming?(n=N.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(N.g&&N.g.Ga&&N.g.Ga()&&N.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Wb=10;function ff(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function gf(n){return n.h?1:n.g?n.g.size:0}function ka(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function Ac(n,t){n.g?n.g.add(t):n.h=t}function pf(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}df.prototype.cancel=function(){if(this.i=mf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function mf(n){if(n.h!=null)return n.i.concat(n.h.D);if(n.g!=null&&n.g.size!==0){let t=n.i;for(const e of n.g.values())t=t.concat(e.D);return t}return yc(n.i)}function Mc(){}Mc.prototype.stringify=function(n){return N.JSON.stringify(n,void 0)};Mc.prototype.parse=function(n){return N.JSON.parse(n,void 0)};function Kb(){this.g=new Mc}function Gb(n,t,e){const i=e||"";try{af(n,function(s,r){let o=s;bs(s)&&(o=Ec(s)),t.push(i+r+"="+encodeURIComponent(o))})}catch(s){throw t.push(i+"type="+encodeURIComponent("_badmap")),s}}function Yb(n,t){const e=new so;if(N.Image){const i=new Image;i.onload=Vs(zs,e,i,"TestLoadImage: loaded",!0,t),i.onerror=Vs(zs,e,i,"TestLoadImage: error",!1,t),i.onabort=Vs(zs,e,i,"TestLoadImage: abort",!1,t),i.ontimeout=Vs(zs,e,i,"TestLoadImage: timeout",!1,t),N.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else t(!1)}function zs(n,t,e,i,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(i)}catch{}}function Es(n){this.l=n.ac||null,this.j=n.jb||!1}Dt(Es,Dc);Es.prototype.g=function(){return new ho(this.l,this.j)};Es.prototype.i=function(n){return function(){return n}}({});function ho(n,t){xt.call(this),this.D=n,this.u=t,this.m=void 0,this.readyState=Oc,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Dt(ho,xt);var Oc=0;O=ho.prototype;O.open=function(n,t){if(this.readyState!=Oc)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,ts(this)};O.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.D||N).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))};O.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Is(this)),this.readyState=Oc};O.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ts(this)),this.g&&(this.readyState=3,ts(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof N.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;yf(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))};function yf(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}O.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?Is(this):ts(this),this.readyState==3&&yf(this)}};O.Va=function(n){this.g&&(this.response=this.responseText=n,Is(this))};O.Ua=function(n){this.g&&(this.response=n,Is(this))};O.ga=function(){this.g&&Is(this)};function Is(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ts(n)}O.setRequestHeader=function(n,t){this.v.append(n,t)};O.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};O.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function ts(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(ho.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Qb=N.JSON.parse;function ut(n){xt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=bf,this.K=this.L=!1}Dt(ut,xt);var bf="",Xb=/^https?$/i,Jb=["POST","PUT"];O=ut.prototype;O.Ka=function(n){this.L=n};O.da=function(n,t,e,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);t=t?t.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ia.g(),this.C=this.u?Gl(this.u):Gl(Ia),this.g.onreadystatechange=Mt(this.Ha,this);try{this.F=!0,this.g.open(t,String(n),!0),this.F=!1}catch(r){Xl(this,r);return}if(n=e||"",e=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)e.set(s,i[s]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(const r of i.keys())e.set(r,i.get(r));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(e.keys()).find(r=>r.toLowerCase()=="content-type"),s=N.FormData&&n instanceof N.FormData,!(0<=Pd(Jb,t))||i||s||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,o]of e)this.g.setRequestHeader(r,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{wf(this),0<this.B&&((this.K=Zb(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Mt(this.qa,this)):this.A=Tc(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(r){Xl(this,r)}};function Zb(n){return Hn&&mb()&&typeof n.timeout=="number"&&n.ontimeout!==void 0}O.qa=function(){typeof mc<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,It(this,"timeout"),this.abort(8))};function Xl(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,vf(n),uo(n)}function vf(n){n.D||(n.D=!0,It(n,"complete"),It(n,"error"))}O.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,It(this,"complete"),It(this,"abort"),uo(this))};O.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),uo(this,!0)),ut.X.M.call(this)};O.Ha=function(){this.s||(this.F||this.v||this.l?xf(this):this.fb())};O.fb=function(){xf(this)};function xf(n){if(n.h&&typeof mc<"u"&&(!n.C[1]||ye(n)!=4||n.aa()!=2)){if(n.v&&ye(n)==4)Tc(n.Ha,0,n);else if(It(n,"readystatechange"),ye(n)==4){n.h=!1;try{const a=n.aa();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var i;if(i=a===0){var s=String(n.H).match(cf)[1]||null;if(!s&&N.self&&N.self.location){var r=N.self.location.protocol;s=r.substr(0,r.length-1)}i=!Xb.test(s?s.toLowerCase():"")}e=i}if(e)It(n,"complete"),It(n,"success");else{n.m=6;try{var o=2<ye(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.aa()+"]",vf(n)}}finally{uo(n)}}}}function uo(n,t){if(n.g){wf(n);const e=n.g,i=n.C[0]?Ir:null;n.g=null,n.C=null,t||It(n,"ready");try{e.onreadystatechange=i}catch{}}}function wf(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(N.clearTimeout(n.A),n.A=null)}function ye(n){return n.g?n.g.readyState:0}O.aa=function(){try{return 2<ye(this)?this.g.status:-1}catch{return-1}};O.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};O.Sa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),Qb(t)}};function Jl(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case bf:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}O.Ea=function(){return this.m};O.Oa=function(){return typeof this.j=="string"?this.j:String(this.j)};function _f(n){let t="";return vc(n,function(e,i){t+=i,t+=":",t+=e,t+=`\r
`}),t}function Pc(n,t,e){t:{for(i in e){var i=!1;break t}i=!0}i||(e=_f(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):st(n,t,e))}function pi(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function Sf(n){this.Ca=0,this.i=[],this.j=new so,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=pi("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=pi("baseRetryDelayMs",5e3,n),this.bb=pi("retryDelaySeedMs",1e4,n),this.$a=pi("forwardChannelMaxRetries",2,n),this.ta=pi("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new df(n&&n.concurrentRequestLimit),this.Fa=new Kb,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}O=Sf.prototype;O.ma=8;O.G=1;function Lc(n){if(Ef(n),n.G==3){var t=n.U++,e=Se(n.F);st(e,"SID",n.I),st(e,"RID",t),st(e,"TYPE","terminate"),Ts(n,e),t=new _s(n,n.j,t,void 0),t.K=2,t.v=lo(Se(e)),e=!1,N.navigator&&N.navigator.sendBeacon&&(e=N.navigator.sendBeacon(t.v.toString(),"")),!e&&N.Image&&(new Image().src=t.v,e=!0),e||(t.g=Of(t.l,null),t.g.da(t.v)),t.F=Date.now(),Ss(t)}Af(n)}function fo(n){n.g&&(Nc(n),n.g.cancel(),n.g=null)}function Ef(n){fo(n),n.u&&(N.clearTimeout(n.u),n.u=null),Mr(n),n.h.cancel(),n.m&&(typeof n.m=="number"&&N.clearTimeout(n.m),n.m=null)}function go(n){ff(n.h)||n.m||(n.m=!0,Hd(n.Ja,n),n.C=0)}function t0(n,t){return gf(n.h)>=n.h.j-(n.m?1:0)?!1:n.m?(n.i=t.D.concat(n.i),!0):n.G==1||n.G==2||n.C>=(n.Za?0:n.$a)?!1:(n.m=xs(Mt(n.Ja,n,t),kf(n,n.C)),n.C++,!0)}O.Ja=function(n){if(this.m)if(this.m=null,this.G==1){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const s=new _s(this,this.j,n,void 0);let r=this.s;if(this.S&&(r?(r=Fd(r),Vd(r,this.S)):r=this.S),this.o!==null||this.N||(s.H=r,r=null),this.O)t:{for(var t=0,e=0;e<this.i.length;e++){e:{var i=this.i[e];if("__data__"in i.g&&(i=i.g.__data__,typeof i=="string")){i=i.length;break e}i=void 0}if(i===void 0)break;if(t+=i,4096<t){t=e;break t}if(t===4096||e===this.i.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=If(this,s,t),e=Se(this.F),st(e,"RID",n),st(e,"CVER",22),this.D&&st(e,"X-HTTP-Session-Id",this.D),Ts(this,e),r&&(this.N?t="headers="+encodeURIComponent(String(_f(r)))+"&"+t:this.o&&Pc(e,this.o,r)),Ac(this.h,s),this.Ya&&st(e,"TYPE","init"),this.O?(st(e,"$req",t),st(e,"SID","null"),s.Z=!0,Da(s,e,null)):Da(s,e,t),this.G=2}}else this.G==3&&(n?Zl(this,n):this.i.length==0||ff(this.h)||Zl(this))};function Zl(n,t){var e;t?e=t.m:e=n.U++;const i=Se(n.F);st(i,"SID",n.I),st(i,"RID",e),st(i,"AID",n.T),Ts(n,i),n.o&&n.s&&Pc(i,n.o,n.s),e=new _s(n,n.j,e,n.C+1),n.o===null&&(e.H=n.s),t&&(n.i=t.D.concat(n.i)),t=If(n,e,1e3),e.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Ac(n.h,e),Da(e,i,t)}function Ts(n,t){n.ia&&vc(n.ia,function(e,i){st(t,i,e)}),n.l&&af({},function(e,i){st(t,i,e)})}function If(n,t,e){e=Math.min(n.i.length,e);var i=n.l?Mt(n.l.Ra,n.l,n):null;t:{var s=n.i;let r=-1;for(;;){const o=["count="+e];r==-1?0<e?(r=s[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let a=!0;for(let c=0;c<e;c++){let l=s[c].h;const h=s[c].g;if(l-=r,0>l)r=Math.max(0,s[c].h-100),a=!1;else try{Gb(h,o,"req"+l+"_")}catch{i&&i(h)}}if(a){i=o.join("&");break t}}}return n=n.i.splice(0,e),t.D=n,i}function Tf(n){n.g||n.u||(n.Z=1,Hd(n.Ia,n),n.A=0)}function Rc(n){return n.g||n.u||3<=n.A?!1:(n.Z++,n.u=xs(Mt(n.Ia,n),kf(n,n.A)),n.A++,!0)}O.Ia=function(){if(this.u=null,Df(this),this.$&&!(this.K||this.g==null||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=xs(Mt(this.eb,this),n)}};O.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Rt(10),fo(this),Df(this))};function Nc(n){n.B!=null&&(N.clearTimeout(n.B),n.B=null)}function Df(n){n.g=new _s(n,n.j,"rpc",n.Z),n.o===null&&(n.g.H=n.s),n.g.N=0;var t=Se(n.sa);st(t,"RID","rpc"),st(t,"SID",n.I),st(t,"CI",n.L?"0":"1"),st(t,"AID",n.T),st(t,"TYPE","xmlhttp"),Ts(n,t),n.o&&n.s&&Pc(t,n.o,n.s),n.J&&n.g.setTimeout(n.J);var e=n.g;n=n.ka,e.K=1,e.v=lo(Se(t)),e.s=null,e.P=!0,nf(e,n)}O.cb=function(){this.v!=null&&(this.v=null,fo(this),Rc(this),Rt(19))};function Mr(n){n.v!=null&&(N.clearTimeout(n.v),n.v=null)}function Cf(n,t){var e=null;if(n.g==t){Mr(n),Nc(n),n.g=null;var i=2}else if(ka(n.h,t))e=t.D,pf(n.h,t),i=1;else return;if(n.G!=0){if(n.pa=t.Y,t.i)if(i==1){e=t.s?t.s.length:0,t=Date.now()-t.F;var s=n.C;i=ro(),It(i,new Jd(i,e)),go(n)}else Tf(n);else if(s=t.o,s==3||s==0&&0<n.pa||!(i==1&&t0(n,t)||i==2&&Rc(n)))switch(e&&0<e.length&&(t=n.h,t.i=t.i.concat(e)),s){case 1:cn(n,5);break;case 4:cn(n,10);break;case 3:cn(n,6);break;default:cn(n,2)}}}function kf(n,t){let e=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(e*=2),e*t}function cn(n,t){if(n.j.info("Error code "+t),t==2){var e=null;n.l&&(e=null);var i=Mt(n.kb,n);e||(e=new hn("//www.google.com/images/cleardot.gif"),N.location&&N.location.protocol=="http"||kr(e,"https"),lo(e)),Yb(e.toString(),i)}else Rt(2);n.G=0,n.l&&n.l.va(t),Af(n),Ef(n)}O.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Rt(2)):(this.j.info("Failed to ping google.com"),Rt(1))};function Af(n){if(n.G=0,n.la=[],n.l){const t=mf(n.h);(t.length!=0||n.i.length!=0)&&(Ul(n.la,t),Ul(n.la,n.i),n.h.i.length=0,yc(n.i),n.i.length=0),n.l.ua()}}function Mf(n,t,e){var i=e instanceof hn?Se(e):new hn(e,void 0);if(i.g!="")t&&(i.g=t+"."+i.g),Ar(i,i.m);else{var s=N.location;i=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var r=new hn(null,void 0);i&&kr(r,i),t&&(r.g=t),s&&Ar(r,s),e&&(r.l=e),i=r}return e=n.D,t=n.za,e&&t&&st(i,e,t),st(i,"VER",n.ma),Ts(n,i),i}function Of(n,t,e){if(t&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return t=e&&n.Da&&!n.ra?new ut(new Es({jb:!0})):new ut(n.ra),t.Ka(n.H),t}function Pf(){}O=Pf.prototype;O.xa=function(){};O.wa=function(){};O.va=function(){};O.ua=function(){};O.Ra=function(){};function Or(){if(Hn&&!(10<=Number(yb)))throw Error("Environmental error: no available transport.")}Or.prototype.g=function(n,t){return new Ht(n,t)};function Ht(n,t){xt.call(this),this.g=new Sf(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(n?n["X-WebChannel-Client-Profile"]=t.ya:n={"X-WebChannel-Client-Profile":t.ya}),this.g.S=n,(n=t&&t.Yb)&&!Tr(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Tr(t)&&(this.g.D=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new ai(this)}Dt(Ht,xt);Ht.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,t=this.l,e=this.h||void 0;Rt(0),n.V=t,n.ia=e||{},n.L=n.Y,n.F=Mf(n,null,n.V),go(n)};Ht.prototype.close=function(){Lc(this.g)};Ht.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=Ec(n),n=e);t.i.push(new Hb(t.ab++,n)),t.G==3&&go(t)};Ht.prototype.M=function(){this.g.l=null,delete this.j,Lc(this.g),delete this.g,Ht.X.M.call(this)};function Lf(n){Cc.call(this);var t=n.__sm__;if(t){t:{for(const e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}Dt(Lf,Cc);function Rf(){kc.call(this),this.status=1}Dt(Rf,kc);function ai(n){this.g=n}Dt(ai,Pf);ai.prototype.xa=function(){It(this.g,"a")};ai.prototype.wa=function(n){It(this.g,new Lf(n))};ai.prototype.va=function(n){It(this.g,new Rf)};ai.prototype.ua=function(){It(this.g,"b")};Or.prototype.createWebChannel=Or.prototype.g;Ht.prototype.send=Ht.prototype.u;Ht.prototype.open=Ht.prototype.m;Ht.prototype.close=Ht.prototype.close;oo.NO_ERROR=0;oo.TIMEOUT=8;oo.HTTP_ERROR=6;Zd.COMPLETE="complete";tf.EventType=ws;ws.OPEN="a";ws.CLOSE="b";ws.ERROR="c";ws.MESSAGE="d";xt.prototype.listen=xt.prototype.N;ut.prototype.listenOnce=ut.prototype.O;ut.prototype.getLastError=ut.prototype.Oa;ut.prototype.getLastErrorCode=ut.prototype.Ea;ut.prototype.getStatus=ut.prototype.aa;ut.prototype.getResponseJson=ut.prototype.Sa;ut.prototype.getResponseText=ut.prototype.fa;ut.prototype.send=ut.prototype.da;ut.prototype.setWithCredentials=ut.prototype.Ka;var e0=function(){return new Or},n0=function(){return ro()},Yo=oo,i0=Zd,s0=In,th={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},r0=Es,$s=tf,o0=ut;const eh="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}St.UNAUTHENTICATED=new St(null),St.GOOGLE_CREDENTIALS=new St("google-credentials-uid"),St.FIRST_PARTY=new St("first-party-uid"),St.MOCK_USER=new St("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ci="9.16.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pn=new Dd("@firebase/firestore");function Aa(){return pn.logLevel}function T(n,...t){if(pn.logLevel<=G.DEBUG){const e=t.map(Fc);pn.debug(`Firestore (${ci}): ${n}`,...e)}}function Lt(n,...t){if(pn.logLevel<=G.ERROR){const e=t.map(Fc);pn.error(`Firestore (${ci}): ${n}`,...e)}}function Pr(n,...t){if(pn.logLevel<=G.WARN){const e=t.map(Fc);pn.warn(`Firestore (${ci}): ${n}`,...e)}}function Fc(n){if(typeof n=="string")return n;try{return t=n,JSON.stringify(t)}catch{return n}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(n="Unexpected state"){const t=`FIRESTORE (${ci}) INTERNAL ASSERTION FAILED: `+n;throw Lt(t),new Error(t)}function P(n,t){n||M()}function V(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class k extends ri{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class a0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(St.UNAUTHENTICATED))}shutdown(){}}class c0{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class l0{constructor(t){this.t=t,this.currentUser=St.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let i=this.i;const s=c=>this.i!==i?(i=this.i,e(c)):Promise.resolve();let r=new le;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new le,t.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=r;t.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{T("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(T("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new le)}},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(i=>this.i!==t?(T("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(P(typeof i.accessToken=="string"),new Nf(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return P(t===null||typeof t=="string"),new St(t)}}class h0{constructor(t,e,i,s){this.h=t,this.l=e,this.m=i,this.g=s,this.type="FirstParty",this.user=St.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(P(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.p.set("Authorization",t),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class u0{constructor(t,e,i,s){this.h=t,this.l=e,this.m=i,this.g=s}getToken(){return Promise.resolve(new h0(this.h,this.l,this.m,this.g))}start(t,e){t.enqueueRetryable(()=>e(St.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class d0{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class f0{constructor(t){this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,e){const i=r=>{r.error!=null&&T("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.A;return this.A=r.token,T("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(r.token):Promise.resolve()};this.o=r=>{t.enqueueRetryable(()=>i(r))};const s=r=>{T("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.appCheck.addTokenListener(this.o)};this.T.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){const r=this.T.getImmediate({optional:!0});r?s(r):T("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(P(typeof e.token=="string"),this.A=e.token,new d0(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g0(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let i=0;i<n;i++)e[i]=Math.floor(256*Math.random());return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let i="";for(;i.length<20;){const s=g0(40);for(let r=0;r<s.length;++r)i.length<20&&s[r]<e&&(i+=t.charAt(s[r]%t.length))}return i}}function B(n,t){return n<t?-1:n>t?1:0}function Wn(n,t,e){return n.length===t.length&&n.every((i,s)=>e(i,t[s]))}function Vf(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new k(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new k(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new k(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new k(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ht.fromMillis(Date.now())}static fromDate(t){return ht.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new ht(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?B(this.nanoseconds,t.nanoseconds):B(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L{constructor(t){this.timestamp=t}static fromTimestamp(t){return new L(t)}static min(){return new L(new ht(0,0))}static max(){return new L(new ht(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(t,e,i){e===void 0?e=0:e>t.length&&M(),i===void 0?i=t.length-e:i>t.length-e&&M(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return es.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof es?t.forEach(i=>{e.push(i)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let s=0;s<i;s++){const r=t.get(s),o=e.get(s);if(r<o)return-1;if(r>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Y extends es{construct(t,e,i){return new Y(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new k(_.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter(s=>s.length>0))}return new Y(e)}static emptyPath(){return new Y([])}}const p0=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class pt extends es{construct(t,e,i){return new pt(t,e,i)}static isValidIdentifier(t){return p0.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),pt.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new pt(["__name__"])}static fromServerFormat(t){const e=[];let i="",s=0;const r=()=>{if(i.length===0)throw new k(_.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""};let o=!1;for(;s<t.length;){const a=t[s];if(a==="\\"){if(s+1===t.length)throw new k(_.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const c=t[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new k(_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(i+=a,s++):(r(),s++)}if(r(),o)throw new k(_.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new pt(e)}static emptyPath(){return new pt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C{constructor(t){this.path=t}static fromPath(t){return new C(Y.fromString(t))}static fromName(t){return new C(Y.fromString(t).popFirst(5))}static empty(){return new C(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new C(new Y(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(t,e,i,s){this.indexId=t,this.collectionGroup=e,this.fields=i,this.indexState=s}}function Ma(n){return n.fields.find(t=>t.kind===2)}function Ze(n){return n.fields.filter(t=>t.kind!==2)}Bf.UNKNOWN_ID=-1;class m0{constructor(t,e){this.fieldPath=t,this.kind=e}}class Lr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Lr(0,Wt.min())}}function y0(n,t){const e=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=L.fromTimestamp(i===1e9?new ht(e+1,0):new ht(e,i));return new Wt(s,C.empty(),t)}function zf(n){return new Wt(n.readTime,n.key,-1)}class Wt{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new Wt(L.min(),C.empty(),-1)}static max(){return new Wt(L.max(),C.empty(),-1)}}function Vc(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=C.comparator(n.documentKey,t.documentKey),e!==0?e:B(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Uf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tn(n){if(n.code!==_.FAILED_PRECONDITION||n.message!==$f)throw n;T("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new v((i,s)=>{this.nextCallback=r=>{this.wrapSuccess(t,r).next(i,s)},this.catchCallback=r=>{this.wrapFailure(e,r).next(i,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof v?e:v.resolve(e)}catch(e){return v.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):v.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):v.reject(e)}static resolve(t){return new v((e,i)=>{e(t)})}static reject(t){return new v((e,i)=>{i(t)})}static waitFor(t){return new v((e,i)=>{let s=0,r=0,o=!1;t.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&e()},c=>i(c))}),o=!0,r===s&&e()})}static or(t){let e=v.resolve(!1);for(const i of t)e=e.next(s=>s?v.resolve(s):i());return e}static forEach(t,e){const i=[];return t.forEach((s,r)=>{i.push(e.call(this,s,r))}),this.waitFor(i)}static mapArray(t,e){return new v((i,s)=>{const r=t.length,o=new Array(r);let a=0;for(let c=0;c<r;c++){const l=c;e(t[l]).next(h=>{o[l]=h,++a,a===r&&i(o)},h=>s(h))}})}static doWhile(t,e){return new v((i,s)=>{const r=()=>{t()===!0?e().next(()=>{r()},s):i()};r()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.P=new le,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new Vi(t,e.error)):this.P.resolve()},this.transaction.onerror=i=>{const s=Bc(i.target.error);this.P.reject(new Vi(t,s))}}static open(t,e,i,s){try{return new po(e,t.transaction(s,i))}catch(r){throw new Vi(e,r)}}get v(){return this.P.promise}abort(t){t&&this.P.reject(t),this.aborted||(T("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){const e=this.transaction.objectStore(t);return new v0(e)}}class be{constructor(t,e,i){this.name=t,this.version=e,this.S=i,be.D(da())===12.2&&Lt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return T("SimpleDb","Removing database:",t),nn(window.indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!Id())return!1;if(be.N())return!0;const t=da(),e=be.D(t),i=0<e&&e<10,s=be.k(t),r=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||i||r)}static N(){var t;return typeof process<"u"&&((t=process.env)===null||t===void 0?void 0:t.O)==="YES"}static M(t,e){return t.store(e)}static D(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static k(t){const e=t.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}async F(t){return this.db||(T("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,i)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=r=>{const o=r.target.result;e(o)},s.onblocked=()=>{i(new Vi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=r=>{const o=r.target.error;o.name==="VersionError"?i(new k(_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new k(_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new Vi(t,o))},s.onupgradeneeded=r=>{T("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',r.oldVersion);const o=r.target.result;this.S.$(o,s.transaction,r.oldVersion,this.version).next(()=>{T("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,i,s){const r=e==="readonly";let o=0;for(;;){++o;try{this.db=await this.F(t);const a=po.open(this.db,t,r?"readonly":"readwrite",i),c=s(a).next(l=>(a.V(),l)).catch(l=>(a.abort(l),v.reject(l))).toPromise();return c.catch(()=>{}),await a.v,c}catch(a){const c=a,l=c.name!=="FirebaseError"&&o<3;if(T("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}class b0{constructor(t){this.q=t,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(t){this.q=t}done(){this.U=!0}j(t){this.K=t}delete(){return nn(this.q.delete())}}class Vi extends k{constructor(t,e){super(_.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function qe(n){return n.name==="IndexedDbTransactionError"}class v0{constructor(t){this.store=t}put(t,e){let i;return e!==void 0?(T("SimpleDb","PUT",this.store.name,t,e),i=this.store.put(e,t)):(T("SimpleDb","PUT",this.store.name,"<auto-key>",t),i=this.store.put(t)),nn(i)}add(t){return T("SimpleDb","ADD",this.store.name,t,t),nn(this.store.add(t))}get(t){return nn(this.store.get(t)).next(e=>(e===void 0&&(e=null),T("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return T("SimpleDb","DELETE",this.store.name,t),nn(this.store.delete(t))}count(){return T("SimpleDb","COUNT",this.store.name),nn(this.store.count())}W(t,e){const i=this.options(t,e);if(i.index||typeof this.store.getAll!="function"){const s=this.cursor(i),r=[];return this.H(s,(o,a)=>{r.push(a)}).next(()=>r)}{const s=this.store.getAll(i.range);return new v((r,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{r(a.target.result)}})}}J(t,e){const i=this.store.getAll(t,e===null?void 0:e);return new v((s,r)=>{i.onerror=o=>{r(o.target.error)},i.onsuccess=o=>{s(o.target.result)}})}Y(t,e){T("SimpleDb","DELETE ALL",this.store.name);const i=this.options(t,e);i.X=!1;const s=this.cursor(i);return this.H(s,(r,o,a)=>a.delete())}Z(t,e){let i;e?i=t:(i={},e=t);const s=this.cursor(i);return this.H(s,e)}tt(t){const e=this.cursor({});return new v((i,s)=>{e.onerror=r=>{const o=Bc(r.target.error);s(o)},e.onsuccess=r=>{const o=r.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}H(t,e){const i=[];return new v((s,r)=>{t.onerror=o=>{r(o.target.error)},t.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new b0(a),l=e(a.primaryKey,a.value,c);if(l instanceof v){const h=l.catch(u=>(c.done(),v.reject(u)));i.push(h)}c.isDone?s():c.G===null?a.continue():a.continue(c.G)}}).next(()=>v.waitFor(i))}options(t,e){let i;return t!==void 0&&(typeof t=="string"?i=t:e=t),{index:i,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const i=this.store.index(t.index);return t.X?i.openKeyCursor(t.range,e):i.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function nn(n){return new v((t,e)=>{n.onsuccess=i=>{const s=i.target.result;t(s)},n.onerror=i=>{const s=Bc(i.target.error);e(s)}})}let nh=!1;function Bc(n){const t=be.D(da());if(t>=12.2&&t<13){const e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){const i=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nh||(nh=!0,setTimeout(()=>{throw i},0)),i}}return n}class x0{constructor(t,e){this.asyncQueue=t,this.et=e,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}nt(t){T("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,async()=>{this.task=null;try{T("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){qe(e)?T("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await Tn(e)}await this.nt(6e4)})}}class w0{constructor(t,e){this.localStore=t,this.persistence=e}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(t,e){const i=new Set;let s=e,r=!0;return v.doWhile(()=>r===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!i.has(o))return T("IndexBackiller",`Processing collection: ${o}`),this.rt(t,o,s).next(a=>{s-=a,i.add(o)});r=!1})).next(()=>e-s)}rt(t,e,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(s=>this.localStore.localDocuments.getNextDocuments(t,e,s,i).next(r=>{const o=r.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.ot(s,r)).next(a=>(T("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}ot(t,e){let i=t;return e.changes.forEach((s,r)=>{const o=zf(r);Vc(o,i)>0&&(i=o)}),new Wt(i.readTime,i.documentKey,Math.max(e.batchId,t.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=i=>this.ut(i),this.ct=i=>e.writeSequenceNumber(i))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}Yt.at=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(t,e,i,s,r,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}}class mn{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new mn("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof mn&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ih(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Ds(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function jf(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mo(n){return n==null}function ns(n){return n===0&&1/n==-1/0}function S0(n){return typeof n=="number"&&Number.isInteger(n)&&!ns(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Tt(e)}static fromUint8Array(t){const e=function(i){let s="";for(let r=0;r<i.length;++r)s+=String.fromCharCode(i[r]);return s}(t);return new Tt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return B(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Tt.EMPTY_BYTE_STRING=new Tt("");const E0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fe(n){if(P(!!n),typeof n=="string"){let t=0;const e=E0.exec(n);if(P(!!e),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:ot(n.seconds),nanos:ot(n.nanos)}}function ot(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function yn(n){return typeof n=="string"?Tt.fromBase64String(n):Tt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(n){var t,e;return((e=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Hf(n){const t=n.mapValue.fields.__previous_value__;return qf(t)?Hf(t):t}function is(n){const t=Fe(n.mapValue.fields.__local_write_time__.timestampValue);return new ht(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const De={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},or={nullValue:"NULL_VALUE"};function bn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qf(n)?4:Wf(n)?9007199254740991:10:M()}function ue(n,t){if(n===t)return!0;const e=bn(n);if(e!==bn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return is(n).isEqual(is(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const r=Fe(i.timestampValue),o=Fe(s.timestampValue);return r.seconds===o.seconds&&r.nanos===o.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(i,s){return yn(i.bytesValue).isEqual(yn(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return ot(i.geoPointValue.latitude)===ot(s.geoPointValue.latitude)&&ot(i.geoPointValue.longitude)===ot(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ot(i.integerValue)===ot(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const r=ot(i.doubleValue),o=ot(s.doubleValue);return r===o?ns(r)===ns(o):isNaN(r)&&isNaN(o)}return!1}(n,t);case 9:return Wn(n.arrayValue.values||[],t.arrayValue.values||[],ue);case 10:return function(i,s){const r=i.mapValue.fields||{},o=s.mapValue.fields||{};if(ih(r)!==ih(o))return!1;for(const a in r)if(r.hasOwnProperty(a)&&(o[a]===void 0||!ue(r[a],o[a])))return!1;return!0}(n,t);default:return M()}}function ss(n,t){return(n.values||[]).find(e=>ue(e,t))!==void 0}function Ve(n,t){if(n===t)return 0;const e=bn(n),i=bn(t);if(e!==i)return B(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return B(n.booleanValue,t.booleanValue);case 2:return function(s,r){const o=ot(s.integerValue||s.doubleValue),a=ot(r.integerValue||r.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,t);case 3:return sh(n.timestampValue,t.timestampValue);case 4:return sh(is(n),is(t));case 5:return B(n.stringValue,t.stringValue);case 6:return function(s,r){const o=yn(s),a=yn(r);return o.compareTo(a)}(n.bytesValue,t.bytesValue);case 7:return function(s,r){const o=s.split("/"),a=r.split("/");for(let c=0;c<o.length&&c<a.length;c++){const l=B(o[c],a[c]);if(l!==0)return l}return B(o.length,a.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,r){const o=B(ot(s.latitude),ot(r.latitude));return o!==0?o:B(ot(s.longitude),ot(r.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,r){const o=s.values||[],a=r.values||[];for(let c=0;c<o.length&&c<a.length;++c){const l=Ve(o[c],a[c]);if(l)return l}return B(o.length,a.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,r){if(s===De.mapValue&&r===De.mapValue)return 0;if(s===De.mapValue)return 1;if(r===De.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),c=r.fields||{},l=Object.keys(c);a.sort(),l.sort();for(let h=0;h<a.length&&h<l.length;++h){const u=B(a[h],l[h]);if(u!==0)return u;const d=Ve(o[a[h]],c[l[h]]);if(d!==0)return d}return B(a.length,l.length)}(n.mapValue,t.mapValue);default:throw M()}}function sh(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return B(n,t);const e=Fe(n),i=Fe(t),s=B(e.seconds,i.seconds);return s!==0?s:B(e.nanos,i.nanos)}function Kn(n){return Oa(n)}function Oa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const s=Fe(i);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?yn(n.bytesValue).toBase64():"referenceValue"in n?(e=n.referenceValue,C.fromName(e).toString()):"geoPointValue"in n?`geo(${(t=n.geoPointValue).latitude},${t.longitude})`:"arrayValue"in n?function(i){let s="[",r=!0;for(const o of i.values||[])r?r=!1:s+=",",s+=Oa(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(i){const s=Object.keys(i.fields||{}).sort();let r="{",o=!0;for(const a of s)o?o=!1:r+=",",r+=`${a}:${Oa(i.fields[a])}`;return r+"}"}(n.mapValue):M();var t,e}function rs(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function Pa(n){return!!n&&"integerValue"in n}function os(n){return!!n&&"arrayValue"in n}function rh(n){return!!n&&"nullValue"in n}function oh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qo(n){return!!n&&"mapValue"in n}function Bi(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Ds(n.mapValue.fields,(e,i)=>t.mapValue.fields[e]=Bi(i)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Bi(n.arrayValue.values[e]);return t}return Object.assign({},n)}function Wf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function I0(n){return"nullValue"in n?or:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?rs(mn.empty(),C.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:M()}function T0(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?rs(mn.empty(),C.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?De:M()}function ah(n,t){const e=Ve(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function ch(n,t){const e=Ve(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(t,e){this.position=t,this.inclusive=e}}function lh(n,t,e){let i=0;for(let s=0;s<n.position.length;s++){const r=t[s],o=n.position[s];if(r.field.isKeyField()?i=C.comparator(C.fromName(o.referenceValue),e.key):i=Ve(o,e.data.field(r.field)),r.dir==="desc"&&(i*=-1),i!==0)break}return i}function hh(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ue(n.position[e],t.position[e]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{}class j extends Kf{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,i):new D0(t,e,i):e==="array-contains"?new A0(t,i):e==="in"?new Zf(t,i):e==="not-in"?new M0(t,i):e==="array-contains-any"?new O0(t,i):new j(t,e,i)}static createKeyFieldInFilter(t,e,i){return e==="in"?new C0(t,i):new k0(t,i)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Ve(e,this.value)):e!==null&&bn(this.value)===bn(e)&&this.matchesComparison(Ve(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return M()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class X extends Kf{constructor(t,e){super(),this.filters=t,this.op=e,this.ht=null}static create(t,e){return new X(t,e)}matches(t){return Yn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ht!==null||(this.ht=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.lt(e=>e.isInequality());return t!==null?t.field:null}lt(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function Yn(n){return n.op==="and"}function La(n){return n.op==="or"}function zc(n){return Gf(n)&&Yn(n)}function Gf(n){for(const t of n.filters)if(t instanceof X)return!1;return!0}function Ra(n){if(n instanceof j)return n.field.canonicalString()+n.op.toString()+Kn(n.value);if(zc(n))return n.filters.map(t=>Ra(t)).join(",");{const t=n.filters.map(e=>Ra(e)).join(",");return`${n.op}(${t})`}}function Yf(n,t){return n instanceof j?function(e,i){return i instanceof j&&e.op===i.op&&e.field.isEqual(i.field)&&ue(e.value,i.value)}(n,t):n instanceof X?function(e,i){return i instanceof X&&e.op===i.op&&e.filters.length===i.filters.length?e.filters.reduce((s,r,o)=>s&&Yf(r,i.filters[o]),!0):!1}(n,t):void M()}function Qf(n,t){const e=n.filters.concat(t);return X.create(e,n.op)}function Xf(n){return n instanceof j?function(t){return`${t.field.canonicalString()} ${t.op} ${Kn(t.value)}`}(n):n instanceof X?function(t){return t.op.toString()+" {"+t.getFilters().map(Xf).join(" ,")+"}"}(n):"Filter"}class D0 extends j{constructor(t,e,i){super(t,e,i),this.key=C.fromName(i.referenceValue)}matches(t){const e=C.comparator(t.key,this.key);return this.matchesComparison(e)}}class C0 extends j{constructor(t,e){super(t,"in",e),this.keys=Jf("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class k0 extends j{constructor(t,e){super(t,"not-in",e),this.keys=Jf("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Jf(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(i=>C.fromName(i.referenceValue))}class A0 extends j{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return os(e)&&ss(e.arrayValue,this.value)}}class Zf extends j{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&ss(this.value.arrayValue,e)}}class M0 extends j{constructor(t,e){super(t,"not-in",e)}matches(t){if(ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&!ss(this.value.arrayValue,e)}}class O0 extends j{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!os(e)||!e.arrayValue.values)&&e.arrayValue.values.some(i=>ss(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(t,e="asc"){this.field=t,this.dir=e}}function P0(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(t,e){this.comparator=t,this.root=e||Et.EMPTY}insert(t,e){return new yt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Et.BLACK,null,null))}remove(t){return new yt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Et.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(i===0)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(t,i.key);if(s===0)return e+i.left.size;s<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,i)=>(t(e,i),!1))}toString(){const t=[];return this.inorderTraversal((e,i)=>(t.push(`${e}:${i}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Us(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Us(this.root,t,this.comparator,!1)}getReverseIterator(){return new Us(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Us(this.root,t,this.comparator,!0)}}class Us{constructor(t,e,i,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?i(t.key,e):1,e&&s&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(r===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Et{constructor(t,e,i,s,r){this.key=t,this.value=e,this.color=i??Et.RED,this.left=s??Et.EMPTY,this.right=r??Et.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,s,r){return new Et(t??this.key,e??this.value,i??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let s=this;const r=i(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,i),null):r===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Et.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return Et.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Et.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw M();const t=this.left.check();if(t!==this.right.check())throw M();return t+(this.isRed()?0:1)}}Et.EMPTY=null,Et.RED=!0,Et.BLACK=!1;Et.EMPTY=new class{constructor(){this.size=0}get key(){throw M()}get value(){throw M()}get color(){throw M()}get left(){throw M()}get right(){throw M()}copy(n,t,e,i,s){return this}insert(n,t,e){return new Et(n,t)}remove(n,t){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z{constructor(t){this.comparator=t,this.data=new yt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,i)=>(t(e),!1))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let i;for(i=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new uh(this.data.getIterator())}getIteratorFrom(t){return new uh(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(i=>{e=e.add(i)}),e}isEqual(t){if(!(t instanceof Z)||this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,r=i.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Z(this.comparator);return e.data=t,e}}class uh{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function On(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(t){this.fields=t,t.sort(pt.comparator)}static empty(){return new ve([])}unionWith(t){let e=new Z(pt.comparator);for(const i of this.fields)e=e.add(i);for(const i of t)e=e.add(i);return new ve(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Wn(this.fields,t.fields,(e,i)=>e.isEqual(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(t){this.value=t}static empty(){return new Gt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!Qo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Bi(e)}setAll(t){let e=pt.emptyPath(),i={},s=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){const c=this.getFieldsMap(e);this.applyChanges(c,i,s),i={},s=[],e=a.popLast()}o?i[a.lastSegment()]=Bi(o):s.push(a.lastSegment())});const r=this.getFieldsMap(e);this.applyChanges(r,i,s)}delete(t){const e=this.field(t.popLast());Qo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ue(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let s=e.mapValue.fields[t.get(i)];Qo(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,i){Ds(e,(s,r)=>t[s]=r);for(const s of i)delete t[s]}clone(){return new Gt(Bi(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(t,e,i,s,r,o,a){this.key=t,this.documentType=e,this.version=i,this.readTime=s,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(t){return new at(t,0,L.min(),L.min(),L.min(),Gt.empty(),0)}static newFoundDocument(t,e,i,s){return new at(t,1,e,L.min(),i,s,0)}static newNoDocument(t,e){return new at(t,2,e,L.min(),L.min(),Gt.empty(),0)}static newUnknownDocument(t,e){return new at(t,3,e,L.min(),L.min(),Gt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(L.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Gt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Gt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=L.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof at&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new at(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(t,e=null,i=[],s=[],r=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ft=null}}function Na(n,t=null,e=[],i=[],s=null,r=null,o=null){return new L0(n,t,e,i,s,r,o)}function vn(n){const t=V(n);if(t.ft===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(i=>Ra(i)).join(","),e+="|ob:",e+=t.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),mo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>Kn(i)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>Kn(i)).join(",")),t.ft=e}return t.ft}function Cs(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!P0(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Yf(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!hh(n.startAt,t.startAt)&&hh(n.endAt,t.endAt)}function Rr(n){return C.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Nr(n,t){return n.filters.filter(e=>e instanceof j&&e.field.isEqual(t))}function dh(n,t,e){let i=or,s=!0;for(const r of Nr(n,t)){let o=or,a=!0;switch(r.op){case"<":case"<=":o=I0(r.value);break;case"==":case"in":case">=":o=r.value;break;case">":o=r.value,a=!1;break;case"!=":case"not-in":o=or}ah({value:i,inclusive:s},{value:o,inclusive:a})<0&&(i=o,s=a)}if(e!==null){for(let r=0;r<n.orderBy.length;++r)if(n.orderBy[r].field.isEqual(t)){const o=e.position[r];ah({value:i,inclusive:s},{value:o,inclusive:e.inclusive})<0&&(i=o,s=e.inclusive);break}}return{value:i,inclusive:s}}function fh(n,t,e){let i=De,s=!0;for(const r of Nr(n,t)){let o=De,a=!0;switch(r.op){case">=":case">":o=T0(r.value),a=!1;break;case"==":case"in":case"<=":o=r.value;break;case"<":o=r.value,a=!1;break;case"!=":case"not-in":o=De}ch({value:i,inclusive:s},{value:o,inclusive:a})>0&&(i=o,s=a)}if(e!==null){for(let r=0;r<n.orderBy.length;++r)if(n.orderBy[r].field.isEqual(t)){const o=e.position[r];ch({value:i,inclusive:s},{value:o,inclusive:e.inclusive})>0&&(i=o,s=e.inclusive);break}}return{value:i,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(t,e=null,i=[],s=[],r=null,o="F",a=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=c,this.dt=null,this._t=null,this.startAt,this.endAt}}function R0(n,t,e,i,s,r,o,a){return new ks(n,t,e,i,s,r,o,a)}function As(n){return new ks(n)}function gh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function tg(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function $c(n){for(const t of n.filters){const e=t.getFirstInequalityField();if(e!==null)return e}return null}function eg(n){return n.collectionGroup!==null}function $n(n){const t=V(n);if(t.dt===null){t.dt=[];const e=$c(t),i=tg(t);if(e!==null&&i===null)e.isKeyField()||t.dt.push(new zi(e)),t.dt.push(new zi(pt.keyField(),"asc"));else{let s=!1;for(const r of t.explicitOrderBy)t.dt.push(r),r.field.isKeyField()&&(s=!0);if(!s){const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.dt.push(new zi(pt.keyField(),r))}}}return t.dt}function ne(n){const t=V(n);if(!t._t)if(t.limitType==="F")t._t=Na(t.path,t.collectionGroup,$n(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const r of $n(t)){const o=r.dir==="desc"?"asc":"desc";e.push(new zi(r.field,o))}const i=t.endAt?new Gn(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new Gn(t.startAt.position,t.startAt.inclusive):null;t._t=Na(t.path,t.collectionGroup,e,t.filters,t.limit,i,s)}return t._t}function Fa(n,t){t.getFirstInequalityField(),$c(n);const e=n.filters.concat([t]);return new ks(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Va(n,t,e){return new ks(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function yo(n,t){return Cs(ne(n),ne(t))&&n.limitType===t.limitType}function ng(n){return`${vn(ne(n))}|lt:${n.limitType}`}function Ba(n){return`Query(target=${function(t){let e=t.path.canonicalString();return t.collectionGroup!==null&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(i=>Xf(i)).join(", ")}]`),mo(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(i=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(i)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>Kn(i)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>Kn(i)).join(",")),`Target(${e})`}(ne(n))}; limitType=${n.limitType})`}function Uc(n,t){return t.isFoundDocument()&&function(e,i){const s=i.key.path;return e.collectionGroup!==null?i.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(s):C.isDocumentKey(e.path)?e.path.isEqual(s):e.path.isImmediateParentOf(s)}(n,t)&&function(e,i){for(const s of $n(e))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,t)&&function(e,i){for(const s of e.filters)if(!s.matches(i))return!1;return!0}(n,t)&&function(e,i){return!(e.startAt&&!function(s,r,o){const a=lh(s,r,o);return s.inclusive?a<=0:a<0}(e.startAt,$n(e),i)||e.endAt&&!function(s,r,o){const a=lh(s,r,o);return s.inclusive?a>=0:a>0}(e.endAt,$n(e),i))}(n,t)}function N0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ig(n){return(t,e)=>{let i=!1;for(const s of $n(n)){const r=F0(s,t,e);if(r!==0)return r;i=i||s.field.isKeyField()}return 0}}function F0(n,t,e){const i=n.field.isKeyField()?C.comparator(t.key,e.key):function(s,r,o){const a=r.data.field(s),c=o.data.field(s);return a!==null&&c!==null?Ve(a,c):M()}(n.field,t,e);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return M()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sg(n,t){if(n.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ns(t)?"-0":t}}function rg(n){return{integerValue:""+n}}function V0(n,t){return S0(t)?rg(t):sg(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(){this._=void 0}}function B0(n,t,e){return n instanceof as?function(i,s){const r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&(r.fields.__previous_value__=s),{mapValue:r}}(e,t):n instanceof Qn?og(n,t):n instanceof Xn?ag(n,t):function(i,s){const r=$0(i,s),o=ph(r)+ph(i.gt);return Pa(r)&&Pa(i.gt)?rg(o):sg(i.yt,o)}(n,t)}function z0(n,t,e){return n instanceof Qn?og(n,t):n instanceof Xn?ag(n,t):e}function $0(n,t){return n instanceof cs?Pa(e=t)||function(i){return!!i&&"doubleValue"in i}(e)?t:{integerValue:0}:null;var e}class as extends bo{}class Qn extends bo{constructor(t){super(),this.elements=t}}function og(n,t){const e=cg(t);for(const i of n.elements)e.some(s=>ue(s,i))||e.push(i);return{arrayValue:{values:e}}}class Xn extends bo{constructor(t){super(),this.elements=t}}function ag(n,t){let e=cg(t);for(const i of n.elements)e=e.filter(s=>!ue(s,i));return{arrayValue:{values:e}}}class cs extends bo{constructor(t,e){super(),this.yt=t,this.gt=e}}function ph(n){return ot(n.integerValue||n.doubleValue)}function cg(n){return os(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(t,e){this.field=t,this.transform=e}}function j0(n,t){return n.field.isEqual(t.field)&&function(e,i){return e instanceof Qn&&i instanceof Qn||e instanceof Xn&&i instanceof Xn?Wn(e.elements,i.elements,ue):e instanceof cs&&i instanceof cs?ue(e.gt,i.gt):e instanceof as&&i instanceof as}(n.transform,t.transform)}class q0{constructor(t,e){this.version=t,this.transformResults=e}}class Zt{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Zt}static exists(t){return new Zt(void 0,t)}static updateTime(t){return new Zt(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ar(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class vo{}function lg(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new jc(n.key,Zt.none()):new Ms(n.key,n.data,Zt.none());{const e=n.data,i=Gt.empty();let s=new Z(pt.comparator);for(let r of t.fields)if(!s.has(r)){let o=e.field(r);o===null&&r.length>1&&(r=r.popLast(),o=e.field(r)),o===null?i.delete(r):i.set(r,o),s=s.add(r)}return new li(n.key,i,new ve(s.toArray()),Zt.none())}}function H0(n,t,e){n instanceof Ms?function(i,s,r){const o=i.value.clone(),a=yh(i.fieldTransforms,s,r.transformResults);o.setAll(a),s.convertToFoundDocument(r.version,o).setHasCommittedMutations()}(n,t,e):n instanceof li?function(i,s,r){if(!ar(i.precondition,s))return void s.convertToUnknownDocument(r.version);const o=yh(i.fieldTransforms,s,r.transformResults),a=s.data;a.setAll(hg(i)),a.setAll(o),s.convertToFoundDocument(r.version,a).setHasCommittedMutations()}(n,t,e):function(i,s,r){s.convertToNoDocument(r.version).setHasCommittedMutations()}(0,t,e)}function $i(n,t,e,i){return n instanceof Ms?function(s,r,o,a){if(!ar(s.precondition,r))return o;const c=s.value.clone(),l=bh(s.fieldTransforms,a,r);return c.setAll(l),r.convertToFoundDocument(r.version,c).setHasLocalMutations(),null}(n,t,e,i):n instanceof li?function(s,r,o,a){if(!ar(s.precondition,r))return o;const c=bh(s.fieldTransforms,a,r),l=r.data;return l.setAll(hg(s)),l.setAll(c),r.convertToFoundDocument(r.version,l).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,i):function(s,r,o){return ar(s.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):o}(n,t,e)}function mh(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(e,i){return e===void 0&&i===void 0||!(!e||!i)&&Wn(e,i,(s,r)=>j0(s,r))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class Ms extends vo{constructor(t,e,i,s=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class li extends vo{constructor(t,e,i,s,r=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function hg(n){const t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){const i=n.data.field(e);t.set(e,i)}}),t}function yh(n,t,e){const i=new Map;P(n.length===e.length);for(let s=0;s<e.length;s++){const r=n[s],o=r.transform,a=t.data.field(r.field);i.set(r.field,z0(o,a,e[s]))}return i}function bh(n,t,e){const i=new Map;for(const s of n){const r=s.transform,o=e.data.field(s.field);i.set(s.field,B0(r,o,t))}return i}class jc extends vo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ug extends vo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(t){this.count=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gt,H;function K0(n){switch(n){default:return M();case _.CANCELLED:case _.UNKNOWN:case _.DEADLINE_EXCEEDED:case _.RESOURCE_EXHAUSTED:case _.INTERNAL:case _.UNAVAILABLE:case _.UNAUTHENTICATED:return!1;case _.INVALID_ARGUMENT:case _.NOT_FOUND:case _.ALREADY_EXISTS:case _.PERMISSION_DENIED:case _.FAILED_PRECONDITION:case _.ABORTED:case _.OUT_OF_RANGE:case _.UNIMPLEMENTED:case _.DATA_LOSS:return!0}}function dg(n){if(n===void 0)return Lt("GRPC error has no .code"),_.UNKNOWN;switch(n){case gt.OK:return _.OK;case gt.CANCELLED:return _.CANCELLED;case gt.UNKNOWN:return _.UNKNOWN;case gt.DEADLINE_EXCEEDED:return _.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return _.RESOURCE_EXHAUSTED;case gt.INTERNAL:return _.INTERNAL;case gt.UNAVAILABLE:return _.UNAVAILABLE;case gt.UNAUTHENTICATED:return _.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return _.INVALID_ARGUMENT;case gt.NOT_FOUND:return _.NOT_FOUND;case gt.ALREADY_EXISTS:return _.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return _.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return _.FAILED_PRECONDITION;case gt.ABORTED:return _.ABORTED;case gt.OUT_OF_RANGE:return _.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return _.UNIMPLEMENTED;case gt.DATA_LOSS:return _.DATA_LOSS;default:return M()}}(H=gt||(gt={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i!==void 0){for(const[s,r]of i)if(this.equalsFn(s,t))return r}}has(t){return this.get(t)!==void 0}set(t,e){const i=this.mapKeyFn(t),s=this.inner[i];if(s===void 0)return this.inner[i]=[[t,e]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],t))return void(s[r]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return i.length===1?delete this.inner[e]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Ds(this.inner,(e,i)=>{for(const[s,r]of i)t(s,r)})}isEmpty(){return jf(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0=new yt(C.comparator);function Qt(){return G0}const fg=new yt(C.comparator);function ki(...n){let t=fg;for(const e of n)t=t.insert(e.key,e);return t}function Y0(n){let t=fg;return n.forEach((e,i)=>t=t.insert(e,i.overlayedDocument)),t}function ae(){return Ui()}function gg(){return Ui()}function Ui(){return new He(n=>n.toString(),(n,t)=>n.isEqual(t))}const Q0=new yt(C.comparator),X0=new Z(C.comparator);function U(...n){let t=X0;for(const e of n)t=t.add(e);return t}const J0=new Z(B);function pg(){return J0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(t,e,i,s,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,i){const s=new Map;return s.set(t,Os.createSynthesizedTargetChangeForCurrentChange(t,e,i)),new xo(L.min(),s,pg(),Qt(),U())}}class Os{constructor(t,e,i,s,r){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,i){return new Os(i,e,U(),U(),U())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(t,e,i,s){this.It=t,this.removedTargetIds=e,this.key=i,this.Tt=s}}class mg{constructor(t,e){this.targetId=t,this.Et=e}}class yg{constructor(t,e,i=Tt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=s}}class vh{constructor(){this.At=0,this.Rt=wh(),this.bt=Tt.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return this.At!==0}get St(){return this.vt}Dt(t){t.approximateByteSize()>0&&(this.vt=!0,this.bt=t)}Ct(){let t=U(),e=U(),i=U();return this.Rt.forEach((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:i=i.add(s);break;default:M()}}),new Os(this.bt,this.Pt,t,e,i)}xt(){this.vt=!1,this.Rt=wh()}Nt(t,e){this.vt=!0,this.Rt=this.Rt.insert(t,e)}kt(t){this.vt=!0,this.Rt=this.Rt.remove(t)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Z0{constructor(t){this.$t=t,this.Bt=new Map,this.Lt=Qt(),this.qt=xh(),this.Ut=new Z(B)}Kt(t){for(const e of t.It)t.Tt&&t.Tt.isFoundDocument()?this.Gt(e,t.Tt):this.Qt(e,t.key,t.Tt);for(const e of t.removedTargetIds)this.Qt(e,t.key,t.Tt)}jt(t){this.forEachTarget(t,e=>{const i=this.Wt(e);switch(t.state){case 0:this.zt(e)&&i.Dt(t.resumeToken);break;case 1:i.Mt(),i.Vt||i.xt(),i.Dt(t.resumeToken);break;case 2:i.Mt(),i.Vt||this.removeTarget(e);break;case 3:this.zt(e)&&(i.Ft(),i.Dt(t.resumeToken));break;case 4:this.zt(e)&&(this.Ht(e),i.Dt(t.resumeToken));break;default:M()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Bt.forEach((i,s)=>{this.zt(s)&&e(s)})}Jt(t){const e=t.targetId,i=t.Et.count,s=this.Yt(e);if(s){const r=s.target;if(Rr(r))if(i===0){const o=new C(r.path);this.Qt(e,o,at.newNoDocument(o,L.min()))}else P(i===1);else this.Xt(e)!==i&&(this.Ht(e),this.Ut=this.Ut.add(e))}}Zt(t){const e=new Map;this.Bt.forEach((r,o)=>{const a=this.Yt(o);if(a){if(r.current&&Rr(a.target)){const c=new C(a.target.path);this.Lt.get(c)!==null||this.te(o,c)||this.Qt(o,c,at.newNoDocument(c,t))}r.St&&(e.set(o,r.Ct()),r.xt())}});let i=U();this.qt.forEach((r,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.Yt(c);return!l||l.purpose===2||(a=!1,!1)}),a&&(i=i.add(r))}),this.Lt.forEach((r,o)=>o.setReadTime(t));const s=new xo(t,e,this.Ut,this.Lt,i);return this.Lt=Qt(),this.qt=xh(),this.Ut=new Z(B),s}Gt(t,e){if(!this.zt(t))return;const i=this.te(t,e.key)?2:0;this.Wt(t).Nt(e.key,i),this.Lt=this.Lt.insert(e.key,e),this.qt=this.qt.insert(e.key,this.ee(e.key).add(t))}Qt(t,e,i){if(!this.zt(t))return;const s=this.Wt(t);this.te(t,e)?s.Nt(e,1):s.kt(e),this.qt=this.qt.insert(e,this.ee(e).delete(t)),i&&(this.Lt=this.Lt.insert(e,i))}removeTarget(t){this.Bt.delete(t)}Xt(t){const e=this.Wt(t).Ct();return this.$t.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ot(t){this.Wt(t).Ot()}Wt(t){let e=this.Bt.get(t);return e||(e=new vh,this.Bt.set(t,e)),e}ee(t){let e=this.qt.get(t);return e||(e=new Z(B),this.qt=this.qt.insert(t,e)),e}zt(t){const e=this.Yt(t)!==null;return e||T("WatchChangeAggregator","Detected inactive target",t),e}Yt(t){const e=this.Bt.get(t);return e&&e.Vt?null:this.$t.ne(t)}Ht(t){this.Bt.set(t,new vh),this.$t.getRemoteKeysForTarget(t).forEach(e=>{this.Qt(t,e,null)})}te(t,e){return this.$t.getRemoteKeysForTarget(t).has(e)}}function xh(){return new yt(C.comparator)}function wh(){return new yt(C.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tv=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),ev=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),nv=(()=>({and:"AND",or:"OR"}))();class iv{constructor(t,e){this.databaseId=t,this.wt=e}}function Jn(n,t){return n.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function bg(n,t){return n.wt?t.toBase64():t.toUint8Array()}function sv(n,t){return Jn(n,t.toTimestamp())}function Nt(n){return P(!!n),L.fromTimestamp(function(t){const e=Fe(t);return new ht(e.seconds,e.nanos)}(n))}function qc(n,t){return function(e){return new Y(["projects",e.projectId,"databases",e.database])}(n).child("documents").child(t).canonicalString()}function vg(n){const t=Y.fromString(n);return P(Dg(t)),t}function Fr(n,t){return qc(n.databaseId,t.path)}function un(n,t){const e=vg(t);if(e.get(1)!==n.databaseId.projectId)throw new k(_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new k(_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new C(wg(e))}function za(n,t){return qc(n.databaseId,t)}function xg(n){const t=vg(n);return t.length===4?Y.emptyPath():wg(t)}function $a(n){return new Y(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function wg(n){return P(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function _h(n,t,e){return{name:Fr(n,t),fields:e.value.mapValue.fields}}function rv(n,t,e){const i=un(n,t.name),s=Nt(t.updateTime),r=t.createTime?Nt(t.createTime):L.min(),o=new Gt({mapValue:{fields:t.fields}}),a=at.newFoundDocument(i,s,r,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function ov(n,t){let e;if("targetChange"in t){t.targetChange;const i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:M()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=function(c,l){return c.wt?(P(l===void 0||typeof l=="string"),Tt.fromBase64String(l||"")):(P(l===void 0||l instanceof Uint8Array),Tt.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){const l=c.code===void 0?_.UNKNOWN:dg(c.code);return new k(l,c.message||"")}(o);e=new yg(i,s,r,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=un(n,i.document.name),r=Nt(i.document.updateTime),o=i.document.createTime?Nt(i.document.createTime):L.min(),a=new Gt({mapValue:{fields:i.document.fields}}),c=at.newFoundDocument(s,r,o,a),l=i.targetIds||[],h=i.removedTargetIds||[];e=new cr(l,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=un(n,i.document),r=i.readTime?Nt(i.readTime):L.min(),o=at.newNoDocument(s,r),a=i.removedTargetIds||[];e=new cr([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=un(n,i.document),r=i.removedTargetIds||[];e=new cr([],r,s,null)}else{if(!("filter"in t))return M();{t.filter;const i=t.filter;i.targetId;const s=i.count||0,r=new W0(s),o=i.targetId;e=new mg(o,r)}}return e}function Vr(n,t){let e;if(t instanceof Ms)e={update:_h(n,t.key,t.value)};else if(t instanceof jc)e={delete:Fr(n,t.key)};else if(t instanceof li)e={update:_h(n,t.key,t.data),updateMask:dv(t.fieldMask)};else{if(!(t instanceof ug))return M();e={verify:Fr(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(i=>function(s,r){const o=r.transform;if(o instanceof as)return{fieldPath:r.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Qn)return{fieldPath:r.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Xn)return{fieldPath:r.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof cs)return{fieldPath:r.field.canonicalString(),increment:o.gt};throw M()}(0,i))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:sv(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:M()}(n,t.precondition)),e}function Ua(n,t){const e=t.currentDocument?function(s){return s.updateTime!==void 0?Zt.updateTime(Nt(s.updateTime)):s.exists!==void 0?Zt.exists(s.exists):Zt.none()}(t.currentDocument):Zt.none(),i=t.updateTransforms?t.updateTransforms.map(s=>function(r,o){let a=null;if("setToServerValue"in o)P(o.setToServerValue==="REQUEST_TIME"),a=new as;else if("appendMissingElements"in o){const l=o.appendMissingElements.values||[];a=new Qn(l)}else if("removeAllFromArray"in o){const l=o.removeAllFromArray.values||[];a=new Xn(l)}else"increment"in o?a=new cs(r,o.increment):M();const c=pt.fromServerFormat(o.fieldPath);return new U0(c,a)}(n,s)):[];if(t.update){t.update.name;const s=un(n,t.update.name),r=new Gt({mapValue:{fields:t.update.fields}});if(t.updateMask){const o=function(a){const c=a.fieldPaths||[];return new ve(c.map(l=>pt.fromServerFormat(l)))}(t.updateMask);return new li(s,r,o,e,i)}return new Ms(s,r,e,i)}if(t.delete){const s=un(n,t.delete);return new jc(s,e)}if(t.verify){const s=un(n,t.verify);return new ug(s,e)}return M()}function av(n,t){return n&&n.length>0?(P(t!==void 0),n.map(e=>function(i,s){let r=i.updateTime?Nt(i.updateTime):Nt(s);return r.isEqual(L.min())&&(r=Nt(s)),new q0(r,i.transformResults||[])}(e,t))):[]}function _g(n,t){return{documents:[za(n,t.path)]}}function Sg(n,t){const e={structuredQuery:{}},i=t.path;t.collectionGroup!==null?(e.parent=za(n,i),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=za(n,i.popLast()),e.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(c){if(c.length!==0)return Tg(X.create(c,"and"))}(t.filters);s&&(e.structuredQuery.where=s);const r=function(c){if(c.length!==0)return c.map(l=>function(h){return{field:Nn(h.field),direction:lv(h.dir)}}(l))}(t.orderBy);r&&(e.structuredQuery.orderBy=r);const o=function(c,l){return c.wt||mo(l)?l:{value:l}}(n,t.limit);var a;return o!==null&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),e}function Eg(n){let t=xg(n.parent);const e=n.structuredQuery,i=e.from?e.from.length:0;let s=null;if(i>0){P(i===1);const h=e.from[0];h.allDescendants?s=h.collectionId:t=t.child(h.collectionId)}let r=[];e.where&&(r=function(h){const u=Ig(h);return u instanceof X&&zc(u)?u.getFilters():[u]}(e.where));let o=[];e.orderBy&&(o=e.orderBy.map(h=>function(u){return new zi(Fn(u.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(u.direction))}(h)));let a=null;e.limit&&(a=function(h){let u;return u=typeof h=="object"?h.value:h,mo(u)?null:u}(e.limit));let c=null;e.startAt&&(c=function(h){const u=!!h.before,d=h.values||[];return new Gn(d,u)}(e.startAt));let l=null;return e.endAt&&(l=function(h){const u=!h.before,d=h.values||[];return new Gn(d,u)}(e.endAt)),R0(t,s,o,r,a,"F",c,l)}function cv(n,t){const e=function(i,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return M()}}(0,t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ig(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Fn(t.unaryFilter.field);return j.create(e,"==",{doubleValue:NaN});case"IS_NULL":const i=Fn(t.unaryFilter.field);return j.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Fn(t.unaryFilter.field);return j.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Fn(t.unaryFilter.field);return j.create(r,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(n):n.fieldFilter!==void 0?function(t){return j.create(Fn(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return X.create(t.compositeFilter.filters.map(e=>Ig(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return M()}}(t.compositeFilter.op))}(n):M()}function lv(n){return tv[n]}function hv(n){return ev[n]}function uv(n){return nv[n]}function Nn(n){return{fieldPath:n.canonicalString()}}function Fn(n){return pt.fromServerFormat(n.fieldPath)}function Tg(n){return n instanceof j?function(t){if(t.op==="=="){if(oh(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NAN"}};if(rh(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(oh(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NOT_NAN"}};if(rh(t.value))return{unaryFilter:{field:Nn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nn(t.field),op:hv(t.op),value:t.value}}}(n):n instanceof X?function(t){const e=t.getFilters().map(i=>Tg(i));return e.length===1?e[0]:{compositeFilter:{op:uv(t.op),filters:e}}}(n):M()}function dv(n){const t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Dg(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ft(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Sh(t)),t=fv(n.get(e),t);return Sh(t)}function fv(n,t){let e=t;const i=n.length;for(let s=0;s<i;s++){const r=n.charAt(s);switch(r){case"\0":e+="";break;case"":e+="";break;default:e+=r}}return e}function Sh(n){return n+""}function ce(n){const t=n.length;if(P(t>=2),t===2)return P(n.charAt(0)===""&&n.charAt(1)===""),Y.emptyPath();const e=t-2,i=[];let s="";for(let r=0;r<t;){const o=n.indexOf("",r);switch((o<0||o>e)&&M(),n.charAt(o+1)){case"":const a=n.substring(r,o);let c;s.length===0?c=a:(s+=a,c=s,s=""),i.push(c);break;case"":s+=n.substring(r,o),s+="\0";break;case"":s+=n.substring(r,o+1);break;default:M()}r=o+2}return new Y(i)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eh=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(n,t){return[n,Ft(t)]}function Cg(n,t,e){return[n,Ft(t),e]}const gv={},pv=["prefixPath","collectionGroup","readTime","documentId"],mv=["prefixPath","collectionGroup","documentId"],yv=["collectionGroup","readTime","prefixPath","documentId"],bv=["canonicalId","targetId"],vv=["targetId","path"],xv=["path","targetId"],wv=["collectionId","parent"],_v=["indexId","uid"],Sv=["uid","sequenceNumber"],Ev=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Iv=["indexId","uid","orderedDocumentKey"],Tv=["userId","collectionPath","documentId"],Dv=["userId","collectionPath","largestBatchId"],Cv=["userId","collectionGroup","largestBatchId"],kg=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],kv=[...kg,"documentOverlays"],Ag=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Mg=Ag,Av=[...Mg,"indexConfiguration","indexState","indexEntries"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja extends Uf{constructor(t,e){super(),this.se=t,this.currentSequenceNumber=e}}function wt(n,t){const e=V(n);return be.M(e.se,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(t,e,i,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(t,e){const i=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(t.key)&&H0(r,t,i[s])}}applyToLocalView(t,e){for(const i of this.baseMutations)i.key.isEqual(t.key)&&(e=$i(i,t,e,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(t.key)&&(e=$i(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const i=gg();return this.mutations.forEach(s=>{const r=t.get(s.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=e.has(s.key)?null:a;const c=lg(o,a);c!==null&&i.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(L.min())}),i}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),U())}isEqual(t){return this.batchId===t.batchId&&Wn(this.mutations,t.mutations,(e,i)=>mh(e,i))&&Wn(this.baseMutations,t.baseMutations,(e,i)=>mh(e,i))}}class Wc{constructor(t,e,i,s){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=s}static from(t,e,i){P(t.mutations.length===i.length);let s=Q0;const r=t.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,i[o].version);return new Wc(t,e,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(t,e,i,s,r=L.min(),o=L.min(),a=Tt.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(t){return new Le(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Le(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Le(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(t){this.ie=t}}function Mv(n,t){let e;if(t.document)e=rv(n.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const i=C.fromSegments(t.noDocument.path),s=wn(t.noDocument.readTime);e=at.newNoDocument(i,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return M();{const i=C.fromSegments(t.unknownDocument.path),s=wn(t.unknownDocument.version);e=at.newUnknownDocument(i,s)}}return t.readTime&&e.setReadTime(function(i){const s=new ht(i[0],i[1]);return L.fromTimestamp(s)}(t.readTime)),e}function Ih(n,t){const e=t.key,i={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Br(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())i.document=function(s,r){return{name:Fr(s,r.key),fields:r.data.value.mapValue.fields,updateTime:Jn(s,r.version.toTimestamp()),createTime:Jn(s,r.createTime.toTimestamp())}}(n.ie,t);else if(t.isNoDocument())i.noDocument={path:e.path.toArray(),readTime:xn(t.version)};else{if(!t.isUnknownDocument())return M();i.unknownDocument={path:e.path.toArray(),version:xn(t.version)}}return i}function Br(n){const t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function xn(n){const t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function wn(n){const t=new ht(n.seconds,n.nanoseconds);return L.fromTimestamp(t)}function sn(n,t){const e=(t.baseMutations||[]).map(r=>Ua(n.ie,r));for(let r=0;r<t.mutations.length-1;++r){const o=t.mutations[r];if(r+1<t.mutations.length&&t.mutations[r+1].transform!==void 0){const a=t.mutations[r+1];o.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}const i=t.mutations.map(r=>Ua(n.ie,r)),s=ht.fromMillis(t.localWriteTimeMs);return new Hc(t.batchId,s,e,i)}function Ai(n){const t=wn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?wn(n.lastLimboFreeSnapshotVersion):L.min();let i;var s;return n.query.documents!==void 0?(P((s=n.query).documents.length===1),i=ne(As(xg(s.documents[0])))):i=function(r){return ne(Eg(r))}(n.query),new Le(i,n.targetId,0,n.lastListenSequenceNumber,t,e,Tt.fromBase64String(n.resumeToken))}function Pg(n,t){const e=xn(t.snapshotVersion),i=xn(t.lastLimboFreeSnapshotVersion);let s;s=Rr(t.target)?_g(n.ie,t.target):Sg(n.ie,t.target);const r=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:vn(t.target),readTime:e,resumeToken:r,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:s}}function Lg(n){const t=Eg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Va(t,t.limit,"L"):t}function Xo(n,t){return new Kc(t.largestBatchId,Ua(n.ie,t.overlayMutation))}function Th(n,t){const e=t.path.lastSegment();return[n,Ft(t.path.popLast()),e]}function Dh(n,t,e,i){return{indexId:n,uid:t.uid||"",sequenceNumber:e,readTime:xn(i.readTime),documentKey:Ft(i.documentKey.path),largestBatchId:i.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ov{getBundleMetadata(t,e){return Ch(t).get(e).next(i=>{if(i)return{id:(s=i).bundleId,createTime:wn(s.createTime),version:s.version};var s})}saveBundleMetadata(t,e){return Ch(t).put({bundleId:(i=e).id,createTime:xn(Nt(i.createTime)),version:i.version});var i}getNamedQuery(t,e){return kh(t).get(e).next(i=>{if(i)return{name:(s=i).name,query:Lg(s.bundledQuery),readTime:wn(s.readTime)};var s})}saveNamedQuery(t,e){return kh(t).put(function(i){return{name:i.name,readTime:xn(Nt(i.readTime)),bundledQuery:i.bundledQuery}}(e))}}function Ch(n){return wt(n,"bundles")}function kh(n){return wt(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(t,e){this.yt=t,this.userId=e}static re(t,e){const i=e.uid||"";return new wo(t,i)}getOverlay(t,e){return mi(t).get(Th(this.userId,e)).next(i=>i?Xo(this.yt,i):null)}getOverlays(t,e){const i=ae();return v.forEach(e,s=>this.getOverlay(t,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(t,e,i){const s=[];return i.forEach((r,o)=>{const a=new Kc(e,o);s.push(this.oe(t,a))}),v.waitFor(s)}removeOverlaysForBatchId(t,e,i){const s=new Set;e.forEach(o=>s.add(Ft(o.getCollectionPath())));const r=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);r.push(mi(t).Y("collectionPathOverlayIndex",a))}),v.waitFor(r)}getOverlaysForCollection(t,e,i){const s=ae(),r=Ft(e),o=IDBKeyRange.bound([this.userId,r,i],[this.userId,r,Number.POSITIVE_INFINITY],!0);return mi(t).W("collectionPathOverlayIndex",o).next(a=>{for(const c of a){const l=Xo(this.yt,c);s.set(l.getKey(),l)}return s})}getOverlaysForCollectionGroup(t,e,i,s){const r=ae();let o;const a=IDBKeyRange.bound([this.userId,e,i],[this.userId,e,Number.POSITIVE_INFINITY],!0);return mi(t).Z({index:"collectionGroupOverlayIndex",range:a},(c,l,h)=>{const u=Xo(this.yt,l);r.size()<s||u.largestBatchId===o?(r.set(u.getKey(),u),o=u.largestBatchId):h.done()}).next(()=>r)}oe(t,e){return mi(t).put(function(i,s,r){const[o,a,c]=Th(s,r.mutation.key);return{userId:s,collectionPath:a,documentId:c,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:Vr(i.ie,r.mutation)}}(this.yt,this.userId,e))}}function mi(n){return wt(n,"documentOverlays")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(){}ue(t,e){this.ce(t,e),e.ae()}ce(t,e){if("nullValue"in t)this.he(e,5);else if("booleanValue"in t)this.he(e,10),e.le(t.booleanValue?1:0);else if("integerValue"in t)this.he(e,15),e.le(ot(t.integerValue));else if("doubleValue"in t){const i=ot(t.doubleValue);isNaN(i)?this.he(e,13):(this.he(e,15),ns(i)?e.le(0):e.le(i))}else if("timestampValue"in t){const i=t.timestampValue;this.he(e,20),typeof i=="string"?e.fe(i):(e.fe(`${i.seconds||""}`),e.le(i.nanos||0))}else if("stringValue"in t)this.de(t.stringValue,e),this._e(e);else if("bytesValue"in t)this.he(e,30),e.we(yn(t.bytesValue)),this._e(e);else if("referenceValue"in t)this.me(t.referenceValue,e);else if("geoPointValue"in t){const i=t.geoPointValue;this.he(e,45),e.le(i.latitude||0),e.le(i.longitude||0)}else"mapValue"in t?Wf(t)?this.he(e,Number.MAX_SAFE_INTEGER):(this.ge(t.mapValue,e),this._e(e)):"arrayValue"in t?(this.ye(t.arrayValue,e),this._e(e)):M()}de(t,e){this.he(e,25),this.pe(t,e)}pe(t,e){e.fe(t)}ge(t,e){const i=t.fields||{};this.he(e,55);for(const s of Object.keys(i))this.de(s,e),this.ce(i[s],e)}ye(t,e){const i=t.values||[];this.he(e,50);for(const s of i)this.ce(s,e)}me(t,e){this.he(e,37),C.fromName(t).path.forEach(i=>{this.he(e,60),this.pe(i,e)})}he(t,e){t.le(e)}_e(t){t.le(2)}}rn.Ie=new rn;function Pv(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function Ah(n){const t=64-function(e){let i=0;for(let s=0;s<8;++s){const r=Pv(255&e[s]);if(i+=r,r!==8)break}return i}(n);return Math.ceil(t/8)}class Lv{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(t){const e=t[Symbol.iterator]();let i=e.next();for(;!i.done;)this.Ee(i.value),i=e.next();this.Ae()}Re(t){const e=t[Symbol.iterator]();let i=e.next();for(;!i.done;)this.be(i.value),i=e.next();this.Pe()}ve(t){for(const e of t){const i=e.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(e<"\uD800"||"\uDBFF"<e)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{const s=e.codePointAt(0);this.Ee(240|s>>>18),this.Ee(128|63&s>>>12),this.Ee(128|63&s>>>6),this.Ee(128|63&s)}}this.Ae()}Ve(t){for(const e of t){const i=e.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(e<"\uD800"||"\uDBFF"<e)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{const s=e.codePointAt(0);this.be(240|s>>>18),this.be(128|63&s>>>12),this.be(128|63&s>>>6),this.be(128|63&s)}}this.Pe()}Se(t){const e=this.De(t),i=Ah(e);this.Ce(1+i),this.buffer[this.position++]=255&i;for(let s=e.length-i;s<e.length;++s)this.buffer[this.position++]=255&e[s]}xe(t){const e=this.De(t),i=Ah(e);this.Ce(1+i),this.buffer[this.position++]=~(255&i);for(let s=e.length-i;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(t){this.Ce(t.length),this.buffer.set(t,this.position),this.position+=t.length}Fe(){return this.buffer.slice(0,this.position)}De(t){const e=function(s){const r=new DataView(new ArrayBuffer(8));return r.setFloat64(0,s,!1),new Uint8Array(r.buffer)}(t),i=(128&e[0])!=0;e[0]^=i?255:128;for(let s=1;s<e.length;++s)e[s]^=i?255:0;return e}Ee(t){const e=255&t;e===0?(this.ke(0),this.ke(255)):e===255?(this.ke(255),this.ke(0)):this.ke(e)}be(t){const e=255&t;e===0?(this.Me(0),this.Me(255)):e===255?(this.Me(255),this.Me(0)):this.Me(t)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(t){this.Ce(1),this.buffer[this.position++]=t}Me(t){this.Ce(1),this.buffer[this.position++]=~t}Ce(t){const e=t+this.position;if(e<=this.buffer.length)return;let i=2*this.buffer.length;i<e&&(i=e);const s=new Uint8Array(i);s.set(this.buffer),this.buffer=s}}class Rv{constructor(t){this.$e=t}we(t){this.$e.Te(t)}fe(t){this.$e.ve(t)}le(t){this.$e.Se(t)}ae(){this.$e.Ne()}}class Nv{constructor(t){this.$e=t}we(t){this.$e.Re(t)}fe(t){this.$e.Ve(t)}le(t){this.$e.xe(t)}ae(){this.$e.Oe()}}class yi{constructor(){this.$e=new Lv,this.Be=new Rv(this.$e),this.Le=new Nv(this.$e)}seed(t){this.$e.seed(t)}qe(t){return t===0?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(t,e,i,s){this.indexId=t,this.documentKey=e,this.arrayValue=i,this.directionalValue=s}Ue(){const t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,i=new Uint8Array(e);return i.set(this.directionalValue,0),e!==t?i.set([0],this.directionalValue.length):++i[i.length-1],new on(this.indexId,this.documentKey,this.arrayValue,i)}}function Ee(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=Mh(n.arrayValue,t.arrayValue),e!==0?e:(e=Mh(n.directionalValue,t.directionalValue),e!==0?e:C.comparator(n.documentKey,t.documentKey)))}function Mh(n,t){for(let e=0;e<n.length&&e<t.length;++e){const i=n[e]-t[e];if(i!==0)return i}return n.length-t.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fv{constructor(t){this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Ke=t.orderBy,this.Ge=[];for(const e of t.filters){const i=e;i.isInequality()?this.Qe=i:this.Ge.push(i)}}je(t){P(t.collectionGroup===this.collectionId);const e=Ma(t);if(e!==void 0&&!this.We(e))return!1;const i=Ze(t);let s=0,r=0;for(;s<i.length&&this.We(i[s]);++s);if(s===i.length)return!0;if(this.Qe!==void 0){const o=i[s];if(!this.ze(this.Qe,o)||!this.He(this.Ke[r++],o))return!1;++s}for(;s<i.length;++s){const o=i[s];if(r>=this.Ke.length||!this.He(this.Ke[r++],o))return!1}return!0}We(t){for(const e of this.Ge)if(this.ze(e,t))return!0;return!1}ze(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;const i=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===i}He(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rg(n){var t,e;if(P(n instanceof j||n instanceof X),n instanceof j){if(n instanceof Zf){const s=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(r=>j.create(n.field,"==",r)))||[];return X.create(s,"or")}return n}const i=n.filters.map(s=>Rg(s));return X.create(i,n.op)}function Vv(n){if(n.getFilters().length===0)return[];const t=Wa(Rg(n));return P(Ng(t)),qa(t)||Ha(t)?[t]:t.getFilters()}function qa(n){return n instanceof j}function Ha(n){return n instanceof X&&zc(n)}function Ng(n){return qa(n)||Ha(n)||function(t){if(t instanceof X&&La(t)){for(const e of t.getFilters())if(!qa(e)&&!Ha(e))return!1;return!0}return!1}(n)}function Wa(n){if(P(n instanceof j||n instanceof X),n instanceof j)return n;if(n.filters.length===1)return Wa(n.filters[0]);const t=n.filters.map(i=>Wa(i));let e=X.create(t,n.op);return e=zr(e),Ng(e)?e:(P(e instanceof X),P(Yn(e)),P(e.filters.length>1),e.filters.reduce((i,s)=>Gc(i,s)))}function Gc(n,t){let e;return P(n instanceof j||n instanceof X),P(t instanceof j||t instanceof X),e=n instanceof j?t instanceof j?function(i,s){return X.create([i,s],"and")}(n,t):Oh(n,t):t instanceof j?Oh(t,n):function(i,s){if(P(i.filters.length>0&&s.filters.length>0),Yn(i)&&Yn(s))return Qf(i,s.getFilters());const r=La(i)?i:s,o=La(i)?s:i,a=r.filters.map(c=>Gc(c,o));return X.create(a,"or")}(n,t),zr(e)}function Oh(n,t){if(Yn(t))return Qf(t,n.getFilters());{const e=t.filters.map(i=>Gc(n,i));return X.create(e,"or")}}function zr(n){if(P(n instanceof j||n instanceof X),n instanceof j)return n;const t=n.getFilters();if(t.length===1)return zr(t[0]);if(Gf(n))return n;const e=t.map(s=>zr(s)),i=[];return e.forEach(s=>{s instanceof j?i.push(s):s instanceof X&&(s.op===n.op?i.push(...s.filters):i.push(s))}),i.length===1?i[0]:X.create(i,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(){this.Je=new Yc}addToCollectionParentIndex(t,e){return this.Je.add(e),v.resolve()}getCollectionParents(t,e){return v.resolve(this.Je.getEntries(e))}addFieldIndex(t,e){return v.resolve()}deleteFieldIndex(t,e){return v.resolve()}getDocumentsMatchingTarget(t,e){return v.resolve(null)}getIndexType(t,e){return v.resolve(0)}getFieldIndexes(t,e){return v.resolve([])}getNextCollectionGroupToUpdate(t){return v.resolve(null)}getMinOffset(t,e){return v.resolve(Wt.min())}getMinOffsetFromCollectionGroup(t,e){return v.resolve(Wt.min())}updateCollectionGroup(t,e,i){return v.resolve()}updateIndexEntries(t,e){return v.resolve()}}class Yc{constructor(){this.index={}}add(t){const e=t.lastSegment(),i=t.popLast(),s=this.index[e]||new Z(Y.comparator),r=!s.has(i);return this.index[e]=s.add(i),r}has(t){const e=t.lastSegment(),i=t.popLast(),s=this.index[e];return s&&s.has(i)}getEntries(t){return(this.index[t]||new Z(Y.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js=new Uint8Array(0);class zv{constructor(t,e){this.user=t,this.databaseId=e,this.Ye=new Yc,this.Xe=new He(i=>vn(i),(i,s)=>Cs(i,s)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.Ye.has(e)){const i=e.lastSegment(),s=e.popLast();t.addOnCommittedListener(()=>{this.Ye.add(e)});const r={collectionId:i,parent:Ft(s)};return Ph(t).put(r)}return v.resolve()}getCollectionParents(t,e){const i=[],s=IDBKeyRange.bound([e,""],[Vf(e),""],!1,!0);return Ph(t).W(s).next(r=>{for(const o of r){if(o.collectionId!==e)break;i.push(ce(o.parent))}return i})}addFieldIndex(t,e){const i=qs(t),s=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}(e);delete s.indexId;const r=i.add(s);if(e.indexState){const o=vi(t);return r.next(a=>{o.put(Dh(a,this.user,e.indexState.sequenceNumber,e.indexState.offset))})}return r.next()}deleteFieldIndex(t,e){const i=qs(t),s=vi(t),r=bi(t);return i.delete(e.indexId).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}getDocumentsMatchingTarget(t,e){const i=bi(t);let s=!0;const r=new Map;return v.forEach(this.Ze(e),o=>this.tn(t,o).next(a=>{s&&(s=!!a),r.set(o,a)})).next(()=>{if(s){let o=U();const a=[];return v.forEach(r,(c,l)=>{var h;T("IndexedDbIndexManager",`Using index ${h=c,`id=${h.indexId}|cg=${h.collectionGroup}|f=${h.fields.map(w=>`${w.fieldPath}:${w.kind}`).join(",")}`} to execute ${vn(e)}`);const u=function(w,S){const x=Ma(S);if(x===void 0)return null;for(const E of Nr(w,x.fieldPath))switch(E.op){case"array-contains-any":return E.value.arrayValue.values||[];case"array-contains":return[E.value]}return null}(l,c),d=function(w,S){const x=new Map;for(const E of Ze(S))for(const I of Nr(w,E.fieldPath))switch(I.op){case"==":case"in":x.set(E.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return x.set(E.fieldPath.canonicalString(),I.value),Array.from(x.values())}return null}(l,c),f=function(w,S){const x=[];let E=!0;for(const I of Ze(S)){const D=I.kind===0?dh(w,I.fieldPath,w.startAt):fh(w,I.fieldPath,w.startAt);x.push(D.value),E&&(E=D.inclusive)}return new Gn(x,E)}(l,c),g=function(w,S){const x=[];let E=!0;for(const I of Ze(S)){const D=I.kind===0?fh(w,I.fieldPath,w.endAt):dh(w,I.fieldPath,w.endAt);x.push(D.value),E&&(E=D.inclusive)}return new Gn(x,E)}(l,c),p=this.en(c,l,f),m=this.en(c,l,g),y=this.nn(c,l,d),b=this.sn(c.indexId,u,p,f.inclusive,m,g.inclusive,y);return v.forEach(b,w=>i.J(w,e.limit).next(S=>{S.forEach(x=>{const E=C.fromSegments(x.documentKey);o.has(E)||(o=o.add(E),a.push(E))})}))}).next(()=>a)}return v.resolve(null)})}Ze(t){let e=this.Xe.get(t);return e||(t.filters.length===0?e=[t]:e=Vv(X.create(t.filters,"and")).map(i=>Na(t.path,t.collectionGroup,t.orderBy,i.getFilters(),t.limit,t.startAt,t.endAt)),this.Xe.set(t,e),e)}sn(t,e,i,s,r,o,a){const c=(e!=null?e.length:1)*Math.max(i.length,r.length),l=c/(e!=null?e.length:1),h=[];for(let u=0;u<c;++u){const d=e?this.rn(e[u/l]):js,f=this.on(t,d,i[u%l],s),g=this.un(t,d,r[u%l],o),p=a.map(m=>this.on(t,d,m,!0));h.push(...this.createRange(f,g,p))}return h}on(t,e,i,s){const r=new on(t,C.empty(),e,i);return s?r:r.Ue()}un(t,e,i,s){const r=new on(t,C.empty(),e,i);return s?r.Ue():r}tn(t,e){const i=new Fv(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next(r=>{let o=null;for(const a of r)i.je(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let i=2;const s=this.Ze(e);return v.forEach(s,r=>this.tn(t,r).next(o=>{o?i!==0&&o.fields.length<function(a){let c=new Z(pt.comparator),l=!1;for(const h of a.filters)for(const u of h.getFlattenedFilters())u.field.isKeyField()||(u.op==="array-contains"||u.op==="array-contains-any"?l=!0:c=c.add(u.field));for(const h of a.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(r)&&(i=1):i=0})).next(()=>function(r){return r.limit!==null}(e)&&s.length>1&&i===2?1:i)}cn(t,e){const i=new yi;for(const s of Ze(t)){const r=e.data.field(s.fieldPath);if(r==null)return null;const o=i.qe(s.kind);rn.Ie.ue(r,o)}return i.Fe()}rn(t){const e=new yi;return rn.Ie.ue(t,e.qe(0)),e.Fe()}an(t,e){const i=new yi;return rn.Ie.ue(rs(this.databaseId,e),i.qe(function(s){const r=Ze(s);return r.length===0?0:r[r.length-1].kind}(t))),i.Fe()}nn(t,e,i){if(i===null)return[];let s=[];s.push(new yi);let r=0;for(const o of Ze(t)){const a=i[r++];for(const c of s)if(this.hn(e,o.fieldPath)&&os(a))s=this.ln(s,o,a);else{const l=c.qe(o.kind);rn.Ie.ue(a,l)}}return this.fn(s)}en(t,e,i){return this.nn(t,e,i.position)}fn(t){const e=[];for(let i=0;i<t.length;++i)e[i]=t[i].Fe();return e}ln(t,e,i){const s=[...t],r=[];for(const o of i.arrayValue.values||[])for(const a of s){const c=new yi;c.seed(a.Fe()),rn.Ie.ue(o,c.qe(e.kind)),r.push(c)}return r}hn(t,e){return!!t.filters.find(i=>i instanceof j&&i.field.isEqual(e)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(t,e){const i=qs(t),s=vi(t);return(e?i.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):i.W()).next(r=>{const o=[];return v.forEach(r,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(l,h){const u=h?new Lr(h.sequenceNumber,new Wt(wn(h.readTime),new C(ce(h.documentKey)),h.largestBatchId)):Lr.empty(),d=l.fields.map(([f,g])=>new m0(pt.fromServerFormat(f),g));return new Bf(l.indexId,l.collectionGroup,d,u)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((i,s)=>{const r=i.indexState.sequenceNumber-s.indexState.sequenceNumber;return r!==0?r:B(i.collectionGroup,s.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,i){const s=qs(t),r=vi(t);return this.dn(t).next(o=>s.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>v.forEach(a,c=>r.put(Dh(c.indexId,this.user,o,i)))))}updateIndexEntries(t,e){const i=new Map;return v.forEach(e,(s,r)=>{const o=i.get(s.collectionGroup);return(o?v.resolve(o):this.getFieldIndexes(t,s.collectionGroup)).next(a=>(i.set(s.collectionGroup,a),v.forEach(a,c=>this._n(t,s,c).next(l=>{const h=this.wn(r,c);return l.isEqual(h)?v.resolve():this.mn(t,r,c,l,h)}))))})}gn(t,e,i,s){return bi(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.an(i,e.key),documentKey:e.key.path.toArray()})}yn(t,e,i,s){return bi(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.an(i,e.key),e.key.path.toArray()])}_n(t,e,i){const s=bi(t);let r=new Z(Ee);return s.Z({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.an(i,e)])},(o,a)=>{r=r.add(new on(i.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>r)}wn(t,e){let i=new Z(Ee);const s=this.cn(e,t);if(s==null)return i;const r=Ma(e);if(r!=null){const o=t.data.field(r.fieldPath);if(os(o))for(const a of o.arrayValue.values||[])i=i.add(new on(e.indexId,t.key,this.rn(a),s))}else i=i.add(new on(e.indexId,t.key,js,s));return i}mn(t,e,i,s,r){T("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const o=[];return function(a,c,l,h,u){const d=a.getIterator(),f=c.getIterator();let g=On(d),p=On(f);for(;g||p;){let m=!1,y=!1;if(g&&p){const b=l(g,p);b<0?y=!0:b>0&&(m=!0)}else g!=null?y=!0:m=!0;m?(h(p),p=On(f)):y?(u(g),g=On(d)):(g=On(d),p=On(f))}}(s,r,Ee,a=>{o.push(this.gn(t,e,i,a))},a=>{o.push(this.yn(t,e,i,a))}),v.waitFor(o)}dn(t){let e=1;return vi(t).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,r)=>{r.done(),e=s.sequenceNumber+1}).next(()=>e)}createRange(t,e,i){i=i.sort((o,a)=>Ee(o,a)).filter((o,a,c)=>!a||Ee(o,c[a-1])!==0);const s=[];s.push(t);for(const o of i){const a=Ee(o,t),c=Ee(o,e);if(a===0)s[0]=t.Ue();else if(a>0&&c<0)s.push(o),s.push(o.Ue());else if(c>0)break}s.push(e);const r=[];for(let o=0;o<s.length;o+=2){if(this.pn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,js,[]],c=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,js,[]];r.push(IDBKeyRange.bound(a,c))}return r}pn(t,e){return Ee(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Lh)}getMinOffset(t,e){return v.mapArray(this.Ze(e),i=>this.tn(t,i).next(s=>s||M())).next(Lh)}}function Ph(n){return wt(n,"collectionParents")}function bi(n){return wt(n,"indexEntries")}function qs(n){return wt(n,"indexConfiguration")}function vi(n){return wt(n,"indexState")}function Lh(n){P(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let i=1;i<n.length;i++){const s=n[i].indexState.offset;Vc(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new Wt(t.readTime,t.documentKey,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Bt{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new Bt(t,Bt.DEFAULT_COLLECTION_PERCENTILE,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fg(n,t,e){const i=n.store("mutations"),s=n.store("documentMutations"),r=[],o=IDBKeyRange.only(e.batchId);let a=0;const c=i.Z({range:o},(h,u,d)=>(a++,d.delete()));r.push(c.next(()=>{P(a===1)}));const l=[];for(const h of e.mutations){const u=Cg(t,h.key.path,e.batchId);r.push(s.delete(u)),l.push(h.key)}return v.waitFor(r).next(()=>l)}function $r(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw M();t=n.noDocument}return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bt.DEFAULT_COLLECTION_PERCENTILE=10,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bt.DEFAULT=new Bt(41943040,Bt.DEFAULT_COLLECTION_PERCENTILE,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bt.DISABLED=new Bt(-1,0,0);class _o{constructor(t,e,i,s){this.userId=t,this.yt=e,this.indexManager=i,this.referenceDelegate=s,this.In={}}static re(t,e,i,s){P(t.uid!=="");const r=t.isAuthenticated()?t.uid:"";return new _o(r,e,i,s)}checkEmpty(t){let e=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ie(t).Z({index:"userMutationsIndex",range:i},(s,r,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,i,s){const r=Vn(t),o=Ie(t);return o.add({}).next(a=>{P(typeof a=="number");const c=new Hc(a,e,i,s),l=function(d,f,g){const p=g.baseMutations.map(y=>Vr(d.ie,y)),m=g.mutations.map(y=>Vr(d.ie,y));return{userId:f,batchId:g.batchId,localWriteTimeMs:g.localWriteTime.toMillis(),baseMutations:p,mutations:m}}(this.yt,this.userId,c),h=[];let u=new Z((d,f)=>B(d.canonicalString(),f.canonicalString()));for(const d of s){const f=Cg(this.userId,d.key.path,a);u=u.add(d.key.path.popLast()),h.push(o.put(l)),h.push(r.put(f,gv))}return u.forEach(d=>{h.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.In[a]=c.keys()}),v.waitFor(h).next(()=>c)})}lookupMutationBatch(t,e){return Ie(t).get(e).next(i=>i?(P(i.userId===this.userId),sn(this.yt,i)):null)}Tn(t,e){return this.In[e]?v.resolve(this.In[e]):this.lookupMutationBatch(t,e).next(i=>{if(i){const s=i.keys();return this.In[e]=s,s}return null})}getNextMutationBatchAfterBatchId(t,e){const i=e+1,s=IDBKeyRange.lowerBound([this.userId,i]);let r=null;return Ie(t).Z({index:"userMutationsIndex",range:s},(o,a,c)=>{a.userId===this.userId&&(P(a.batchId>=i),r=sn(this.yt,a)),c.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return Ie(t).Z({index:"userMutationsIndex",range:e,reverse:!0},(s,r,o)=>{i=r.batchId,o.done()}).next(()=>i)}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ie(t).W("userMutationsIndex",e).next(i=>i.map(s=>sn(this.yt,s)))}getAllMutationBatchesAffectingDocumentKey(t,e){const i=lr(this.userId,e.path),s=IDBKeyRange.lowerBound(i),r=[];return Vn(t).Z({range:s},(o,a,c)=>{const[l,h,u]=o,d=ce(h);if(l===this.userId&&e.path.isEqual(d))return Ie(t).get(u).next(f=>{if(!f)throw M();P(f.userId===this.userId),r.push(sn(this.yt,f))});c.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Z(B);const s=[];return e.forEach(r=>{const o=lr(this.userId,r.path),a=IDBKeyRange.lowerBound(o),c=Vn(t).Z({range:a},(l,h,u)=>{const[d,f,g]=l,p=ce(f);d===this.userId&&r.path.isEqual(p)?i=i.add(g):u.done()});s.push(c)}),v.waitFor(s).next(()=>this.En(t,i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,s=i.length+1,r=lr(this.userId,i),o=IDBKeyRange.lowerBound(r);let a=new Z(B);return Vn(t).Z({range:o},(c,l,h)=>{const[u,d,f]=c,g=ce(d);u===this.userId&&i.isPrefixOf(g)?g.length===s&&(a=a.add(f)):h.done()}).next(()=>this.En(t,a))}En(t,e){const i=[],s=[];return e.forEach(r=>{s.push(Ie(t).get(r).next(o=>{if(o===null)throw M();P(o.userId===this.userId),i.push(sn(this.yt,o))}))}),v.waitFor(s).next(()=>i)}removeMutationBatch(t,e){return Fg(t.se,this.userId,e).next(i=>(t.addOnCommittedListener(()=>{this.An(e.batchId)}),v.forEach(i,s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))}An(t){delete this.In[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return v.resolve();const i=IDBKeyRange.lowerBound([this.userId]),s=[];return Vn(t).Z({range:i},(r,o,a)=>{if(r[0]===this.userId){const c=ce(r[1]);s.push(c)}else a.done()}).next(()=>{P(s.length===0)})})}containsKey(t,e){return Vg(t,this.userId,e)}Rn(t){return Bg(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Vg(n,t,e){const i=lr(t,e.path),s=i[1],r=IDBKeyRange.lowerBound(i);let o=!1;return Vn(n).Z({range:r,X:!0},(a,c,l)=>{const[h,u,d]=a;h===t&&u===s&&(o=!0),l.done()}).next(()=>o)}function Ie(n){return wt(n,"mutations")}function Vn(n){return wt(n,"documentMutations")}function Bg(n){return wt(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(t){this.bn=t}next(){return this.bn+=2,this.bn}static Pn(){return new _n(0)}static vn(){return new _n(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(t,e){this.referenceDelegate=t,this.yt=e}allocateTargetId(t){return this.Vn(t).next(e=>{const i=new _n(e.highestTargetId);return e.highestTargetId=i.next(),this.Sn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Vn(t).next(e=>L.fromTimestamp(new ht(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Vn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,i){return this.Vn(t).next(s=>(s.highestListenSequenceNumber=e,i&&(s.lastRemoteSnapshotVersion=i.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Sn(t,s)))}addTargetData(t,e){return this.Dn(t,e).next(()=>this.Vn(t).next(i=>(i.targetCount+=1,this.Cn(e,i),this.Sn(t,i))))}updateTargetData(t,e){return this.Dn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Pn(t).delete(e.targetId)).next(()=>this.Vn(t)).next(i=>(P(i.targetCount>0),i.targetCount-=1,this.Sn(t,i)))}removeTargets(t,e,i){let s=0;const r=[];return Pn(t).Z((o,a)=>{const c=Ai(a);c.sequenceNumber<=e&&i.get(c.targetId)===null&&(s++,r.push(this.removeTargetData(t,c)))}).next(()=>v.waitFor(r)).next(()=>s)}forEachTarget(t,e){return Pn(t).Z((i,s)=>{const r=Ai(s);e(r)})}Vn(t){return Nh(t).get("targetGlobalKey").next(e=>(P(e!==null),e))}Sn(t,e){return Nh(t).put("targetGlobalKey",e)}Dn(t,e){return Pn(t).put(Pg(this.yt,e))}Cn(t,e){let i=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,i=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,i=!0),i}getTargetCount(t){return this.Vn(t).next(e=>e.targetCount)}getTargetData(t,e){const i=vn(e),s=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let r=null;return Pn(t).Z({range:s,index:"queryTargetsIndex"},(o,a,c)=>{const l=Ai(a);Cs(e,l.target)&&(r=l,c.done())}).next(()=>r)}addMatchingKeys(t,e,i){const s=[],r=Te(t);return e.forEach(o=>{const a=Ft(o.path);s.push(r.put({targetId:i,path:a})),s.push(this.referenceDelegate.addReference(t,i,o))}),v.waitFor(s)}removeMatchingKeys(t,e,i){const s=Te(t);return v.forEach(e,r=>{const o=Ft(r.path);return v.waitFor([s.delete([i,o]),this.referenceDelegate.removeReference(t,i,r)])})}removeMatchingKeysForTargetId(t,e){const i=Te(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return i.delete(s)}getMatchingKeysForTargetId(t,e){const i=IDBKeyRange.bound([e],[e+1],!1,!0),s=Te(t);let r=U();return s.Z({range:i,X:!0},(o,a,c)=>{const l=ce(o[1]),h=new C(l);r=r.add(h)}).next(()=>r)}containsKey(t,e){const i=Ft(e.path),s=IDBKeyRange.bound([i],[Vf(i)],!1,!0);let r=0;return Te(t).Z({index:"documentTargetsIndex",X:!0,range:s},([o,a],c,l)=>{o!==0&&(r++,l.done())}).next(()=>r>0)}ne(t,e){return Pn(t).get(e).next(i=>i?Ai(i):null)}}function Pn(n){return wt(n,"targets")}function Nh(n){return wt(n,"targetGlobal")}function Te(n){return wt(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fh([n,t],[e,i]){const s=B(n,e);return s===0?B(t,i):s}class Uv{constructor(t){this.xn=t,this.buffer=new Z(Fh),this.Nn=0}kn(){return++this.Nn}On(t){const e=[t,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(e);else{const i=this.buffer.last();Fh(e,i)<0&&(this.buffer=this.buffer.delete(i).add(e))}}get maxValue(){return this.buffer.last()[0]}}class jv{constructor(t,e,i){this.garbageCollector=t,this.asyncQueue=e,this.localStore=i,this.Mn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return this.Mn!==null}Fn(t){T("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){qe(e)?T("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Tn(e)}await this.Fn(3e5)})}}class qv{constructor(t,e){this.$n=t,this.params=e}calculateTargetCount(t,e){return this.$n.Bn(t).next(i=>Math.floor(e/100*i))}nthSequenceNumber(t,e){if(e===0)return v.resolve(Yt.at);const i=new Uv(e);return this.$n.forEachTarget(t,s=>i.On(s.sequenceNumber)).next(()=>this.$n.Ln(t,s=>i.On(s))).next(()=>i.maxValue)}removeTargets(t,e,i){return this.$n.removeTargets(t,e,i)}removeOrphanedDocuments(t,e){return this.$n.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(T("LruGarbageCollector","Garbage collection skipped; disabled"),v.resolve(Rh)):this.getCacheSize(t).next(i=>i<this.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Rh):this.qn(t,e))}getCacheSize(t){return this.$n.getCacheSize(t)}qn(t,e){let i,s,r,o,a,c,l;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(u=>(u>this.params.maximumSequenceNumbersToCollect?(T("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${u}`),s=this.params.maximumSequenceNumbersToCollect):s=u,o=Date.now(),this.nthSequenceNumber(t,s))).next(u=>(i=u,a=Date.now(),this.removeTargets(t,i,e))).next(u=>(r=u,c=Date.now(),this.removeOrphanedDocuments(t,i))).next(u=>(l=Date.now(),Aa()<=G.DEBUG&&T("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${r} targets in `+(c-a)+`ms
	Removed ${u} documents in `+(l-c)+`ms
Total Duration: ${l-h}ms`),v.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:u})))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(t,e){this.db=t,this.garbageCollector=function(i,s){return new qv(i,s)}(this,e)}Bn(t){const e=this.Un(t);return this.db.getTargetCache().getTargetCount(t).next(i=>e.next(s=>i+s))}Un(t){let e=0;return this.Ln(t,i=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Ln(t,e){return this.Kn(t,(i,s)=>e(s))}addReference(t,e,i){return Hs(t,i)}removeReference(t,e,i){return Hs(t,i)}removeTargets(t,e,i){return this.db.getTargetCache().removeTargets(t,e,i)}markPotentiallyOrphaned(t,e){return Hs(t,e)}Gn(t,e){return function(i,s){let r=!1;return Bg(i).tt(o=>Vg(i,o,s).next(a=>(a&&(r=!0),v.resolve(!a)))).next(()=>r)}(t,e)}removeOrphanedDocuments(t,e){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let r=0;return this.Kn(t,(o,a)=>{if(a<=e){const c=this.Gn(t,o).next(l=>{if(!l)return r++,i.getEntry(t,o).next(()=>(i.removeEntry(o,L.min()),Te(t).delete([0,Ft(o.path)])))});s.push(c)}}).next(()=>v.waitFor(s)).next(()=>i.apply(t)).next(()=>r)}removeTarget(t,e){const i=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,i)}updateLimboDocument(t,e){return Hs(t,e)}Kn(t,e){const i=Te(t);let s,r=Yt.at;return i.Z({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:l})=>{o===0?(r!==Yt.at&&e(new C(ce(s)),r),r=l,s=c):r=Yt.at}).next(()=>{r!==Yt.at&&e(new C(ce(s)),r)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Hs(n,t){return Te(n).put(function(e,i){return{targetId:0,path:Ft(e.path),sequenceNumber:i}}(t,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(){this.changes=new He(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,at.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const i=this.changes.get(e);return i!==void 0?v.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(t){this.yt=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,i){return Ke(t).put(i)}removeEntry(t,e,i){return Ke(t).delete(function(s,r){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],Br(r),o[o.length-1]]}(e,i))}updateMetadata(t,e){return this.getMetadata(t).next(i=>(i.byteSize+=e,this.Qn(t,i)))}getEntry(t,e){let i=at.newInvalidDocument(e);return Ke(t).Z({index:"documentKeyIndex",range:IDBKeyRange.only(xi(e))},(s,r)=>{i=this.jn(e,r)}).next(()=>i)}Wn(t,e){let i={size:0,document:at.newInvalidDocument(e)};return Ke(t).Z({index:"documentKeyIndex",range:IDBKeyRange.only(xi(e))},(s,r)=>{i={document:this.jn(e,r),size:$r(r)}}).next(()=>i)}getEntries(t,e){let i=Qt();return this.zn(t,e,(s,r)=>{const o=this.jn(s,r);i=i.insert(s,o)}).next(()=>i)}Hn(t,e){let i=Qt(),s=new yt(C.comparator);return this.zn(t,e,(r,o)=>{const a=this.jn(r,o);i=i.insert(r,a),s=s.insert(r,$r(o))}).next(()=>({documents:i,Jn:s}))}zn(t,e,i){if(e.isEmpty())return v.resolve();let s=new Z(zh);e.forEach(c=>s=s.add(c));const r=IDBKeyRange.bound(xi(s.first()),xi(s.last())),o=s.getIterator();let a=o.getNext();return Ke(t).Z({index:"documentKeyIndex",range:r},(c,l,h)=>{const u=C.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&zh(a,u)<0;)i(a,null),a=o.getNext();a&&a.isEqual(u)&&(i(a,l),a=o.hasNext()?o.getNext():null),a?h.j(xi(a)):h.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(t,e,i){const s=[e.popLast().toArray(),e.lastSegment(),Br(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],r=[e.popLast().toArray(),e.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ke(t).W(IDBKeyRange.bound(s,r,!0)).next(o=>{let a=Qt();for(const c of o){const l=this.jn(C.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);a=a.insert(l.key,l)}return a})}getAllFromCollectionGroup(t,e,i,s){let r=Qt();const o=Bh(e,i),a=Bh(e,Wt.max());return Ke(t).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,l,h)=>{const u=this.jn(C.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);r=r.insert(u.key,u),r.size===s&&h.done()}).next(()=>r)}newChangeBuffer(t){return new Kv(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Vh(t).get("remoteDocumentGlobalKey").next(e=>(P(!!e),e))}Qn(t,e){return Vh(t).put("remoteDocumentGlobalKey",e)}jn(t,e){if(e){const i=Mv(this.yt,e);if(!(i.isNoDocument()&&i.version.isEqual(L.min())))return i}return at.newInvalidDocument(t)}}function $g(n){return new Wv(n)}class Kv extends zg{constructor(t,e){super(),this.Yn=t,this.trackRemovals=e,this.Xn=new He(i=>i.toString(),(i,s)=>i.isEqual(s))}applyChanges(t){const e=[];let i=0,s=new Z((r,o)=>B(r.canonicalString(),o.canonicalString()));return this.changes.forEach((r,o)=>{const a=this.Xn.get(r);if(e.push(this.Yn.removeEntry(t,r,a.readTime)),o.isValidDocument()){const c=Ih(this.Yn.yt,o);s=s.add(r.path.popLast());const l=$r(c);i+=l-a.size,e.push(this.Yn.addEntry(t,r,c))}else if(i-=a.size,this.trackRemovals){const c=Ih(this.Yn.yt,o.convertToNoDocument(L.min()));e.push(this.Yn.addEntry(t,r,c))}}),s.forEach(r=>{e.push(this.Yn.indexManager.addToCollectionParentIndex(t,r))}),e.push(this.Yn.updateMetadata(t,i)),v.waitFor(e)}getFromCache(t,e){return this.Yn.Wn(t,e).next(i=>(this.Xn.set(e,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(t,e){return this.Yn.Hn(t,e).next(({documents:i,Jn:s})=>(s.forEach((r,o)=>{this.Xn.set(r,{size:o,readTime:i.get(r).readTime})}),i))}}function Vh(n){return wt(n,"remoteDocumentGlobal")}function Ke(n){return wt(n,"remoteDocumentsV14")}function xi(n){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Bh(n,t){const e=t.documentKey.path.toArray();return[n,Br(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function zh(n,t){const e=n.path.toArray(),i=t.path.toArray();let s=0;for(let r=0;r<e.length-2&&r<i.length-2;++r)if(s=B(e[r],i[r]),s)return s;return s=B(e.length,i.length),s||(s=B(e[e.length-2],i[i.length-2]),s||B(e[e.length-1],i[i.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gv{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(t,e,i,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=s}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(i=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(i!==null&&$i(i.mutation,s,ve.empty(),ht.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.getLocalViewOfDocuments(t,i,U()).next(()=>i))}getLocalViewOfDocuments(t,e,i=U()){const s=ae();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,i).next(r=>{let o=ki();return r.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){const i=ae();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,U()))}populateOverlays(t,e,i){const s=[];return i.forEach(r=>{e.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(t,s).next(r=>{r.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,i,s){let r=Qt();const o=Ui(),a=Ui();return e.forEach((c,l)=>{const h=i.get(l.key);s.has(l.key)&&(h===void 0||h.mutation instanceof li)?r=r.insert(l.key,l):h!==void 0?(o.set(l.key,h.mutation.getFieldMask()),$i(h.mutation,l,h.mutation.getFieldMask(),ht.now())):o.set(l.key,ve.empty())}),this.recalculateAndSaveOverlays(t,r).next(c=>(c.forEach((l,h)=>o.set(l,h)),e.forEach((l,h)=>{var u;return a.set(l,new Gv(h,(u=o.get(l))!==null&&u!==void 0?u:null))}),a))}recalculateAndSaveOverlays(t,e){const i=Ui();let s=new yt((o,a)=>o-a),r=U();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=e.get(c);if(l===null)return;let h=i.get(c)||ve.empty();h=a.applyToLocalView(l,h),i.set(c,h);const u=(s.get(a.batchId)||U()).add(c);s=s.insert(a.batchId,u)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,h=c.value,u=gg();h.forEach(d=>{if(!r.has(d)){const f=lg(e.get(d),i.get(d));f!==null&&u.set(d,f),r=r.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,l,u))}return v.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(i=>this.recalculateAndSaveOverlays(t,i))}getDocumentsMatchingQuery(t,e,i){return function(s){return C.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):eg(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i):this.getDocumentsMatchingCollectionQuery(t,e,i)}getNextDocuments(t,e,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,s).next(r=>{const o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,s-r.size):v.resolve(ae());let a=-1,c=r;return o.next(l=>v.forEach(l,(h,u)=>(a<u.largestBatchId&&(a=u.largestBatchId),r.get(h)?v.resolve():this.remoteDocumentCache.getEntry(t,h).next(d=>{c=c.insert(h,d)}))).next(()=>this.populateOverlays(t,l,r)).next(()=>this.computeViews(t,c,l,U())).next(h=>({batchId:a,changes:Y0(h)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new C(e)).next(i=>{let s=ki();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,i){const s=e.collectionGroup;let r=ki();return this.indexManager.getCollectionParents(t,s).next(o=>v.forEach(o,a=>{const c=function(l,h){return new ks(h,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e,a.child(s));return this.getDocumentsMatchingCollectionQuery(t,c,i).next(l=>{l.forEach((h,u)=>{r=r.insert(h,u)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(t,e,i){let s;return this.remoteDocumentCache.getAllFromCollection(t,e.path,i).next(r=>(s=r,this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId))).next(r=>{r.forEach((a,c)=>{const l=c.getKey();s.get(l)===null&&(s=s.insert(l,at.newInvalidDocument(l)))});let o=ki();return s.forEach((a,c)=>{const l=r.get(a);l!==void 0&&$i(l.mutation,c,ve.empty(),ht.now()),Uc(e,c)&&(o=o.insert(a,c))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yv{constructor(t){this.yt=t,this.Zn=new Map,this.ts=new Map}getBundleMetadata(t,e){return v.resolve(this.Zn.get(e))}saveBundleMetadata(t,e){var i;return this.Zn.set(e.id,{id:(i=e).id,version:i.version,createTime:Nt(i.createTime)}),v.resolve()}getNamedQuery(t,e){return v.resolve(this.ts.get(e))}saveNamedQuery(t,e){return this.ts.set(e.name,function(i){return{name:i.name,query:Lg(i.bundledQuery),readTime:Nt(i.readTime)}}(e)),v.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv{constructor(){this.overlays=new yt(C.comparator),this.es=new Map}getOverlay(t,e){return v.resolve(this.overlays.get(e))}getOverlays(t,e){const i=ae();return v.forEach(e,s=>this.getOverlay(t,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(t,e,i){return i.forEach((s,r)=>{this.oe(t,e,r)}),v.resolve()}removeOverlaysForBatchId(t,e,i){const s=this.es.get(i);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.es.delete(i)),v.resolve()}getOverlaysForCollection(t,e,i){const s=ae(),r=e.length+1,o=new C(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!e.isPrefixOf(l.path))break;l.path.length===r&&c.largestBatchId>i&&s.set(c.getKey(),c)}return v.resolve(s)}getOverlaysForCollectionGroup(t,e,i,s){let r=new yt((l,h)=>l-h);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===e&&l.largestBatchId>i){let h=r.get(l.largestBatchId);h===null&&(h=ae(),r=r.insert(l.largestBatchId,h)),h.set(l.getKey(),l)}}const a=ae(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,h)=>a.set(l,h)),!(a.size()>=s)););return v.resolve(a)}oe(t,e,i){const s=this.overlays.get(i.key);if(s!==null){const o=this.es.get(s.largestBatchId).delete(i.key);this.es.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Kc(e,i));let r=this.es.get(e);r===void 0&&(r=U(),this.es.set(e,r)),this.es.set(e,r.add(i.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(){this.ns=new Z(bt.ss),this.rs=new Z(bt.os)}isEmpty(){return this.ns.isEmpty()}addReference(t,e){const i=new bt(t,e);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(t,e){t.forEach(i=>this.addReference(i,e))}removeReference(t,e){this.cs(new bt(t,e))}hs(t,e){t.forEach(i=>this.removeReference(i,e))}ls(t){const e=new C(new Y([])),i=new bt(e,t),s=new bt(e,t+1),r=[];return this.rs.forEachInRange([i,s],o=>{this.cs(o),r.push(o.key)}),r}fs(){this.ns.forEach(t=>this.cs(t))}cs(t){this.ns=this.ns.delete(t),this.rs=this.rs.delete(t)}ds(t){const e=new C(new Y([])),i=new bt(e,t),s=new bt(e,t+1);let r=U();return this.rs.forEachInRange([i,s],o=>{r=r.add(o.key)}),r}containsKey(t){const e=new bt(t,0),i=this.ns.firstAfterOrEqual(e);return i!==null&&t.isEqual(i.key)}}class bt{constructor(t,e){this.key=t,this._s=e}static ss(t,e){return C.comparator(t.key,e.key)||B(t._s,e._s)}static os(t,e){return B(t._s,e._s)||C.comparator(t.key,e.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xv{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.ws=1,this.gs=new Z(bt.ss)}checkEmpty(t){return v.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,i,s){const r=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Hc(r,e,i,s);this.mutationQueue.push(o);for(const a of s)this.gs=this.gs.add(new bt(a.key,r)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return v.resolve(o)}lookupMutationBatch(t,e){return v.resolve(this.ys(e))}getNextMutationBatchAfterBatchId(t,e){const i=e+1,s=this.ps(i),r=s<0?0:s;return v.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return v.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(t){return v.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const i=new bt(e,0),s=new bt(e,Number.POSITIVE_INFINITY),r=[];return this.gs.forEachInRange([i,s],o=>{const a=this.ys(o._s);r.push(a)}),v.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Z(B);return e.forEach(s=>{const r=new bt(s,0),o=new bt(s,Number.POSITIVE_INFINITY);this.gs.forEachInRange([r,o],a=>{i=i.add(a._s)})}),v.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,s=i.length+1;let r=i;C.isDocumentKey(r)||(r=r.child(""));const o=new bt(new C(r),0);let a=new Z(B);return this.gs.forEachWhile(c=>{const l=c.key.path;return!!i.isPrefixOf(l)&&(l.length===s&&(a=a.add(c._s)),!0)},o),v.resolve(this.Is(a))}Is(t){const e=[];return t.forEach(i=>{const s=this.ys(i);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){P(this.Ts(e.batchId,"removed")===0),this.mutationQueue.shift();let i=this.gs;return v.forEach(e.mutations,s=>{const r=new bt(s.key,e.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.gs=i})}An(t){}containsKey(t,e){const i=new bt(e,0),s=this.gs.firstAfterOrEqual(i);return v.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,v.resolve()}Ts(t,e){return this.ps(t)}ps(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}ys(t){const e=this.ps(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(t){this.Es=t,this.docs=new yt(C.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const i=e.key,s=this.docs.get(i),r=s?s.size:0,o=this.Es(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const i=this.docs.get(e);return v.resolve(i?i.document.mutableCopy():at.newInvalidDocument(e))}getEntries(t,e){let i=Qt();return e.forEach(s=>{const r=this.docs.get(s);i=i.insert(s,r?r.document.mutableCopy():at.newInvalidDocument(s))}),v.resolve(i)}getAllFromCollection(t,e,i){let s=Qt();const r=new C(e.child("")),o=this.docs.getIteratorFrom(r);for(;o.hasNext();){const{key:a,value:{document:c}}=o.getNext();if(!e.isPrefixOf(a.path))break;a.path.length>e.length+1||Vc(zf(c),i)<=0||(s=s.insert(c.key,c.mutableCopy()))}return v.resolve(s)}getAllFromCollectionGroup(t,e,i,s){M()}As(t,e){return v.forEach(this.docs,i=>e(i))}newChangeBuffer(t){return new Zv(this)}getSize(t){return v.resolve(this.size)}}class Zv extends zg{constructor(t){super(),this.Yn=t}applyChanges(t){const e=[];return this.changes.forEach((i,s)=>{s.isValidDocument()?e.push(this.Yn.addEntry(t,s)):this.Yn.removeEntry(i)}),v.waitFor(e)}getFromCache(t,e){return this.Yn.getEntry(t,e)}getAllFromCache(t,e){return this.Yn.getEntries(t,e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx{constructor(t){this.persistence=t,this.Rs=new He(e=>vn(e),Cs),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Qc,this.targetCount=0,this.vs=_n.Pn()}forEachTarget(t,e){return this.Rs.forEach((i,s)=>e(s)),v.resolve()}getLastRemoteSnapshotVersion(t){return v.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return v.resolve(this.bs)}allocateTargetId(t){return this.highestTargetId=this.vs.next(),v.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.bs&&(this.bs=e),v.resolve()}Dn(t){this.Rs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.vs=new _n(e),this.highestTargetId=e),t.sequenceNumber>this.bs&&(this.bs=t.sequenceNumber)}addTargetData(t,e){return this.Dn(e),this.targetCount+=1,v.resolve()}updateTargetData(t,e){return this.Dn(e),v.resolve()}removeTargetData(t,e){return this.Rs.delete(e.target),this.Ps.ls(e.targetId),this.targetCount-=1,v.resolve()}removeTargets(t,e,i){let s=0;const r=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=e&&i.get(a.targetId)===null&&(this.Rs.delete(o),r.push(this.removeMatchingKeysForTargetId(t,a.targetId)),s++)}),v.waitFor(r).next(()=>s)}getTargetCount(t){return v.resolve(this.targetCount)}getTargetData(t,e){const i=this.Rs.get(e)||null;return v.resolve(i)}addMatchingKeys(t,e,i){return this.Ps.us(e,i),v.resolve()}removeMatchingKeys(t,e,i){this.Ps.hs(e,i);const s=this.persistence.referenceDelegate,r=[];return s&&e.forEach(o=>{r.push(s.markPotentiallyOrphaned(t,o))}),v.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.Ps.ls(e),v.resolve()}getMatchingKeysForTargetId(t,e){const i=this.Ps.ds(e);return v.resolve(i)}containsKey(t,e){return v.resolve(this.Ps.containsKey(e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(t,e){this.Vs={},this.overlays={},this.Ss=new Yt(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=t(this),this.Cs=new tx(this),this.indexManager=new Bv,this.remoteDocumentCache=function(i){return new Jv(i)}(i=>this.referenceDelegate.xs(i)),this.yt=new Og(e),this.Ns=new Yv(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Qv,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.Vs[t.toKey()];return i||(i=new Xv(e,this.referenceDelegate),this.Vs[t.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(t,e,i){T("MemoryPersistence","Starting transaction:",t);const s=new ex(this.Ss.next());return this.referenceDelegate.ks(),i(s).next(r=>this.referenceDelegate.Os(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Ms(t,e){return v.or(Object.values(this.Vs).map(i=>()=>i.containsKey(t,e)))}}class ex extends Uf{constructor(t){super(),this.currentSequenceNumber=t}}class So{constructor(t){this.persistence=t,this.Fs=new Qc,this.$s=null}static Bs(t){return new So(t)}get Ls(){if(this.$s)return this.$s;throw M()}addReference(t,e,i){return this.Fs.addReference(i,e),this.Ls.delete(i.toString()),v.resolve()}removeReference(t,e,i){return this.Fs.removeReference(i,e),this.Ls.add(i.toString()),v.resolve()}markPotentiallyOrphaned(t,e){return this.Ls.add(e.toString()),v.resolve()}removeTarget(t,e){this.Fs.ls(e.targetId).forEach(s=>this.Ls.add(s.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(r=>this.Ls.add(r.toString()))}).next(()=>i.removeTargetData(t,e))}ks(){this.$s=new Set}Os(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return v.forEach(this.Ls,i=>{const s=C.fromPath(i);return this.qs(t,s).next(r=>{r||e.removeEntry(s,L.min())})}).next(()=>(this.$s=null,e.apply(t)))}updateLimboDocument(t,e){return this.qs(t,e).next(i=>{i?this.Ls.delete(e.toString()):this.Ls.add(e.toString())})}xs(t){return 0}qs(t,e){return v.or([()=>v.resolve(this.Fs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ms(t,e)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nx{constructor(t){this.yt=t}$(t,e,i,s){const r=new po("createOrUpgrade",e);i<1&&s>=1&&(function(a){a.createObjectStore("owner")}(t),function(a){a.createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Eh,{unique:!0}),a.createObjectStore("documentMutations")}(t),$h(t),function(a){a.createObjectStore("remoteDocuments")}(t));let o=v.resolve();return i<3&&s>=3&&(i!==0&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(t),$h(t)),o=o.next(()=>function(a){const c=a.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:L.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(r))),i<4&&s>=4&&(i!==0&&(o=o.next(()=>function(a,c){return c.store("mutations").W().next(l=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Eh,{unique:!0});const h=c.store("mutations"),u=l.map(d=>h.put(d));return v.waitFor(u)})}(t,r))),o=o.next(()=>{(function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),i<5&&s>=5&&(o=o.next(()=>this.Us(r))),i<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(t),this.Ks(r)))),i<7&&s>=7&&(o=o.next(()=>this.Gs(r))),i<8&&s>=8&&(o=o.next(()=>this.Qs(t,r))),i<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(t)})),i<10&&s>=10&&(o=o.next(()=>this.js(r))),i<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),i<12&&s>=12&&(o=o.next(()=>{(function(a){const c=a.createObjectStore("documentOverlays",{keyPath:Tv});c.createIndex("collectionPathOverlayIndex",Dv,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Cv,{unique:!1})})(t)})),i<13&&s>=13&&(o=o.next(()=>function(a){const c=a.createObjectStore("remoteDocumentsV14",{keyPath:pv});c.createIndex("documentKeyIndex",mv),c.createIndex("collectionGroupIndex",yv)}(t)).next(()=>this.Ws(t,r)).next(()=>t.deleteObjectStore("remoteDocuments"))),i<14&&s>=14&&(o=o.next(()=>this.zs(t,r))),i<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:_v}).createIndex("sequenceNumberIndex",Sv,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:Ev}).createIndex("documentKeyIndex",Iv,{unique:!1})}(t))),o}Ks(t){let e=0;return t.store("remoteDocuments").Z((i,s)=>{e+=$r(s)}).next(()=>{const i={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Us(t){const e=t.store("mutationQueues"),i=t.store("mutations");return e.W().next(s=>v.forEach(s,r=>{const o=IDBKeyRange.bound([r.userId,-1],[r.userId,r.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",o).next(a=>v.forEach(a,c=>{P(c.userId===r.userId);const l=sn(this.yt,c);return Fg(t,r.userId,l).next(()=>{})}))}))}Gs(t){const e=t.store("targetDocuments"),i=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(s=>{const r=[];return i.Z((o,a)=>{const c=new Y(o),l=function(h){return[0,Ft(h)]}(c);r.push(e.get(l).next(h=>h?v.resolve():(u=>e.put({targetId:0,path:Ft(u),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>v.waitFor(r))})}Qs(t,e){t.createObjectStore("collectionParents",{keyPath:wv});const i=e.store("collectionParents"),s=new Yc,r=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:Ft(c)})}};return e.store("remoteDocuments").Z({X:!0},(o,a)=>{const c=new Y(o);return r(c.popLast())}).next(()=>e.store("documentMutations").Z({X:!0},([o,a,c],l)=>{const h=ce(a);return r(h.popLast())}))}js(t){const e=t.store("targets");return e.Z((i,s)=>{const r=Ai(s),o=Pg(this.yt,r);return e.put(o)})}Ws(t,e){const i=e.store("remoteDocuments"),s=[];return i.Z((r,o)=>{const a=e.store("remoteDocumentsV14"),c=(l=o,l.document?new C(Y.fromString(l.document.name).popFirst(5)):l.noDocument?C.fromSegments(l.noDocument.path):l.unknownDocument?C.fromSegments(l.unknownDocument.path):M()).path.toArray();var l;/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(h))}).next(()=>v.waitFor(s))}zs(t,e){const i=e.store("mutations"),s=$g(this.yt),r=new jg(So.Bs,this.yt.ie);return i.W().next(o=>{const a=new Map;return o.forEach(c=>{var l;let h=(l=a.get(c.userId))!==null&&l!==void 0?l:U();sn(this.yt,c).keys().forEach(u=>h=h.add(u)),a.set(c.userId,h)}),v.forEach(a,(c,l)=>{const h=new St(l),u=wo.re(this.yt,h),d=r.getIndexManager(h),f=_o.re(h,this.yt,d,r.referenceDelegate);return new Ug(s,f,u,d).recalculateAndSaveOverlaysForDocumentKeys(new ja(e,Yt.at),c).next()})})}}function $h(n){n.createObjectStore("targetDocuments",{keyPath:vv}).createIndex("documentTargetsIndex",xv,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",bv,{unique:!0}),n.createObjectStore("targetGlobal")}const Jo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Xc{constructor(t,e,i,s,r,o,a,c,l,h,u=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=i,this.Hs=r,this.window=o,this.document=a,this.Js=l,this.Ys=h,this.Xs=u,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!Xc.C())throw new k(_.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Hv(this,s),this.ii=e+"main",this.yt=new Og(c),this.ri=new be(this.ii,this.Xs,new nx(this.yt)),this.Cs=new $v(this.referenceDelegate,this.yt),this.remoteDocumentCache=$g(this.yt),this.Ns=new Ov,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,h===!1&&Lt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(_.FAILED_PRECONDITION,Jo);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Cs.getHighestSequenceNumber(t))}).then(t=>{this.Ss=new Yt(t,this.Js)}).then(()=>{this.Ds=!0}).catch(t=>(this.ri&&this.ri.close(),Promise.reject(t)))}li(t){return this.si=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ri.L(async e=>{e.newVersion===null&&await t()})}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Ws(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(t)).next(e=>this.isPrimary&&!e?this._i(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(t=>{if(qe(t))return T("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return T("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Hs.enqueueRetryable(()=>this.si(t)),this.isPrimary=t})}fi(t){return wi(t).get("owner").next(e=>v.resolve(this.mi(e)))}gi(t){return Ws(t).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const i=wt(e,"clientMetadata");return i.W().next(s=>{const r=this.Ii(s,18e5),o=s.filter(a=>r.indexOf(a)===-1);return v.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.oi)for(const e of t)this.oi.removeItem(this.Ti(e.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(t){return!!t&&t.ownerId===this.clientId}di(t){return this.Ys?v.resolve(!0):wi(t).get("owner").next(e=>{if(e!==null&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)){if(this.mi(e)&&this.networkEnabled)return!0;if(!this.mi(e)){if(!e.allowTabSynchronization)throw new k(_.FAILED_PRECONDITION,Jo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ws(t).W().next(i=>this.Ii(i,5e3).find(s=>{if(this.clientId!==s.clientId){const r=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(r||o&&a)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&T("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const e=new ja(t,Yt.at);return this._i(e).next(()=>this.gi(e))}),this.ri.close(),this.Pi()}Ii(t,e){return t.filter(i=>this.pi(i.updateTimeMs,e)&&!this.Ei(i.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",t=>Ws(t).W().next(e=>this.Ii(e,18e5).map(i=>i.clientId)))}get started(){return this.Ds}getMutationQueue(t,e){return _o.re(t,this.yt,e,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new zv(t,this.yt.ie.databaseId)}getDocumentOverlayCache(t){return wo.re(this.yt,t)}getBundleCache(){return this.Ns}runTransaction(t,e,i){T("IndexedDbPersistence","Starting transaction:",t);const s=e==="readonly"?"readonly":"readwrite",r=(o=this.Xs)===15?Av:o===14?Mg:o===13?Ag:o===12?kv:o===11?kg:void M();var o;let a;return this.ri.runTransaction(t,s,r,c=>(a=new ja(c,this.Ss?this.Ss.next():Yt.at),e==="readwrite-primary"?this.fi(a).next(l=>!!l||this.di(a)).next(l=>{if(!l)throw Lt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new k(_.FAILED_PRECONDITION,$f);return i(a)}).next(l=>this.wi(a).next(()=>l)):this.Vi(a).next(()=>i(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Vi(t){return wi(t).get("owner").next(e=>{if(e!==null&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new k(_.FAILED_PRECONDITION,Jo)})}wi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return wi(t).put("owner",e)}static C(){return be.C()}_i(t){const e=wi(t);return e.get("owner").next(i=>this.mi(i)?(T("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):v.resolve())}pi(t,e){const i=Date.now();return!(t<i-e)&&(!(t>i)||(Lt(`Detected an update time that is in the future: ${t} > ${i}`),!1))}ci(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground=this.document.visibilityState==="visible")}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Zs=()=>{this.Ai(),qm()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(t){var e;try{const i=((e=this.oi)===null||e===void 0?void 0:e.getItem(this.Ti(t)))!==null;return T("IndexedDbPersistence",`Client '${t}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return Lt("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(t){Lt("Failed to set zombie client id.",t)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function wi(n){return wt(n,"owner")}function Ws(n){return wt(n,"clientMetadata")}function ix(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(t,e,i,s){this.targetId=t,this.fromCache=e,this.Si=i,this.Di=s}static Ci(t,e){let i=U(),s=U();for(const r of e.docChanges)switch(r.type){case 0:i=i.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Jc(t,e.fromCache,i,s)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg{constructor(){this.xi=!1}initialize(t,e){this.Ni=t,this.indexManager=e,this.xi=!0}getDocumentsMatchingQuery(t,e,i,s){return this.ki(t,e).next(r=>r||this.Oi(t,e,s,i)).next(r=>r||this.Mi(t,e))}ki(t,e){if(gh(e))return v.resolve(null);let i=ne(e);return this.indexManager.getIndexType(t,i).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Va(e,null,"F"),i=ne(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next(r=>{const o=U(...r);return this.Ni.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,i).next(c=>{const l=this.Fi(e,a);return this.$i(e,l,o,c.readTime)?this.ki(t,Va(e,null,"F")):this.Bi(t,l,e,c)}))})))}Oi(t,e,i,s){return gh(e)||s.isEqual(L.min())?this.Mi(t,e):this.Ni.getDocuments(t,i).next(r=>{const o=this.Fi(e,r);return this.$i(e,o,i,s)?this.Mi(t,e):(Aa()<=G.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ba(e)),this.Bi(t,o,e,y0(s,-1)))})}Fi(t,e){let i=new Z(ig(t));return e.forEach((s,r)=>{Uc(t,r)&&(i=i.add(r))}),i}$i(t,e,i,s){if(t.limit===null)return!1;if(i.size!==e.size)return!0;const r=t.limitType==="F"?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Mi(t,e){return Aa()<=G.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",Ba(e)),this.Ni.getDocumentsMatchingQuery(t,e,Wt.min())}Bi(t,e,i,s){return this.Ni.getDocumentsMatchingQuery(t,i,s).next(r=>(e.forEach(o=>{r=r.insert(o.key,o)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(t,e,i,s){this.persistence=t,this.Li=e,this.yt=s,this.qi=new yt(B),this.Ui=new He(r=>vn(r),Cs),this.Ki=new Map,this.Gi=t.getRemoteDocumentCache(),this.Cs=t.getTargetCache(),this.Ns=t.getBundleCache(),this.Qi(i)}Qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ug(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.qi))}}function Hg(n,t,e,i){return new sx(n,t,e,i)}async function Wg(n,t){const e=V(n);return await e.persistence.runTransaction("Handle user change","readonly",i=>{let s;return e.mutationQueue.getAllMutationBatches(i).next(r=>(s=r,e.Qi(t),e.mutationQueue.getAllMutationBatches(i))).next(r=>{const o=[],a=[];let c=U();for(const l of s){o.push(l.batchId);for(const h of l.mutations)c=c.add(h.key)}for(const l of r){a.push(l.batchId);for(const h of l.mutations)c=c.add(h.key)}return e.localDocuments.getDocuments(i,c).next(l=>({ji:l,removedBatchIds:o,addedBatchIds:a}))})})}function rx(n,t){const e=V(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const s=t.batch.keys(),r=e.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,c,l){const h=c.batch,u=h.keys();let d=v.resolve();return u.forEach(f=>{d=d.next(()=>l.getEntry(a,f)).next(g=>{const p=c.docVersions.get(f);P(p!==null),g.version.compareTo(p)<0&&(h.applyToRemoteDocument(g,c),g.isValidDocument()&&(g.setReadTime(c.commitVersion),l.addEntry(g)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,h))}(e,i,t,r).next(()=>r.apply(i)).next(()=>e.mutationQueue.performConsistencyCheck(i)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(i,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let a=U();for(let c=0;c<o.mutationResults.length;++c)o.mutationResults[c].transformResults.length>0&&(a=a.add(o.batch.mutations[c].key));return a}(t))).next(()=>e.localDocuments.getDocuments(i,s))})}function Kg(n){const t=V(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Cs.getLastRemoteSnapshotVersion(e))}function ox(n,t){const e=V(n),i=t.snapshotVersion;let s=e.qi;return e.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=e.Gi.newChangeBuffer({trackRemovals:!0});s=e.qi;const a=[];t.targetChanges.forEach((h,u)=>{const d=s.get(u);if(!d)return;a.push(e.Cs.removeMatchingKeys(r,h.removedDocuments,u).next(()=>e.Cs.addMatchingKeys(r,h.addedDocuments,u)));let f=d.withSequenceNumber(r.currentSequenceNumber);t.targetMismatches.has(u)?f=f.withResumeToken(Tt.EMPTY_BYTE_STRING,L.min()).withLastLimboFreeSnapshotVersion(L.min()):h.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(h.resumeToken,i)),s=s.insert(u,f),function(g,p,m){return g.resumeToken.approximateByteSize()===0||p.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8?!0:m.addedDocuments.size+m.modifiedDocuments.size+m.removedDocuments.size>0}(d,f,h)&&a.push(e.Cs.updateTargetData(r,f))});let c=Qt(),l=U();if(t.documentUpdates.forEach(h=>{t.resolvedLimboDocuments.has(h)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(r,h))}),a.push(ax(r,o,t.documentUpdates).next(h=>{c=h.Wi,l=h.zi})),!i.isEqual(L.min())){const h=e.Cs.getLastRemoteSnapshotVersion(r).next(u=>e.Cs.setTargetsMetadata(r,r.currentSequenceNumber,i));a.push(h)}return v.waitFor(a).next(()=>o.apply(r)).next(()=>e.localDocuments.getLocalViewOfDocuments(r,c,l)).next(()=>c)}).then(r=>(e.qi=s,r))}function ax(n,t,e){let i=U(),s=U();return e.forEach(r=>i=i.add(r)),t.getEntries(n,i).next(r=>{let o=Qt();return e.forEach((a,c)=>{const l=r.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(L.min())?(t.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(t.addEntry(c),o=o.insert(a,c)):T("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Wi:o,zi:s}})}function cx(n,t){const e=V(n);return e.persistence.runTransaction("Get next mutation batch","readonly",i=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t)))}function lx(n,t){const e=V(n);return e.persistence.runTransaction("Allocate target","readwrite",i=>{let s;return e.Cs.getTargetData(i,t).next(r=>r?(s=r,v.resolve(s)):e.Cs.allocateTargetId(i).next(o=>(s=new Le(t,o,0,i.currentSequenceNumber),e.Cs.addTargetData(i,s).next(()=>s))))}).then(i=>{const s=e.qi.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.qi=e.qi.insert(i.targetId,i),e.Ui.set(t,i.targetId)),i})}async function Ka(n,t,e){const i=V(n),s=i.qi.get(t),r=e?"readwrite":"readwrite-primary";try{e||await i.persistence.runTransaction("Release target",r,o=>i.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!qe(o))throw o;T("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}i.qi=i.qi.remove(t),i.Ui.delete(s.target)}function Uh(n,t,e){const i=V(n);let s=L.min(),r=U();return i.persistence.runTransaction("Execute query","readonly",o=>function(a,c,l){const h=V(a),u=h.Ui.get(l);return u!==void 0?v.resolve(h.qi.get(u)):h.Cs.getTargetData(c,l)}(i,o,ne(t)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(o,a.targetId).next(c=>{r=c})}).next(()=>i.Li.getDocumentsMatchingQuery(o,t,e?s:L.min(),e?r:U())).next(a=>(hx(i,N0(t),a),{documents:a,Hi:r})))}function hx(n,t,e){let i=n.Ki.get(t)||L.min();e.forEach((s,r)=>{r.readTime.compareTo(i)>0&&(i=r.readTime)}),n.Ki.set(t,i)}class jh{constructor(){this.activeTargetIds=pg()}er(t){this.activeTargetIds=this.activeTargetIds.add(t)}nr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}tr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Gg{constructor(){this.Lr=new jh,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t){return this.Lr.er(t),this.qr[t]||"not-current"}updateQueryState(t,e,i){this.qr[t]=e}removeLocalQueryTarget(t){this.Lr.nr(t)}isLocalQueryTarget(t){return this.Lr.activeTargetIds.has(t)}clearQueryState(t){delete this.qr[t]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(t){return this.Lr.activeTargetIds.has(t)}start(){return this.Lr=new jh,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ux{Ur(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(t){this.Wr.push(t)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){T("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Wr)t(0)}jr(){T("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Wr)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dx={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(t){this.Hr=t.Hr,this.Jr=t.Jr}Yr(t){this.Xr=t}Zr(t){this.eo=t}onMessage(t){this.no=t}close(){this.Jr()}send(t){this.Hr(t)}so(){this.Xr()}io(t){this.eo(t)}ro(t){this.no(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.oo=e+"://"+t.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(t,e,i,s,r){const o=this.ho(t,e);T("RestConnection","Sending: ",o,i);const a={};return this.lo(a,s,r),this.fo(t,o,a,i).then(c=>(T("RestConnection","Received: ",c),c),c=>{throw Pr("RestConnection",`${t} failed with error: `,c,"url: ",o,"request:",i),c})}_o(t,e,i,s,r,o){return this.ao(t,e,i,s,r)}lo(t,e,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+ci,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,r)=>t[r]=s),i&&i.headers.forEach((s,r)=>t[r]=s)}ho(t,e){const i=dx[t];return`${this.oo}/v1/${e}:${i}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}fo(t,e,i,s){return new Promise((r,o)=>{const a=new o0;a.setWithCredentials(!0),a.listenOnce(i0.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Yo.NO_ERROR:const l=a.getResponseJson();T("Connection","XHR received:",JSON.stringify(l)),r(l);break;case Yo.TIMEOUT:T("Connection",'RPC "'+t+'" timed out'),o(new k(_.DEADLINE_EXCEEDED,"Request time out"));break;case Yo.HTTP_ERROR:const h=a.getStatus();if(T("Connection",'RPC "'+t+'" failed with status:',h,"response text:",a.getResponseText()),h>0){let u=a.getResponseJson();Array.isArray(u)&&(u=u[0]);const d=u==null?void 0:u.error;if(d&&d.status&&d.message){const f=function(g){const p=g.toLowerCase().replace(/_/g,"-");return Object.values(_).indexOf(p)>=0?p:_.UNKNOWN}(d.status);o(new k(f,d.message))}else o(new k(_.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new k(_.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{T("Connection",'RPC "'+t+'" completed.')}});const c=JSON.stringify(s);a.send(e,"POST",c,i,15)})}wo(t,e,i){const s=[this.oo,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=e0(),o=n0(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new r0({})),this.lo(a.initMessageHeaders,e,i),a.encodeInitMessageHeaders=!0;const c=s.join("");T("Connection","Creating WebChannel: "+c,a);const l=r.createWebChannel(c,a);let h=!1,u=!1;const d=new fx({Hr:g=>{u?T("Connection","Not sending because WebChannel is closed:",g):(h||(T("Connection","Opening WebChannel transport."),l.open(),h=!0),T("Connection","WebChannel sending:",g),l.send(g))},Jr:()=>l.close()}),f=(g,p,m)=>{g.listen(p,y=>{try{m(y)}catch(b){setTimeout(()=>{throw b},0)}})};return f(l,$s.EventType.OPEN,()=>{u||T("Connection","WebChannel transport opened.")}),f(l,$s.EventType.CLOSE,()=>{u||(u=!0,T("Connection","WebChannel transport closed"),d.io())}),f(l,$s.EventType.ERROR,g=>{u||(u=!0,Pr("Connection","WebChannel transport errored:",g),d.io(new k(_.UNAVAILABLE,"The operation could not be completed")))}),f(l,$s.EventType.MESSAGE,g=>{var p;if(!u){const m=g.data[0];P(!!m);const y=m,b=y.error||((p=y[0])===null||p===void 0?void 0:p.error);if(b){T("Connection","WebChannel received error:",b);const w=b.status;let S=function(E){const I=gt[E];if(I!==void 0)return dg(I)}(w),x=b.message;S===void 0&&(S=_.INTERNAL,x="Unknown error status: "+w+" with message "+b.message),u=!0,d.io(new k(S,x)),l.close()}else T("Connection","WebChannel received:",m),d.ro(m)}}),f(o,s0.STAT_EVENT,g=>{g.stat===th.PROXY?T("Connection","Detected buffering proxy"):g.stat===th.NOPROXY&&T("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function px(){return typeof window<"u"?window:null}function hr(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eo(n){return new iv(n,!0)}class Yg{constructor(t,e,i=1e3,s=1.5,r=6e4){this.Hs=t,this.timerId=e,this.mo=i,this.yo=s,this.po=r,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(t){this.cancel();const e=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),s=Math.max(0,e-i);s>0&&T("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,s,()=>(this.Eo=Date.now(),t())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(t,e,i,s,r,o,a,c){this.Hs=t,this.vo=i,this.Vo=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Yg(t,e)}No(){return this.state===1||this.state===5||this.ko()}ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&this.Do===null&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(t){this.Lo(),this.stream.send(t)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(t,e){this.Lo(),this.qo(),this.xo.cancel(),this.So++,t!==4?this.xo.reset():e&&e.code===_.RESOURCE_EXHAUSTED?(Lt(e.toString()),Lt("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):e&&e.code===_.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Uo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Zr(e)}Uo(){}auth(){this.state=1;const t=this.Ko(this.So),e=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,s])=>{this.So===e&&this.Go(i,s)},i=>{t(()=>{const s=new k(_.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(s)})})}Go(t,e){const i=this.Ko(this.So);this.stream=this.jo(t,e),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(s=>{i(()=>this.Qo(s))}),this.stream.onMessage(s=>{i(()=>this.onMessage(s))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(t){return T("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Ko(t){return e=>{this.Hs.enqueueAndForget(()=>this.So===t?e():(T("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class mx extends Qg{constructor(t,e,i,s,r,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,s,o),this.yt=r}jo(t,e){return this.connection.wo("Listen",t,e)}onMessage(t){this.xo.reset();const e=ov(this.yt,t),i=function(s){if(!("targetChange"in s))return L.min();const r=s.targetChange;return r.targetIds&&r.targetIds.length?L.min():r.readTime?Nt(r.readTime):L.min()}(t);return this.listener.Wo(e,i)}zo(t){const e={};e.database=$a(this.yt),e.addTarget=function(s,r){let o;const a=r.target;return o=Rr(a)?{documents:_g(s,a)}:{query:Sg(s,a)},o.targetId=r.targetId,r.resumeToken.approximateByteSize()>0?o.resumeToken=bg(s,r.resumeToken):r.snapshotVersion.compareTo(L.min())>0&&(o.readTime=Jn(s,r.snapshotVersion.toTimestamp())),o}(this.yt,t);const i=cv(this.yt,t);i&&(e.labels=i),this.Bo(e)}Ho(t){const e={};e.database=$a(this.yt),e.removeTarget=t,this.Bo(e)}}class yx extends Qg{constructor(t,e,i,s,r,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,s,o),this.yt=r,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(t,e){return this.connection.wo("Write",t,e)}onMessage(t){if(P(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Jo){this.xo.reset();const e=av(t.writeResults,t.commitTime),i=Nt(t.commitTime);return this.listener.Zo(i,e)}return P(!t.writeResults||t.writeResults.length===0),this.Jo=!0,this.listener.tu()}eu(){const t={};t.database=$a(this.yt),this.Bo(t)}Xo(t){const e={streamToken:this.lastStreamToken,writes:t.map(i=>Vr(this.yt,i))};this.Bo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx extends class{}{constructor(t,e,i,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.yt=s,this.nu=!1}su(){if(this.nu)throw new k(_.FAILED_PRECONDITION,"The client has already been terminated.")}ao(t,e,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,r])=>this.connection.ao(t,e,i,s,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(_.UNKNOWN,s.toString())})}_o(t,e,i,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection._o(t,e,i,r,o,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new k(_.UNKNOWN,r.toString())})}terminate(){this.nu=!0}}class vx{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){this.iu===0&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(t){this.state==="Online"?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.cu("Offline")))}set(t){this.lu(),this.iu=0,t==="Online"&&(this.ou=!1),this.cu(t)}cu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}au(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(Lt(e),this.ou=!1):T("OnlineStateTracker",e)}lu(){this.ru!==null&&(this.ru.cancel(),this.ru=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xx{constructor(t,e,i,s,r){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=r,this.mu.Ur(o=>{i.enqueueAndForget(async()=>{Dn(this)&&(T("RemoteStore","Restarting streams for network reachability change."),await async function(a){const c=V(a);c._u.add(4),await Ps(c),c.gu.set("Unknown"),c._u.delete(4),await Io(c)}(this))})}),this.gu=new vx(i,s)}}async function Io(n){if(Dn(n))for(const t of n.wu)await t(!0)}async function Ps(n){for(const t of n.wu)await t(!1)}function Xg(n,t){const e=V(n);e.du.has(t.targetId)||(e.du.set(t.targetId,t),el(e)?tl(e):hi(e).ko()&&Zc(e,t))}function Jg(n,t){const e=V(n),i=hi(e);e.du.delete(t),i.ko()&&Zg(e,t),e.du.size===0&&(i.ko()?i.Fo():Dn(e)&&e.gu.set("Unknown"))}function Zc(n,t){n.yu.Ot(t.targetId),hi(n).zo(t)}function Zg(n,t){n.yu.Ot(t),hi(n).Ho(t)}function tl(n){n.yu=new Z0({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),ne:t=>n.du.get(t)||null}),hi(n).start(),n.gu.uu()}function el(n){return Dn(n)&&!hi(n).No()&&n.du.size>0}function Dn(n){return V(n)._u.size===0}function tp(n){n.yu=void 0}async function wx(n){n.du.forEach((t,e)=>{Zc(n,t)})}async function _x(n,t){tp(n),el(n)?(n.gu.hu(t),tl(n)):n.gu.set("Unknown")}async function Sx(n,t,e){if(n.gu.set("Online"),t instanceof yg&&t.state===2&&t.cause)try{await async function(i,s){const r=s.cause;for(const o of s.targetIds)i.du.has(o)&&(await i.remoteSyncer.rejectListen(o,r),i.du.delete(o),i.yu.removeTarget(o))}(n,t)}catch(i){T("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),i),await Ur(n,i)}else if(t instanceof cr?n.yu.Kt(t):t instanceof mg?n.yu.Jt(t):n.yu.jt(t),!e.isEqual(L.min()))try{const i=await Kg(n.localStore);e.compareTo(i)>=0&&await function(s,r){const o=s.yu.Zt(r);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){const l=s.du.get(c);l&&s.du.set(c,l.withResumeToken(a.resumeToken,r))}}),o.targetMismatches.forEach(a=>{const c=s.du.get(a);if(!c)return;s.du.set(a,c.withResumeToken(Tt.EMPTY_BYTE_STRING,c.snapshotVersion)),Zg(s,a);const l=new Le(c.target,a,1,c.sequenceNumber);Zc(s,l)}),s.remoteSyncer.applyRemoteEvent(o)}(n,e)}catch(i){T("RemoteStore","Failed to raise snapshot:",i),await Ur(n,i)}}async function Ur(n,t,e){if(!qe(t))throw t;n._u.add(1),await Ps(n),n.gu.set("Offline"),e||(e=()=>Kg(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{T("RemoteStore","Retrying IndexedDB access"),await e(),n._u.delete(1),await Io(n)})}function ep(n,t){return t().catch(e=>Ur(n,e,t))}async function To(n){const t=V(n),e=Be(t);let i=t.fu.length>0?t.fu[t.fu.length-1].batchId:-1;for(;Ex(t);)try{const s=await cx(t.localStore,i);if(s===null){t.fu.length===0&&e.Fo();break}i=s.batchId,Ix(t,s)}catch(s){await Ur(t,s)}np(t)&&ip(t)}function Ex(n){return Dn(n)&&n.fu.length<10}function Ix(n,t){n.fu.push(t);const e=Be(n);e.ko()&&e.Yo&&e.Xo(t.mutations)}function np(n){return Dn(n)&&!Be(n).No()&&n.fu.length>0}function ip(n){Be(n).start()}async function Tx(n){Be(n).eu()}async function Dx(n){const t=Be(n);for(const e of n.fu)t.Xo(e.mutations)}async function Cx(n,t,e){const i=n.fu.shift(),s=Wc.from(i,t,e);await ep(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await To(n)}async function kx(n,t){t&&Be(n).Yo&&await async function(e,i){if(s=i.code,K0(s)&&s!==_.ABORTED){const r=e.fu.shift();Be(e).Mo(),await ep(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,i)),await To(e)}var s}(n,t),np(n)&&ip(n)}async function Hh(n,t){const e=V(n);e.asyncQueue.verifyOperationInProgress(),T("RemoteStore","RemoteStore received new credentials");const i=Dn(e);e._u.add(3),await Ps(e),i&&e.gu.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e._u.delete(3),await Io(e)}async function Ax(n,t){const e=V(n);t?(e._u.delete(2),await Io(e)):t||(e._u.add(2),await Ps(e),e.gu.set("Unknown"))}function hi(n){return n.pu||(n.pu=function(t,e,i){const s=V(t);return s.su(),new mx(e,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,i)}(n.datastore,n.asyncQueue,{Yr:wx.bind(null,n),Zr:_x.bind(null,n),Wo:Sx.bind(null,n)}),n.wu.push(async t=>{t?(n.pu.Mo(),el(n)?tl(n):n.gu.set("Unknown")):(await n.pu.stop(),tp(n))})),n.pu}function Be(n){return n.Iu||(n.Iu=function(t,e,i){const s=V(t);return s.su(),new yx(e,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,i)}(n.datastore,n.asyncQueue,{Yr:Tx.bind(null,n),Zr:kx.bind(null,n),tu:Dx.bind(null,n),Zo:Cx.bind(null,n)}),n.wu.push(async t=>{t?(n.Iu.Mo(),await To(n)):(await n.Iu.stop(),n.fu.length>0&&(T("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))})),n.Iu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(t,e,i,s,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=s,this.removalCallback=r,this.deferred=new le,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(t,e,i,s,r){const o=Date.now()+i,a=new nl(t,e,o,s,r);return a.start(i),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(_.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sp(n,t){if(Lt("AsyncQueue",`${t}: ${n}`),qe(n))return new k(_.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(t){this.comparator=t?(e,i)=>t(e,i)||C.comparator(e.key,i.key):(e,i)=>C.comparator(e.key,i.key),this.keyedMap=ki(),this.sortedSet=new yt(this.comparator)}static emptySet(t){return new Un(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,i)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Un)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,r=i.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const i=new Un;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(){this.Tu=new yt(C.comparator)}track(t){const e=t.doc.key,i=this.Tu.get(e);i?t.type!==0&&i.type===3?this.Tu=this.Tu.insert(e,t):t.type===3&&i.type!==1?this.Tu=this.Tu.insert(e,{type:i.type,doc:t.doc}):t.type===2&&i.type===2?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):t.type===2&&i.type===0?this.Tu=this.Tu.insert(e,{type:0,doc:t.doc}):t.type===1&&i.type===0?this.Tu=this.Tu.remove(e):t.type===1&&i.type===2?this.Tu=this.Tu.insert(e,{type:1,doc:i.doc}):t.type===0&&i.type===1?this.Tu=this.Tu.insert(e,{type:2,doc:t.doc}):M():this.Tu=this.Tu.insert(e,t)}Eu(){const t=[];return this.Tu.inorderTraversal((e,i)=>{t.push(i)}),t}}class Zn{constructor(t,e,i,s,r,o,a,c,l){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(t,e,i,s,r){const o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new Zn(t,e,Un.emptySet(e),o,i,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&yo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==i[s].type||!e[s].doc.isEqual(i[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mx{constructor(){this.Au=void 0,this.listeners=[]}}class Ox{constructor(){this.queries=new He(t=>ng(t),yo),this.onlineState="Unknown",this.Ru=new Set}}async function il(n,t){const e=V(n),i=t.query;let s=!1,r=e.queries.get(i);if(r||(s=!0,r=new Mx),s)try{r.Au=await e.onListen(i)}catch(o){const a=sp(o,`Initialization of query '${Ba(t.query)}' failed`);return void t.onError(a)}e.queries.set(i,r),r.listeners.push(t),t.bu(e.onlineState),r.Au&&t.Pu(r.Au)&&rl(e)}async function sl(n,t){const e=V(n),i=t.query;let s=!1;const r=e.queries.get(i);if(r){const o=r.listeners.indexOf(t);o>=0&&(r.listeners.splice(o,1),s=r.listeners.length===0)}if(s)return e.queries.delete(i),e.onUnlisten(i)}function Px(n,t){const e=V(n);let i=!1;for(const s of t){const r=s.query,o=e.queries.get(r);if(o){for(const a of o.listeners)a.Pu(s)&&(i=!0);o.Au=s}}i&&rl(e)}function Lx(n,t,e){const i=V(n),s=i.queries.get(t);if(s)for(const r of s.listeners)r.onError(e);i.queries.delete(t)}function rl(n){n.Ru.forEach(t=>{t.next()})}class ol{constructor(t,e,i){this.query=t,this.vu=e,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(t){if(!this.options.includeMetadataChanges){const i=[];for(const s of t.docChanges)s.type!==3&&i.push(s);t=new Zn(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Vu?this.Du(t)&&(this.vu.next(t),e=!0):this.Cu(t,this.onlineState)&&(this.xu(t),e=!0),this.Su=t,e}onError(t){this.vu.error(t)}bu(t){this.onlineState=t;let e=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,t)&&(this.xu(this.Su),e=!0),e}Cu(t,e){if(!t.fromCache)return!0;const i=e!=="Offline";return(!this.options.Nu||!i)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Du(t){if(t.docChanges.length>0)return!0;const e=this.Su&&this.Su.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}xu(t){t=Zn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Vu=!0,this.vu.next(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(t){this.key=t}}class op{constructor(t){this.key=t}}class Rx{constructor(t,e){this.query=t,this.qu=e,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=U(),this.mutatedKeys=U(),this.Gu=ig(t),this.Qu=new Un(this.Gu)}get ju(){return this.qu}Wu(t,e){const i=e?e.zu:new Wh,s=e?e.Qu:this.Qu;let r=e?e.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,l=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((h,u)=>{const d=s.get(h),f=Uc(this.query,u)?u:null,g=!!d&&this.mutatedKeys.has(d.key),p=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let m=!1;d&&f?d.data.isEqual(f.data)?g!==p&&(i.track({type:3,doc:f}),m=!0):this.Hu(d,f)||(i.track({type:2,doc:f}),m=!0,(c&&this.Gu(f,c)>0||l&&this.Gu(f,l)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),m=!0):d&&!f&&(i.track({type:1,doc:d}),m=!0,(c||l)&&(a=!0)),m&&(f?(o=o.add(f),r=p?r.add(h):r.delete(h)):(o=o.delete(h),r=r.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),r=r.delete(h.key),i.track({type:1,doc:h})}return{Qu:o,zu:i,$i:a,mutatedKeys:r}}Hu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i){const s=this.Qu;this.Qu=t.Qu,this.mutatedKeys=t.mutatedKeys;const r=t.zu.Eu();r.sort((l,h)=>function(u,d){const f=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return f(u)-f(d)}(l.type,h.type)||this.Gu(l.doc,h.doc)),this.Ju(i);const o=e?this.Yu():[],a=this.Ku.size===0&&this.current?1:0,c=a!==this.Uu;return this.Uu=a,r.length!==0||c?{snapshot:new Zn(this.query,t.Qu,s,r,t.mutatedKeys,a===0,c,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}bu(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Wh,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(t){return!this.qu.has(t)&&!!this.Qu.has(t)&&!this.Qu.get(t).hasLocalMutations}Ju(t){t&&(t.addedDocuments.forEach(e=>this.qu=this.qu.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.qu=this.qu.delete(e)),this.current=t.current)}Yu(){if(!this.current)return[];const t=this.Ku;this.Ku=U(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const e=[];return t.forEach(i=>{this.Ku.has(i)||e.push(new op(i))}),this.Ku.forEach(i=>{t.has(i)||e.push(new rp(i))}),e}tc(t){this.qu=t.Hi,this.Ku=U();const e=this.Wu(t.documents);return this.applyChanges(e,!0)}ec(){return Zn.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.Uu===0,this.hasCachedResults)}}class Nx{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}}class Fx{constructor(t){this.key=t,this.nc=!1}}class Vx{constructor(t,e,i,s,r,o){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new He(a=>ng(a),yo),this.rc=new Map,this.oc=new Set,this.uc=new yt(C.comparator),this.cc=new Map,this.ac=new Qc,this.hc={},this.lc=new Map,this.fc=_n.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function Bx(n,t){const e=Gx(n);let i,s;const r=e.ic.get(t);if(r)i=r.targetId,e.sharedClientState.addLocalQueryTarget(i),s=r.view.ec();else{const o=await lx(e.localStore,ne(t));e.isPrimaryClient&&Xg(e.remoteStore,o);const a=e.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,s=await zx(e,t,i,a==="current",o.resumeToken)}return s}async function zx(n,t,e,i,s){n._c=(u,d,f)=>async function(g,p,m,y){let b=p.view.Wu(m);b.$i&&(b=await Uh(g.localStore,p.query,!1).then(({documents:x})=>p.view.Wu(x,b)));const w=y&&y.targetChanges.get(p.targetId),S=p.view.applyChanges(b,g.isPrimaryClient,w);return Gh(g,p.targetId,S.Xu),S.snapshot}(n,u,d,f);const r=await Uh(n.localStore,t,!0),o=new Rx(t,r.Hi),a=o.Wu(r.documents),c=Os.createSynthesizedTargetChangeForCurrentChange(e,i&&n.onlineState!=="Offline",s),l=o.applyChanges(a,n.isPrimaryClient,c);Gh(n,e,l.Xu);const h=new Nx(t,e,o);return n.ic.set(t,h),n.rc.has(e)?n.rc.get(e).push(t):n.rc.set(e,[t]),l.snapshot}async function $x(n,t){const e=V(n),i=e.ic.get(t),s=e.rc.get(i.targetId);if(s.length>1)return e.rc.set(i.targetId,s.filter(r=>!yo(r,t))),void e.ic.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||await Ka(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),Jg(e.remoteStore,i.targetId),Ga(e,i.targetId)}).catch(Tn)):(Ga(e,i.targetId),await Ka(e.localStore,i.targetId,!0))}async function ap(n,t){const e=V(n);try{const i=await ox(e.localStore,t);t.targetChanges.forEach((s,r)=>{const o=e.cc.get(r);o&&(P(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.nc=!0:s.modifiedDocuments.size>0?P(o.nc):s.removedDocuments.size>0&&(P(o.nc),o.nc=!1))}),await Do(e,i,t)}catch(i){await Tn(i)}}function Kh(n,t,e){const i=V(n);if(i.isPrimaryClient&&e===0||!i.isPrimaryClient&&e===1){const s=[];i.ic.forEach((r,o)=>{const a=o.view.bu(t);a.snapshot&&s.push(a.snapshot)}),function(r,o){const a=V(r);a.onlineState=o;let c=!1;a.queries.forEach((l,h)=>{for(const u of h.listeners)u.bu(o)&&(c=!0)}),c&&rl(a)}(i.eventManager,t),s.length&&i.sc.Wo(s),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Ux(n,t,e){const i=V(n);i.sharedClientState.updateQueryState(t,"rejected",e);const s=i.cc.get(t),r=s&&s.key;if(r){let o=new yt(C.comparator);o=o.insert(r,at.newNoDocument(r,L.min()));const a=U().add(r),c=new xo(L.min(),new Map,new Z(B),o,a);await ap(i,c),i.uc=i.uc.remove(r),i.cc.delete(t),al(i)}else await Ka(i.localStore,t,!1).then(()=>Ga(i,t,e)).catch(Tn)}async function jx(n,t){const e=V(n),i=t.batch.batchId;try{const s=await rx(e.localStore,t);lp(e,i,null),cp(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await Do(e,s)}catch(s){await Tn(s)}}async function qx(n,t,e){const i=V(n);try{const s=await function(r,o){const a=V(r);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return a.mutationQueue.lookupMutationBatch(c,o).next(h=>(P(h!==null),l=h.keys(),a.mutationQueue.removeMutationBatch(c,h))).next(()=>a.mutationQueue.performConsistencyCheck(c)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(c,l,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>a.localDocuments.getDocuments(c,l))})}(i.localStore,t);lp(i,t,e),cp(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),await Do(i,s)}catch(s){await Tn(s)}}function cp(n,t){(n.lc.get(t)||[]).forEach(e=>{e.resolve()}),n.lc.delete(t)}function lp(n,t,e){const i=V(n);let s=i.hc[i.currentUser.toKey()];if(s){const r=s.get(t);r&&(e?r.reject(e):r.resolve(),s=s.remove(t)),i.hc[i.currentUser.toKey()]=s}}function Ga(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const i of n.rc.get(t))n.ic.delete(i),e&&n.sc.wc(i,e);n.rc.delete(t),n.isPrimaryClient&&n.ac.ls(t).forEach(i=>{n.ac.containsKey(i)||hp(n,i)})}function hp(n,t){n.oc.delete(t.path.canonicalString());const e=n.uc.get(t);e!==null&&(Jg(n.remoteStore,e),n.uc=n.uc.remove(t),n.cc.delete(e),al(n))}function Gh(n,t,e){for(const i of e)i instanceof rp?(n.ac.addReference(i.key,t),Hx(n,i)):i instanceof op?(T("SyncEngine","Document no longer in limbo: "+i.key),n.ac.removeReference(i.key,t),n.ac.containsKey(i.key)||hp(n,i.key)):M()}function Hx(n,t){const e=t.key,i=e.path.canonicalString();n.uc.get(e)||n.oc.has(i)||(T("SyncEngine","New document in limbo: "+e),n.oc.add(i),al(n))}function al(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const t=n.oc.values().next().value;n.oc.delete(t);const e=new C(Y.fromString(t)),i=n.fc.next();n.cc.set(i,new Fx(e)),n.uc=n.uc.insert(e,i),Xg(n.remoteStore,new Le(ne(As(e.path)),i,2,Yt.at))}}async function Do(n,t,e){const i=V(n),s=[],r=[],o=[];i.ic.isEmpty()||(i.ic.forEach((a,c)=>{o.push(i._c(c,t,e).then(l=>{if((l||e)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l!=null&&l.fromCache?"not-current":"current"),l){s.push(l);const h=Jc.Ci(c.targetId,l);r.push(h)}}))}),await Promise.all(o),i.sc.Wo(s),await async function(a,c){const l=V(a);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>v.forEach(c,u=>v.forEach(u.Si,d=>l.persistence.referenceDelegate.addReference(h,u.targetId,d)).next(()=>v.forEach(u.Di,d=>l.persistence.referenceDelegate.removeReference(h,u.targetId,d)))))}catch(h){if(!qe(h))throw h;T("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const u=h.targetId;if(!h.fromCache){const d=l.qi.get(u),f=d.snapshotVersion,g=d.withLastLimboFreeSnapshotVersion(f);l.qi=l.qi.insert(u,g)}}}(i.localStore,r))}async function Wx(n,t){const e=V(n);if(!e.currentUser.isEqual(t)){T("SyncEngine","User change. New user:",t.toKey());const i=await Wg(e.localStore,t);e.currentUser=t,function(s,r){s.lc.forEach(o=>{o.forEach(a=>{a.reject(new k(_.CANCELLED,r))})}),s.lc.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),await Do(e,i.ji)}}function Kx(n,t){const e=V(n),i=e.cc.get(t);if(i&&i.nc)return U().add(i.key);{let s=U();const r=e.rc.get(t);if(!r)return s;for(const o of r){const a=e.ic.get(o);s=s.unionWith(a.view.ju)}return s}}function Gx(n){const t=V(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=ap.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Kx.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ux.bind(null,t),t.sc.Wo=Px.bind(null,t.eventManager),t.sc.wc=Lx.bind(null,t.eventManager),t}function Yx(n){const t=V(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=jx.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=qx.bind(null,t),t}class up{constructor(){this.synchronizeTabs=!1}async initialize(t){this.yt=Eo(t.databaseInfo.databaseId),this.sharedClientState=this.gc(t),this.persistence=this.yc(t),await this.persistence.start(),this.localStore=this.Ic(t),this.gcScheduler=this.Tc(t,this.localStore),this.indexBackfillerScheduler=this.Ec(t,this.localStore)}Tc(t,e){return null}Ec(t,e){return null}Ic(t){return Hg(this.persistence,new qg,t.initialUser,this.yt)}yc(t){return new jg(So.Bs,this.yt)}gc(t){return new Gg}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Qx extends up{constructor(t,e,i){super(),this.Ac=t,this.cacheSizeBytes=e,this.forceOwnership=i,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Ac.initialize(this,t),await Yx(this.Ac.syncEngine),await To(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(t){return Hg(this.persistence,new qg,t.initialUser,this.yt)}Tc(t,e){const i=this.persistence.referenceDelegate.garbageCollector;return new jv(i,t.asyncQueue,e)}Ec(t,e){const i=new w0(e,this.persistence);return new x0(t.asyncQueue,i)}yc(t){const e=ix(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Bt.withCacheSize(this.cacheSizeBytes):Bt.DEFAULT;return new Xc(this.synchronizeTabs,e,t.clientId,i,t.asyncQueue,px(),hr(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(t){return new Gg}}class dp{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Kh(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wx.bind(null,this.syncEngine),await Ax(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Ox}createDatastore(t){const e=Eo(t.databaseInfo.databaseId),i=(s=t.databaseInfo,new gx(s));var s;return function(r,o,a,c){return new bx(r,o,a,c)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return e=this.localStore,i=this.datastore,s=t.asyncQueue,r=a=>Kh(this.syncEngine,a,0),o=qh.C()?new qh:new ux,new xx(e,i,s,r,o);var e,i,s,r,o}createSyncEngine(t,e){return function(i,s,r,o,a,c,l){const h=new Vx(i,s,r,o,a,c);return l&&(h.dc=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=V(t);T("RemoteStore","RemoteStore shutting down."),e._u.add(5),await Ps(e),e.mu.shutdown(),e.gu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fp(n,t,e){if(!e)throw new k(_.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function Xx(n,t,e,i){if(t===!0&&i===!0)throw new k(_.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Yh(n){if(!C.isDocumentKey(n))throw new k(_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Qh(n){if(C.isDocumentKey(n))throw new k(_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Co(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":M()}function _e(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new k(_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Co(n);throw new k(_.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh=new Map;class Jh{constructor(t){var e;if(t.host===void 0){if(t.ssl!==void 0)throw new k(_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new k(_.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Xx("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(t,e,i,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new k(_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new k(_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jh(t),t.credentials!==void 0&&(this._authCredentials=function(e){if(!e)return new a0;switch(e.type){case"gapi":const i=e.client;return new u0(i,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new k(_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Xh.get(t);e&&(T("ComponentProvider","Removing Datastore"),Xh.delete(t),e.terminate())}(this),Promise.resolve()}}function Jx(n,t,e,i={}){var s;const r=(n=_e(n,ko))._getSettings();if(r.host!=="firestore.googleapis.com"&&r.host!==t&&Pr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},r),{host:`${t}:${e}`,ssl:!1})),i.mockUserToken){let o,a;if(typeof i.mockUserToken=="string")o=i.mockUserToken,a=St.MOCK_USER;else{o=Um(i.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new k(_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new St(c)}n._authCredentials=new c0(new Nf(o,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Re(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new $t(this.firestore,t,this._key)}}class Cn{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new Cn(this.firestore,t,this._query)}}class Re extends Cn{constructor(t,e,i){super(t,e,As(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new $t(this.firestore,null,new C(t))}withConverter(t){return new Re(this.firestore,t,this._path)}}function gp(n,t,...e){if(n=qn(n),fp("collection","path",t),n instanceof ko){const i=Y.fromString(t,...e);return Qh(i),new Re(n,null,i)}{if(!(n instanceof $t||n instanceof Re))throw new k(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Y.fromString(t,...e));return Qh(i),new Re(n.firestore,null,i)}}function Zx(n,t,...e){if(n=qn(n),arguments.length===1&&(t=Ff.R()),fp("doc","path",t),n instanceof ko){const i=Y.fromString(t,...e);return Yh(i),new $t(n,null,new C(i))}{if(!(n instanceof $t||n instanceof Re))throw new k(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Y.fromString(t,...e));return Yh(i),new $t(n.firestore,n instanceof Re?n.converter:null,new C(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Rc(this.observer.next,t)}error(t){this.observer.error?this.Rc(this.observer.error,t):Lt("Uncaught Error in snapshot listener:",t.toString())}bc(){this.muted=!0}Rc(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw{constructor(t,e,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=s,this.user=St.UNAUTHENTICATED,this.clientId=Ff.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,async r=>{T("FirestoreClient","Received user=",r.uid),await this.authCredentialListener(r),this.user=r}),this.appCheckCredentials.start(i,r=>(T("FirestoreClient","Received new app check token=",r),this.appCheckCredentialListener(r,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new k(_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new le;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const i=sp(e,"Failed to shutdown persistence");t.reject(i)}}),t.promise}}async function pp(n,t){n.asyncQueue.verifyOperationInProgress(),T("FirestoreClient","Initializing OfflineComponentProvider");const e=await n.getConfiguration();await t.initialize(e);let i=e.initialUser;n.setCredentialChangeListener(async s=>{i.isEqual(s)||(await Wg(t.localStore,s),i=s)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=t}async function mp(n,t){n.asyncQueue.verifyOperationInProgress();const e=await ew(n);T("FirestoreClient","Initializing OnlineComponentProvider");const i=await n.getConfiguration();await t.initialize(e,i),n.setCredentialChangeListener(s=>Hh(t.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>Hh(t.remoteStore,r)),n.onlineComponents=t}async function ew(n){return n.offlineComponents||(T("FirestoreClient","Using default OfflineComponentProvider"),await pp(n,new up)),n.offlineComponents}async function nw(n){return n.onlineComponents||(T("FirestoreClient","Using default OnlineComponentProvider"),await mp(n,new dp)),n.onlineComponents}async function jr(n){const t=await nw(n),e=t.eventManager;return e.onListen=Bx.bind(null,t.syncEngine),e.onUnlisten=$x.bind(null,t.syncEngine),e}function iw(n,t,e={}){const i=new le;return n.asyncQueue.enqueueAndForget(async()=>function(s,r,o,a,c){const l=new cl({next:u=>{r.enqueueAndForget(()=>sl(s,h));const d=u.docs.has(o);!d&&u.fromCache?c.reject(new k(_.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&u.fromCache&&a&&a.source==="server"?c.reject(new k(_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(u)},error:u=>c.reject(u)}),h=new ol(As(o.path),l,{includeMetadataChanges:!0,Nu:!0});return il(s,h)}(await jr(n),n.asyncQueue,t,e,i)),i.promise}function sw(n,t,e={}){const i=new le;return n.asyncQueue.enqueueAndForget(async()=>function(s,r,o,a,c){const l=new cl({next:u=>{r.enqueueAndForget(()=>sl(s,h)),u.fromCache&&a.source==="server"?c.reject(new k(_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(u)},error:u=>c.reject(u)}),h=new ol(o,l,{includeMetadataChanges:!0,Nu:!0});return il(s,h)}(await jr(n),n.asyncQueue,t,e,i)),i.promise}class rw{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Yg(this,"async_queue_retry"),this.Wc=()=>{const e=hr();e&&T("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const t=hr();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.zc(),this.Hc(t)}enterRestrictedMode(t){if(!this.qc){this.qc=!0,this.Qc=t||!1;const e=hr();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Wc)}}enqueue(t){if(this.zc(),this.qc)return new Promise(()=>{});const e=new le;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Lc.push(t),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(t){if(!qe(t))throw t;T("AsyncQueue","Operation failed with retryable error: "+t)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(t){const e=this.Bc.then(()=>(this.Gc=!0,t().catch(i=>{this.Kc=i,this.Gc=!1;const s=function(r){let o=r.message||"";return r.stack&&(o=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),o}(i);throw Lt("INTERNAL UNHANDLED ERROR: ",s),i}).then(i=>(this.Gc=!1,i))));return this.Bc=e,e}enqueueAfterDelay(t,e,i){this.zc(),this.jc.indexOf(t)>-1&&(e=0);const s=nl.createAndSchedule(this,t,e,i,r=>this.Yc(r));return this.Uc.push(s),s}zc(){this.Kc&&M()}verifyOperationInProgress(){}async Xc(){let t;do t=this.Bc,await t;while(t!==this.Bc)}Zc(t){for(const e of this.Uc)if(e.timerId===t)return!0;return!1}ta(t){return this.Xc().then(()=>{this.Uc.sort((e,i)=>e.targetTimeMs-i.targetTimeMs);for(const e of this.Uc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Xc()})}ea(t){this.jc.push(t)}Yc(t){const e=this.Uc.indexOf(t);this.Uc.splice(e,1)}}function Zh(n){return function(t,e){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of e)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class ti extends ko{constructor(t,e,i,s){super(t,e,i,s),this.type="firestore",this._queue=new rw,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||yp(this),this._firestoreClient.terminate()}}function ow(n,t){const e=typeof n=="object"?n:Ky(),i=typeof n=="string"?n:t||"(default)",s=jy(e,"firestore").getImmediate({identifier:i});if(!s._initialized){const r=Bm("firestore");r&&Jx(s,...r)}return s}function Ao(n){return n._firestoreClient||yp(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function yp(n){var t;const e=n._freezeSettings(),i=function(s,r,o,a){return new _0(s,r,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,e);n._firestoreClient=new tw(n._authCredentials,n._appCheckCredentials,n._queue,i)}function aw(n,t){lw(n=_e(n,ti));const e=Ao(n),i=n._freezeSettings(),s=new dp;return cw(e,s,new Qx(s,i.cacheSizeBytes,t==null?void 0:t.forceOwnership))}function cw(n,t,e){const i=new le;return n.asyncQueue.enqueue(async()=>{try{await pp(n,e),await mp(n,t),i.resolve()}catch(s){const r=s;if(!function(o){return o.name==="FirebaseError"?o.code===_.FAILED_PRECONDITION||o.code===_.UNIMPLEMENTED:typeof DOMException<"u"&&o instanceof DOMException?o.code===22||o.code===20||o.code===11:!0}(r))throw r;Pr("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r)}}).then(()=>i.promise)}function lw(n){if(n._initialized||n._terminated)throw new k(_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ei(Tt.fromBase64String(t))}catch(e){throw new k(_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new ei(Tt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new k(_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new k(_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new k(_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return B(this._lat,t._lat)||B(this._long,t._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hw=/^__.*__$/;function xp(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}class hl{constructor(t,e,i,s,r,o){this.settings=t,this.databaseId=e,this.yt=i,this.ignoreUndefinedProperties=s,r===void 0&&this.na(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(t){return new hl(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(t){var e;const i=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.ia({path:i,oa:!1});return s.ua(t),s}ca(t){var e;const i=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.ia({path:i,oa:!1});return s.na(),s}aa(t){return this.ia({path:void 0,oa:!0})}ha(t){return Ya(t,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}na(){if(this.path)for(let t=0;t<this.path.length;t++)this.ua(this.path.get(t))}ua(t){if(t.length===0)throw this.ha("Document fields must not be empty");if(xp(this.sa)&&hw.test(t))throw this.ha('Document fields cannot begin and end with "__"')}}class uw{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.yt=i||Eo(t)}da(t,e,i,s=!1){return new hl({sa:t,methodName:e,fa:i,path:pt.emptyPath(),oa:!1,la:s},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function dw(n){const t=n._freezeSettings(),e=Eo(n._databaseId);return new uw(n._databaseId,!!t.ignoreUndefinedProperties,e)}function fw(n,t,e,i=!1){return ul(e,n.da(i?4:3,t))}function ul(n,t){if(wp(n=qn(n)))return pw("Unsupported field value:",t,n),gw(n,t);if(n instanceof vp)return function(e,i){if(!xp(i.sa))throw i.ha(`${e._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${e._methodName}() is not currently supported inside arrays`);const s=e._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.oa&&t.sa!==4)throw t.ha("Nested arrays are not supported");return function(e,i){const s=[];let r=0;for(const o of e){let a=ul(o,i.aa(r));a==null&&(a={nullValue:"NULL_VALUE"}),s.push(a),r++}return{arrayValue:{values:s}}}(n,t)}return function(e,i){if((e=qn(e))===null)return{nullValue:"NULL_VALUE"};if(typeof e=="number")return V0(i.yt,e);if(typeof e=="boolean")return{booleanValue:e};if(typeof e=="string")return{stringValue:e};if(e instanceof Date){const s=ht.fromDate(e);return{timestampValue:Jn(i.yt,s)}}if(e instanceof ht){const s=new ht(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Jn(i.yt,s)}}if(e instanceof ll)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ei)return{bytesValue:bg(i.yt,e._byteString)};if(e instanceof $t){const s=i.databaseId,r=e.firestore._databaseId;if(!r.isEqual(s))throw i.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:qc(e.firestore._databaseId||i.databaseId,e._key.path)}}throw i.ha(`Unsupported field value: ${Co(e)}`)}(n,t)}function gw(n,t){const e={};return jf(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ds(n,(i,s)=>{const r=ul(s,t.ra(i));r!=null&&(e[i]=r)}),{mapValue:{fields:e}}}function wp(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ht||n instanceof ll||n instanceof ei||n instanceof $t||n instanceof vp)}function pw(n,t,e){if(!wp(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){const i=Co(e);throw i==="an object"?t.ha(n+" a custom object"):t.ha(n+" "+i)}}const mw=new RegExp("[~\\*/\\[\\]]");function yw(n,t,e){if(t.search(mw)>=0)throw Ya(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new bp(...t.split("."))._internalPath}catch{throw Ya(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Ya(n,t,e,i,s){const r=i&&!i.isEmpty(),o=s!==void 0;let a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new k(_.INVALID_ARGUMENT,a+n+c)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _p{constructor(t,e,i,s,r){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new $t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new bw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(dl("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class bw extends _p{data(){return super.data()}}function dl(n,t){return typeof t=="string"?yw(n,t):t instanceof bp?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fl{}class vw extends fl{}function xw(n,t,...e){let i=[];t instanceof fl&&i.push(t),i=i.concat(e),function(s){const r=s.filter(a=>a instanceof gl).length,o=s.filter(a=>a instanceof Mo).length;if(r>1||r>0&&o>0)throw new k(_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const s of i)n=s._apply(n);return n}class Mo extends vw{constructor(t,e,i){super(),this._field=t,this._op=e,this._value=i,this.type="where"}static _create(t,e,i){return new Mo(t,e,i)}_apply(t){const e=this._parse(t);return Ep(t._query,e),new Cn(t.firestore,t.converter,Fa(t._query,e))}_parse(t){const e=dw(t.firestore);return function(s,r,o,a,c,l,h){let u;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new k(_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){nu(h,l);const d=[];for(const f of h)d.push(eu(a,s,f));u={arrayValue:{values:d}}}else u=eu(a,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||nu(h,l),u=fw(o,r,h,l==="in"||l==="not-in");return j.create(c,l,u)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}function tu(n,t,e){const i=t,s=dl("where",n);return Mo._create(s,i,e)}class gl extends fl{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new gl(t,e)}_parse(t){const e=this._queryConstraints.map(i=>i._parse(t)).filter(i=>i.getFilters().length>0);return e.length===1?e[0]:X.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let r=i;const o=s.getFlattenedFilters();for(const a of o)Ep(r,a),r=Fa(r,a)}(t._query,e),new Cn(t.firestore,t.converter,Fa(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function eu(n,t,e){if(typeof(e=qn(e))=="string"){if(e==="")throw new k(_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eg(t)&&e.indexOf("/")!==-1)throw new k(_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const i=t.path.child(Y.fromString(e));if(!C.isDocumentKey(i))throw new k(_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return rs(n,new C(i))}if(e instanceof $t)return rs(n,e._key);throw new k(_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Co(e)}.`)}function nu(n,t){if(!Array.isArray(n)||n.length===0)throw new k(_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(n.length>10)throw new k(_.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function Ep(n,t){if(t.isInequality()){const i=$c(n),s=t.field;if(i!==null&&!i.isEqual(s))throw new k(_.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${i.toString()}' and '${s.toString()}'`);const r=tg(n);r!==null&&ww(n,s,r)}const e=function(i,s){for(const r of i)for(const o of r.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new k(_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new k(_.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function ww(n,t,e){if(!e.isEqual(t))throw new k(_.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${e.toString()}' instead.`)}class _w{convertValue(t,e="none"){switch(bn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ot(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(yn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw M()}}convertObject(t,e){const i={};return Ds(t.fields,(s,r)=>{i[s]=this.convertValue(r,e)}),i}convertGeoPoint(t){return new ll(ot(t.latitude),ot(t.longitude))}convertArray(t,e){return(t.values||[]).map(i=>this.convertValue(i,e))}convertServerTimestamp(t,e){switch(e){case"previous":const i=Hf(t);return i==null?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(is(t));default:return null}}convertTimestamp(t){const e=Fe(t);return new ht(e.seconds,e.nanos)}convertDocumentKey(t,e){const i=Y.fromString(t);P(Dg(i));const s=new mn(i.get(1),i.get(3)),r=new C(i.popFirst(5));return s.isEqual(e)||Lt(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ip extends _p{constructor(t,e,i,s,r,o){super(t,e,i,s,o),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ur(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const i=this._document.data.field(dl("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}}class ur extends Ip{data(t={}){return super.data(t)}}class Tp{constructor(t,e,i,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Mi(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(i=>{t.call(e,new ur(this._firestore,this._userDataWriter,i.key,i,new Mi(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new k(_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let r=0;return i._snapshot.docChanges.map(o=>{const a=new ur(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Mi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:a,oldIndex:-1,newIndex:r++}})}{let r=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const a=new ur(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Mi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return o.type!==0&&(c=r.indexOf(o.doc.key),r=r.delete(o.doc.key)),o.type!==1&&(r=r.add(o.doc),l=r.indexOf(o.doc.key)),{type:Sw(o.type),doc:a,oldIndex:c,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Sw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ew(n){n=_e(n,$t);const t=_e(n.firestore,ti);return iw(Ao(t),n._key).then(e=>Dp(t,n,e))}class pl extends _w{constructor(t){super(),this.firestore=t}convertBytes(t){return new ei(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new $t(this.firestore,null,e)}}function Iw(n){n=_e(n,Cn);const t=_e(n.firestore,ti),e=Ao(t),i=new pl(t);return Sp(n._query),sw(e,n._query).then(s=>new Tp(t,i,n,s))}function Tw(n,...t){var e,i,s;n=qn(n);let r={includeMetadataChanges:!1},o=0;typeof t[o]!="object"||Zh(t[o])||(r=t[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(Zh(t[o])){const u=t[o];t[o]=(e=u.next)===null||e===void 0?void 0:e.bind(u),t[o+1]=(i=u.error)===null||i===void 0?void 0:i.bind(u),t[o+2]=(s=u.complete)===null||s===void 0?void 0:s.bind(u)}let c,l,h;if(n instanceof $t)l=_e(n.firestore,ti),h=As(n._key.path),c={next:u=>{t[o]&&t[o](Dp(l,n,u))},error:t[o+1],complete:t[o+2]};else{const u=_e(n,Cn);l=_e(u.firestore,ti),h=u._query;const d=new pl(l);c={next:f=>{t[o]&&t[o](new Tp(l,d,u,f))},error:t[o+1],complete:t[o+2]},Sp(n._query)}return function(u,d,f,g){const p=new cl(g),m=new ol(d,p,f);return u.asyncQueue.enqueueAndForget(async()=>il(await jr(u),m)),()=>{p.bc(),u.asyncQueue.enqueueAndForget(async()=>sl(await jr(u),m))}}(Ao(l),h,a,c)}function Dp(n,t,e){const i=e.docs.get(t._key),s=new pl(n);return new Ip(n,s,t._key,i,new Mi(e.hasPendingWrites,e.fromCache),t.converter)}(function(n,t=!0){(function(e){ci=e})(Wy),Er(new Gi("firestore",(e,{instanceIdentifier:i,options:s})=>{const r=e.getProvider("app").getImmediate(),o=new ti(new l0(e.getProvider("auth-internal")),new f0(e.getProvider("app-check-internal")),function(a,c){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new k(_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mn(a.options.projectId,c)}(r,i),r);return s=Object.assign({useFetchStreams:t},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),zn(eh,"3.8.1",n),zn(eh,"3.8.1","esm2017")})();const Dw=Ad(Am),Oo=ow(Dw);aw(Oo).then(()=>{console.log("Offline data persistence enabled.")}).catch(n=>{n.code==="failed-precondition"?console.log("Multiple tabs open, persistence can only be enabled in one tab at a time."):n.code==="unimplemented"&&console.log("The current browser does not support all of the features required to enable persistence.")});const iu=(n,t)=>Ew(Zx(Oo,n,t)),Cw=(n,t,e)=>Iw(xw(gp(Oo,n),tu("date",">=",t),tu("date","<=",e))),kw=(n,t)=>Tw(gp(Oo,n),{source:"cache"},t);class ml extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.title=this.getAttribute("title"),this.unit=""}handleEvent(t){if(t.type==="click"){const i=getComputedStyle(this.container).getPropertyValue("box-shadow");let s="";i==="none"?(this.container.style.boxShadow="var(--shadow-card)",s="enable"):(this.container.style.boxShadow="",s="disable");const r=new CustomEvent("card:card-parameter",{detail:{from:"card-parameter",message:[s,this.title]},bubbles:!0,composed:!0});this.dispatchEvent(r)}}static get styles(){return`
      :host {
        
      }

      .container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        width: fit-content;
        padding: 1rem 24px;
        background: var(--bg-card);
      }

      .header-card,
      .footer-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .title {
        margin: 0;
        font-size: var(--st-h1);
      }

      .value {
        margin: 0;
        font-family: Inter, sans-serif;
        font-size: var(--it-display);
        font-weight: 900;
        white-space: nowrap;
      }

      .footer-card {
        justify-content: flex-start;
        gap: 8px;
      }

      .peak-value {
        display: flex;
        gap: 4px;
        align-items: center;
        padding: 4px 8px;
        background: var(--bg-color);
        border-radius: 1rem;
      }

      .peak-value span {
        font-family: Inter, sans-serif;
        font-size: var(--it-h3);
      }
    `}setData(t){this.dataFB=t}getData(){return this.dataFB}getValues(){return{color:this.color,borderColor:this.borderColor}}disableCard(){this.container.style.boxShadow=""}setValues(t){Object.keys(t).forEach(e=>{const i=this.container.querySelector(`.${e}`);i.textContent=t[e]})}async init(){this.container=this.shadowRoot.querySelector(".container"),this.value=this.container.querySelector(".value"),this.container.addEventListener("click",this);const t=await iu(this.title,"0params"),e=await iu("RTV","actual");if(t.exists()){const i=t.data();this.unit=i.unit,this.color=i.color,this.borderColor=i.borderColor,this.container.style.setProperty("--bg-card",this.color)}if(e.exists()){const i=e.data();this.value.textContent=`${i[this.title]} ${this.unit}`}}valueListener(){kw("RTV",t=>{t.docChanges().forEach(e=>{if((t.metadata.fromCache?"local cache":"server")==="server"){const s=e.doc.data();this.value.textContent=`${s[this.title]} ${this.unit}`}})})}connectedCallback(){this.render(),this.init(),this.valueListener()}render(){this.shadowRoot.innerHTML=`
    <style>${ml.styles}</style>
    <div class="container">
      <div class="header-card">
        <h1 class="title">${this.title}</h1>
        <img src="icons/icon-menu-vertical.svg" alt="icon-menu-vertical">
      </div>
      <h2 class="value">0</h2>
      <div class="footer-card">
        <div class="peak-value">
          <img src="icons/icon-arrow-down.svg" alt="icon-arrow-down">
          <span class="min">0</span>
        </div>
        <div class="peak-value">
          <img src="icons/icon-arrow-up.svg" alt="icon-arrow-up">
          <span class="max">0</span>
        </div>
      </div>
    </div>`}}customElements.define("card-parameter",ml);const Cp=document.createElement("template");Cp.innerHTML=`
  <select type="year" id="year">
    <option value="2023">2023</option>
    <option value="2022">2022</option>
  </select>`;class yl extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}handleEvent(t){const e=this.container.lastElementChild;if(t.type==="click"&&e.click(),t.type==="change"){this.container.classList.remove("active");const i=new CustomEvent("date:select-date",{detail:{from:"select-date",message:e.value},bubbles:!0,composed:!0});e.localName==="input"&&(this.text.textContent=e.value),this.dispatchEvent(i)}}static get styles(){return`
      :host {
        
      }

      .container {
        width: fit-content;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 9px 24px;
        border: 1px solid #000;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
      }

      .active {
        animation: shadow-select 1s ease-in-out alternate infinite;
      }

      @keyframes shadow-select {
        0% {
          transform: translateZ(0);
          box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
        }
        100% {
          transform: translateZ(50px);
          box-shadow: 0 0 15px 0px rgba(0, 0, 0, 0.35);
        }
      }

      input {
        border: none;
        background: inherit;
        width: 8px;
      }

      input:focus {
        outline: none;
      }

      select {
        font-family: Satoshi, sans-serif;
        font-size: 1rem;
        font-weight: 500;
        border: none;
        background: inherit;
      }

      select:focus {
        outline: none;
      }
    `}setType(t){const e=this.container.lastElementChild;if(this.container.removeChild(e),t!=="year"){const i=document.createElement("input");i.type=t,this.text.textContent="Select date",this.container.appendChild(i)}else{this.text.textContent="";const i=Cp.content.cloneNode(!0);this.container.appendChild(i);const s=this.container.lastElementChild,r=new CustomEvent("date:select-date",{detail:{from:"select-date",message:s.value},bubbles:!0,composed:!0});this.dispatchEvent(r)}}getDate(){return this.container.lastElementChild.value}getType(){const t=this.container.lastElementChild;return t.id==="year"?"year":t.type}setAnimation(){this.container.classList.add("active")}init(){this.container=this.shadowRoot.querySelector(".container"),this.text=this.container.querySelector(".text-date"),this.container.addEventListener("click",this),this.container.addEventListener("change",this)}connectedCallback(){this.render(),this.init()}render(){this.shadowRoot.innerHTML=`
    <style>${yl.styles}</style>
    <div class="container">
      <img src="icons/icon-calendar.svg" alt="icon-calendar" class="icon-calendar">
      <span class="text-date">Select date</span>
      <input type="date">
    </div>`}}customElements.define("select-date",yl);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function Ls(n){return n+.5|0}const Ce=(n,t,e)=>Math.max(Math.min(n,e),t);function Oi(n){return Ce(Ls(n*2.55),0,255)}function Ne(n){return Ce(Ls(n*255),0,255)}function pe(n){return Ce(Ls(n/2.55)/100,0,1)}function su(n){return Ce(Ls(n*100),0,100)}const Kt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Qa=[..."0123456789ABCDEF"],Aw=n=>Qa[n&15],Mw=n=>Qa[(n&240)>>4]+Qa[n&15],Ks=n=>(n&240)>>4===(n&15),Ow=n=>Ks(n.r)&&Ks(n.g)&&Ks(n.b)&&Ks(n.a);function Pw(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&Kt[n[1]]*17,g:255&Kt[n[2]]*17,b:255&Kt[n[3]]*17,a:t===5?Kt[n[4]]*17:255}:(t===7||t===9)&&(e={r:Kt[n[1]]<<4|Kt[n[2]],g:Kt[n[3]]<<4|Kt[n[4]],b:Kt[n[5]]<<4|Kt[n[6]],a:t===9?Kt[n[7]]<<4|Kt[n[8]]:255})),e}const Lw=(n,t)=>n<255?t(n):"";function Rw(n){var t=Ow(n)?Aw:Mw;return n?"#"+t(n.r)+t(n.g)+t(n.b)+Lw(n.a,t):void 0}const Nw=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function kp(n,t,e){const i=t*Math.min(e,1-e),s=(r,o=(r+n/30)%12)=>e-i*Math.max(Math.min(o-3,9-o,1),-1);return[s(0),s(8),s(4)]}function Fw(n,t,e){const i=(s,r=(s+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function Vw(n,t,e){const i=kp(n,1,.5);let s;for(t+e>1&&(s=1/(t+e),t*=s,e*=s),s=0;s<3;s++)i[s]*=1-t-e,i[s]+=t;return i}function Bw(n,t,e,i,s){return n===s?(t-e)/i+(t<e?6:0):t===s?(e-n)/i+2:(n-t)/i+4}function bl(n){const e=n.r/255,i=n.g/255,s=n.b/255,r=Math.max(e,i,s),o=Math.min(e,i,s),a=(r+o)/2;let c,l,h;return r!==o&&(h=r-o,l=a>.5?h/(2-r-o):h/(r+o),c=Bw(e,i,s,h,r),c=c*60+.5),[c|0,l||0,a]}function vl(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(Ne)}function xl(n,t,e){return vl(kp,n,t,e)}function zw(n,t,e){return vl(Vw,n,t,e)}function $w(n,t,e){return vl(Fw,n,t,e)}function Ap(n){return(n%360+360)%360}function Uw(n){const t=Nw.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?Oi(+t[5]):Ne(+t[5]));const s=Ap(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?i=zw(s,r,o):t[1]==="hsv"?i=$w(s,r,o):i=xl(s,r,o),{r:i[0],g:i[1],b:i[2],a:e}}function jw(n,t){var e=bl(n);e[0]=Ap(e[0]+t),e=xl(e),n.r=e[0],n.g=e[1],n.b=e[2]}function qw(n){if(!n)return;const t=bl(n),e=t[0],i=su(t[1]),s=su(t[2]);return n.a<255?`hsla(${e}, ${i}%, ${s}%, ${pe(n.a)})`:`hsl(${e}, ${i}%, ${s}%)`}const ru={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},ou={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Hw(){const n={},t=Object.keys(ou),e=Object.keys(ru);let i,s,r,o,a;for(i=0;i<t.length;i++){for(o=a=t[i],s=0;s<e.length;s++)r=e[s],a=a.replace(r,ru[r]);r=parseInt(ou[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let Gs;function Ww(n){Gs||(Gs=Hw(),Gs.transparent=[0,0,0,0]);const t=Gs[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Kw=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Gw(n){const t=Kw.exec(n);let e=255,i,s,r;if(t){if(t[7]!==i){const o=+t[7];e=t[8]?Oi(o):Ce(o*255,0,255)}return i=+t[1],s=+t[3],r=+t[5],i=255&(t[2]?Oi(i):Ce(i,0,255)),s=255&(t[4]?Oi(s):Ce(s,0,255)),r=255&(t[6]?Oi(r):Ce(r,0,255)),{r:i,g:s,b:r,a:e}}}function Yw(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${pe(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const Zo=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,Ln=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function Qw(n,t,e){const i=Ln(pe(n.r)),s=Ln(pe(n.g)),r=Ln(pe(n.b));return{r:Ne(Zo(i+e*(Ln(pe(t.r))-i))),g:Ne(Zo(s+e*(Ln(pe(t.g))-s))),b:Ne(Zo(r+e*(Ln(pe(t.b))-r))),a:n.a+e*(t.a-n.a)}}function Ys(n,t,e){if(n){let i=bl(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=xl(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function Mp(n,t){return n&&Object.assign(t||{},n)}function au(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=Ne(n[3]))):(t=Mp(n,{r:0,g:0,b:0,a:1}),t.a=Ne(t.a)),t}function Xw(n){return n.charAt(0)==="r"?Gw(n):Uw(n)}class ls{constructor(t){if(t instanceof ls)return t;const e=typeof t;let i;e==="object"?i=au(t):e==="string"&&(i=Pw(t)||Ww(t)||Xw(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Mp(this._rgb);return t&&(t.a=pe(t.a)),t}set rgb(t){this._rgb=au(t)}rgbString(){return this._valid?Yw(this._rgb):void 0}hexString(){return this._valid?Rw(this._rgb):void 0}hslString(){return this._valid?qw(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,s=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,c=i.a-s.a,l=((a*c===-1?a:(a+c)/(1+a*c))+1)/2;r=1-l,i.r=255&l*i.r+r*s.r+.5,i.g=255&l*i.g+r*s.g+.5,i.b=255&l*i.b+r*s.b+.5,i.a=o*i.a+(1-o)*s.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Qw(this._rgb,t._rgb,e)),this}clone(){return new ls(this.rgb)}alpha(t){return this._rgb.a=Ne(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Ls(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Ys(this._rgb,2,t),this}darken(t){return Ys(this._rgb,2,-t),this}saturate(t){return Ys(this._rgb,1,t),this}desaturate(t){return Ys(this._rgb,1,-t),this}rotate(t){return jw(this._rgb,t),this}}/*!
 * Chart.js v4.2.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function de(){}const Jw=(()=>{let n=0;return()=>n++})();function W(n){return n===null||typeof n>"u"}function et(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function q(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function ct(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function jt(n,t){return ct(n)?n:t}function F(n,t){return typeof n>"u"?t:n}const Zw=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,Op=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function tt(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function Q(n,t,e,i){let s,r,o;if(et(n))if(r=n.length,i)for(s=r-1;s>=0;s--)t.call(e,n[s],s);else for(s=0;s<r;s++)t.call(e,n[s],s);else if(q(n))for(o=Object.keys(n),r=o.length,s=0;s<r;s++)t.call(e,n[o[s]],o[s])}function qr(n,t){let e,i,s,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(s=n[e],r=t[e],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function Hr(n){if(et(n))return n.map(Hr);if(q(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let s=0;for(;s<i;++s)t[e[s]]=Hr(n[e[s]]);return t}return n}function Pp(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function t_(n,t,e,i){if(!Pp(n))return;const s=t[n],r=e[n];q(s)&&q(r)?hs(s,r,i):t[n]=Hr(r)}function hs(n,t,e){const i=et(t)?t:[t],s=i.length;if(!q(n))return n;e=e||{};const r=e.merger||t_;let o;for(let a=0;a<s;++a){if(o=i[a],!q(o))continue;const c=Object.keys(o);for(let l=0,h=c.length;l<h;++l)r(c[l],n,o,e)}return n}function ji(n,t){return hs(n,t,{merger:e_})}function e_(n,t,e){if(!Pp(n))return;const i=t[n],s=e[n];q(i)&&q(s)?ji(i,s):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=Hr(s))}const cu={"":n=>n,x:n=>n.x,y:n=>n.y};function n_(n){const t=n.split("."),e=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function i_(n){const t=n_(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function ze(n,t){return(cu[t]||(cu[t]=i_(t)))(n)}function wl(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Xt=n=>typeof n<"u",$e=n=>typeof n=="function",lu=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function s_(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const rt=Math.PI,nt=2*rt,r_=nt+rt,Wr=Number.POSITIVE_INFINITY,o_=rt/180,lt=rt/2,Ge=rt/4,hu=rt*2/3,ke=Math.log10,he=Math.sign;function qi(n,t,e){return Math.abs(n-t)<e}function uu(n){const t=Math.round(n);n=qi(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(ke(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function a_(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((s,r)=>s-r).pop(),t}function ni(n){return!isNaN(parseFloat(n))&&isFinite(n)}function c_(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function Lp(n,t,e){let i,s,r;for(i=0,s=n.length;i<s;i++)r=n[i][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function te(n){return n*(rt/180)}function _l(n){return n*(180/rt)}function du(n){if(!ct(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function Rp(n,t){const e=t.x-n.x,i=t.y-n.y,s=Math.sqrt(e*e+i*i);let r=Math.atan2(i,e);return r<-.5*rt&&(r+=nt),{angle:r,distance:s}}function Xa(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function l_(n,t){return(n-t+r_)%nt-rt}function qt(n){return(n%nt+nt)%nt}function us(n,t,e,i){const s=qt(n),r=qt(t),o=qt(e),a=qt(r-s),c=qt(o-s),l=qt(s-r),h=qt(s-o);return s===r||s===o||i&&r===o||a>c&&l<h}function vt(n,t,e){return Math.max(t,Math.min(e,n))}function h_(n){return vt(n,-32768,32767)}function xe(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function Sl(n,t,e){e=e||(o=>n[o]<t);let i=n.length-1,s=0,r;for(;i-s>1;)r=s+i>>1,e(r)?s=r:i=r;return{lo:s,hi:i}}const we=(n,t,e,i)=>Sl(n,e,i?s=>{const r=n[s][t];return r<e||r===e&&n[s+1][t]===e}:s=>n[s][t]<e),u_=(n,t,e)=>Sl(n,e,i=>n[i][t]>=e);function d_(n,t,e){let i=0,s=n.length;for(;i<s&&n[i]<t;)i++;for(;s>i&&n[s-1]>e;)s--;return i>0||s<n.length?n.slice(i,s):n}const Np=["push","pop","shift","splice","unshift"];function f_(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Np.forEach(e=>{const i="_onData"+wl(e),s=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=s.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...r)}),o}})})}function fu(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(Np.forEach(r=>{delete n[r]}),delete n._chartjs)}function Fp(n){const t=new Set;let e,i;for(e=0,i=n.length;e<i;++e)t.add(n[e]);return t.size===i?n:Array.from(t)}const Vp=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function Bp(n,t){let e=[],i=!1;return function(...s){e=s,i||(i=!0,Vp.call(window,()=>{i=!1,n.apply(t,e)}))}}function g_(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const El=n=>n==="start"?"left":n==="end"?"right":"center",kt=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,p_=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function zp(n,t,e){const i=t.length;let s=0,r=i;if(n._sorted){const{iScale:o,_parsed:a}=n,c=o.axis,{min:l,max:h,minDefined:u,maxDefined:d}=o.getUserBounds();u&&(s=vt(Math.min(we(a,o.axis,l).lo,e?i:we(t,c,o.getPixelForValue(l)).lo),0,i-1)),d?r=vt(Math.max(we(a,o.axis,h,!0).hi+1,e?0:we(t,c,o.getPixelForValue(h),!0).hi+1),s,i)-s:r=i-s}return{start:s,count:r}}function $p(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,s={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=s,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,s),r}const Qs=n=>n===0||n===1,gu=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*nt/e)),pu=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*nt/e)+1,Hi={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*lt)+1,easeOutSine:n=>Math.sin(n*lt),easeInOutSine:n=>-.5*(Math.cos(rt*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Qs(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Qs(n)?n:gu(n,.075,.3),easeOutElastic:n=>Qs(n)?n:pu(n,.075,.3),easeInOutElastic(n){return Qs(n)?n:n<.5?.5*gu(n*2,.1125,.45):.5+.5*pu(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-Hi.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Hi.easeInBounce(n*2)*.5:Hi.easeOutBounce(n*2-1)*.5+.5};function Up(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function mu(n){return Up(n)?n:new ls(n)}function ta(n){return Up(n)?n:new ls(n).saturate(.5).darken(.1).hexString()}const m_=["x","y","borderWidth","radius","tension"],y_=["color","borderColor","backgroundColor"];function b_(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:y_},numbers:{type:"number",properties:m_}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function v_(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const yu=new Map;function x_(n,t){t=t||{};const e=n+JSON.stringify(t);let i=yu.get(e);return i||(i=new Intl.NumberFormat(n,t),yu.set(e,i)),i}function Rs(n,t,e){return x_(t,e).format(n)}const jp={values(n){return et(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let s,r=n;if(e.length>1){const l=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(l<1e-4||l>1e15)&&(s="scientific"),r=w_(n,e)}const o=ke(Math.abs(r)),a=Math.max(Math.min(-1*Math.floor(o),20),0),c={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(c,this.options.ticks.format),Rs(n,i,c)},logarithmic(n,t,e){if(n===0)return"0";const i=e[t].significand||n/Math.pow(10,Math.floor(ke(n)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?jp.numeric.call(this,n,t,e):""}};function w_(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Po={formatters:jp};function __(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Po.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Sn=Object.create(null),Ja=Object.create(null);function Wi(n,t){if(!t)return n;const e=t.split(".");for(let i=0,s=e.length;i<s;++i){const r=e[i];n=n[r]||(n[r]=Object.create(null))}return n}function ea(n,t,e){return typeof t=="string"?hs(Wi(n,t),e):hs(Wi(n,""),t)}class S_{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>ta(s.backgroundColor),this.hoverBorderColor=(i,s)=>ta(s.borderColor),this.hoverColor=(i,s)=>ta(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return ea(this,t,e)}get(t){return Wi(this,t)}describe(t,e){return ea(Ja,t,e)}override(t,e){return ea(Sn,t,e)}route(t,e,i,s){const r=Wi(this,t),o=Wi(this,i),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const c=this[a],l=o[s];return q(c)?Object.assign({},l,c):F(c,l)},set(c){this[a]=c}}})}apply(t){t.forEach(e=>e(this))}}var ft=new S_({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[b_,v_,__]);function E_(n){return!n||W(n.size)||W(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function Kr(n,t,e,i,s){let r=t[s];return r||(r=t[s]=n.measureText(s).width,e.push(s)),r>i&&(i=r),i}function I_(n,t,e,i){i=i||{};let s=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},r=i.garbageCollect=[],i.font=t),n.save(),n.font=t;let o=0;const a=e.length;let c,l,h,u,d;for(c=0;c<a;c++)if(u=e[c],u!=null&&et(u)!==!0)o=Kr(n,s,r,o,u);else if(et(u))for(l=0,h=u.length;l<h;l++)d=u[l],d!=null&&!et(d)&&(o=Kr(n,s,r,o,d));n.restore();const f=r.length/2;if(f>e.length){for(c=0;c<f;c++)delete s[r[c]];r.splice(0,f)}return o}function Ye(n,t,e){const i=n.currentDevicePixelRatio,s=e!==0?Math.max(e/2,.5):0;return Math.round((t-s)*i)/i+s}function bu(n,t){t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore()}function Za(n,t,e,i){qp(n,t,e,i,null)}function qp(n,t,e,i,s){let r,o,a,c,l,h,u,d;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*o_;if(f&&typeof f=="object"&&(r=f.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(m),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(p)||p<=0)){switch(n.beginPath(),f){default:s?n.ellipse(e,i,s/2,p,0,0,nt):n.arc(e,i,p,0,nt),n.closePath();break;case"triangle":h=s?s/2:p,n.moveTo(e+Math.sin(m)*h,i-Math.cos(m)*p),m+=hu,n.lineTo(e+Math.sin(m)*h,i-Math.cos(m)*p),m+=hu,n.lineTo(e+Math.sin(m)*h,i-Math.cos(m)*p),n.closePath();break;case"rectRounded":l=p*.516,c=p-l,o=Math.cos(m+Ge)*c,u=Math.cos(m+Ge)*(s?s/2-l:c),a=Math.sin(m+Ge)*c,d=Math.sin(m+Ge)*(s?s/2-l:c),n.arc(e-u,i-a,l,m-rt,m-lt),n.arc(e+d,i-o,l,m-lt,m),n.arc(e+u,i+a,l,m,m+lt),n.arc(e-d,i+o,l,m+lt,m+rt),n.closePath();break;case"rect":if(!g){c=Math.SQRT1_2*p,h=s?s/2:c,n.rect(e-h,i-c,2*h,2*c);break}m+=Ge;case"rectRot":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+d,i-o),n.lineTo(e+u,i+a),n.lineTo(e-d,i+o),n.closePath();break;case"crossRot":m+=Ge;case"cross":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+d,i-o),n.lineTo(e-d,i+o);break;case"star":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+d,i-o),n.lineTo(e-d,i+o),m+=Ge,u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,d=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+d,i-o),n.lineTo(e-d,i+o);break;case"line":o=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,n.moveTo(e-o,i-a),n.lineTo(e+o,i+a);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function ds(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function Lo(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Ro(n){n.restore()}function T_(n,t,e,i,s){if(!t)return n.lineTo(e.x,e.y);if(s==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else s==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function D_(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function En(n,t,e,i,s,r={}){const o=et(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let c,l;for(n.save(),n.font=s.string,C_(n,r),c=0;c<o.length;++c)l=o[c],r.backdrop&&A_(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),W(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(l,e,i,r.maxWidth)),n.fillText(l,e,i,r.maxWidth),k_(n,e,i,l,r),i+=s.lineHeight;n.restore()}function C_(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),W(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function k_(n,t,e,i,s){if(s.strikethrough||s.underline){const r=n.measureText(i),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,c=e-r.actualBoundingBoxAscent,l=e+r.actualBoundingBoxDescent,h=s.strikethrough?(c+l)/2:l;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=s.decorationWidth||2,n.moveTo(o,h),n.lineTo(a,h),n.stroke()}}function A_(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function fs(n,t){const{x:e,y:i,w:s,h:r,radius:o}=t;n.arc(e+o.topLeft,i+o.topLeft,o.topLeft,-lt,rt,!0),n.lineTo(e,i+r-o.bottomLeft),n.arc(e+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,rt,lt,!0),n.lineTo(e+s-o.bottomRight,i+r),n.arc(e+s-o.bottomRight,i+r-o.bottomRight,o.bottomRight,lt,0,!0),n.lineTo(e+s,i+o.topRight),n.arc(e+s-o.topRight,i+o.topRight,o.topRight,0,-lt,!0),n.lineTo(e+o.topLeft,i)}const M_=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,O_=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function P_(n,t){const e=(""+n).match(M_);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const L_=n=>+n||0;function Il(n,t){const e={},i=q(t),s=i?Object.keys(t):t,r=q(n)?i?o=>F(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of s)e[o]=L_(r(o));return e}function Hp(n){return Il(n,{top:"y",right:"x",bottom:"y",left:"x"})}function dn(n){return Il(n,["topLeft","topRight","bottomLeft","bottomRight"])}function Pt(n){const t=Hp(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function mt(n,t){n=n||{},t=t||ft.font;let e=F(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=F(n.style,t.style);i&&!(""+i).match(O_)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:F(n.family,t.family),lineHeight:P_(F(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:F(n.weight,t.weight),string:""};return s.string=E_(s),s}function Pi(n,t,e,i){let s=!0,r,o,a;for(r=0,o=n.length;r<o;++r)if(a=n[r],a!==void 0&&(t!==void 0&&typeof a=="function"&&(a=a(t),s=!1),e!==void 0&&et(a)&&(a=a[e%a.length],s=!1),a!==void 0))return i&&!s&&(i.cacheable=!1),a}function R_(n,t,e){const{min:i,max:s}=n,r=Op(t,(s-i)/2),o=(a,c)=>e&&a===0?0:a+c;return{min:o(i,-Math.abs(r)),max:o(s,r)}}function We(n,t){return Object.assign(Object.create(n),t)}function Tl(n,t=[""],e=n,i,s=()=>n[0]){Xt(i)||(i=Yp("_fallback",n));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:e,_fallback:i,_getTarget:s,override:o=>Tl([o,...n],t,e,i)};return new Proxy(r,{deleteProperty(o,a){return delete o[a],delete o._keys,delete n[0][a],!0},get(o,a){return Kp(o,a,()=>j_(a,t,n,o))},getOwnPropertyDescriptor(o,a){return Reflect.getOwnPropertyDescriptor(o._scopes[0],a)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(o,a){return xu(o).includes(a)},ownKeys(o){return xu(o)},set(o,a,c){const l=o._storage||(o._storage=s());return o[a]=l[a]=c,delete o._keys,!0}})}function ii(n,t,e,i){const s={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:Wp(n,i),setContext:r=>ii(n,r,e,i),override:r=>ii(n.override(r),t,e,i)};return new Proxy(s,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return Kp(r,o,()=>F_(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function Wp(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=n;return{allKeys:s,scriptable:e,indexable:i,isScriptable:$e(e)?e:()=>e,isIndexable:$e(i)?i:()=>i}}const N_=(n,t)=>n?n+wl(t):t,Dl=(n,t)=>q(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Kp(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t))return n[t];const i=e();return n[t]=i,i}function F_(n,t,e){const{_proxy:i,_context:s,_subProxy:r,_descriptors:o}=n;let a=i[t];return $e(a)&&o.isScriptable(t)&&(a=V_(t,a,n,e)),et(a)&&a.length&&(a=B_(t,a,n,o.isIndexable)),Dl(t,a)&&(a=ii(a,s,r&&r[t],o)),a}function V_(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);return a.add(n),t=t(r,o||i),a.delete(n),Dl(n,t)&&(t=Cl(s._scopes,s,n,t)),t}function B_(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_descriptors:a}=e;if(Xt(r.index)&&i(n))t=t[r.index%t.length];else if(q(t[0])){const c=t,l=s._scopes.filter(h=>h!==c);t=[];for(const h of c){const u=Cl(l,s,n,h);t.push(ii(u,r,o&&o[n],a))}}return t}function Gp(n,t,e){return $e(n)?n(t,e):n}const z_=(n,t)=>n===!0?t:typeof n=="string"?ze(t,n):void 0;function $_(n,t,e,i,s){for(const r of t){const o=z_(e,r);if(o){n.add(o);const a=Gp(o._fallback,e,s);if(Xt(a)&&a!==e&&a!==i)return a}else if(o===!1&&Xt(i)&&e!==i)return null}return!1}function Cl(n,t,e,i){const s=t._rootScopes,r=Gp(t._fallback,e,i),o=[...n,...s],a=new Set;a.add(i);let c=vu(a,o,e,r||e,i);return c===null||Xt(r)&&r!==e&&(c=vu(a,o,r,c,i),c===null)?!1:Tl(Array.from(a),[""],s,r,()=>U_(t,e,i))}function vu(n,t,e,i,s){for(;e;)e=$_(n,t,e,i,s);return e}function U_(n,t,e){const i=n._getTarget();t in i||(i[t]={});const s=i[t];return et(s)&&q(e)?e:s||{}}function j_(n,t,e,i){let s;for(const r of t)if(s=Yp(N_(r,n),e),Xt(s))return Dl(n,s)?Cl(e,i,n,s):s}function Yp(n,t){for(const e of t){if(!e)continue;const i=e[n];if(Xt(i))return i}}function xu(n){let t=n._keys;return t||(t=n._keys=q_(n._scopes)),t}function q_(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function Qp(n,t,e,i){const{iScale:s}=n,{key:r="r"}=this._parsing,o=new Array(i);let a,c,l,h;for(a=0,c=i;a<c;++a)l=a+e,h=t[l],o[a]={r:s.parse(ze(h,r),l)};return o}const H_=Number.EPSILON||1e-14,si=(n,t)=>t<n.length&&!n[t].skip&&n[t],Xp=n=>n==="x"?"y":"x";function W_(n,t,e,i){const s=n.skip?t:n,r=t,o=e.skip?t:e,a=Xa(r,s),c=Xa(o,r);let l=a/(a+c),h=c/(a+c);l=isNaN(l)?0:l,h=isNaN(h)?0:h;const u=i*l,d=i*h;return{previous:{x:r.x-u*(o.x-s.x),y:r.y-u*(o.y-s.y)},next:{x:r.x+d*(o.x-s.x),y:r.y+d*(o.y-s.y)}}}function K_(n,t,e){const i=n.length;let s,r,o,a,c,l=si(n,0);for(let h=0;h<i-1;++h)if(c=l,l=si(n,h+1),!(!c||!l)){if(qi(t[h],0,H_)){e[h]=e[h+1]=0;continue}s=e[h]/t[h],r=e[h+1]/t[h],a=Math.pow(s,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[h]=s*o*t[h],e[h+1]=r*o*t[h])}}function G_(n,t,e="x"){const i=Xp(e),s=n.length;let r,o,a,c=si(n,0);for(let l=0;l<s;++l){if(o=a,a=c,c=si(n,l+1),!a)continue;const h=a[e],u=a[i];o&&(r=(h-o[e])/3,a[`cp1${e}`]=h-r,a[`cp1${i}`]=u-r*t[l]),c&&(r=(c[e]-h)/3,a[`cp2${e}`]=h+r,a[`cp2${i}`]=u+r*t[l])}}function Y_(n,t="x"){const e=Xp(t),i=n.length,s=Array(i).fill(0),r=Array(i);let o,a,c,l=si(n,0);for(o=0;o<i;++o)if(a=c,c=l,l=si(n,o+1),!!c){if(l){const h=l[t]-c[t];s[o]=h!==0?(l[e]-c[e])/h:0}r[o]=a?l?he(s[o-1])!==he(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}K_(n,s,r),G_(n,r,t)}function Xs(n,t,e){return Math.max(Math.min(n,e),t)}function Q_(n,t){let e,i,s,r,o,a=ds(n[0],t);for(e=0,i=n.length;e<i;++e)o=r,r=a,a=e<i-1&&ds(n[e+1],t),r&&(s=n[e],o&&(s.cp1x=Xs(s.cp1x,t.left,t.right),s.cp1y=Xs(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=Xs(s.cp2x,t.left,t.right),s.cp2y=Xs(s.cp2y,t.top,t.bottom)))}function X_(n,t,e,i,s){let r,o,a,c;if(t.spanGaps&&(n=n.filter(l=>!l.skip)),t.cubicInterpolationMode==="monotone")Y_(n,s);else{let l=i?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],c=W_(l,a,n[Math.min(r+1,o-(i?0:1))%o],t.tension),a.cp1x=c.previous.x,a.cp1y=c.previous.y,a.cp2x=c.next.x,a.cp2y=c.next.y,l=a}t.capBezierPoints&&Q_(n,e)}function Jp(){return typeof window<"u"&&typeof document<"u"}function kl(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Gr(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const No=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function J_(n,t){return No(n).getPropertyValue(t)}const Z_=["top","right","bottom","left"];function fn(n,t,e){const i={};e=e?"-"+e:"";for(let s=0;s<4;s++){const r=Z_[s];i[r]=parseFloat(n[t+"-"+r+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const tS=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function eS(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:s,offsetY:r}=i;let o=!1,a,c;if(tS(s,r,n.target))a=s,c=r;else{const l=t.getBoundingClientRect();a=i.clientX-l.left,c=i.clientY-l.top,o=!0}return{x:a,y:c,box:o}}function tn(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,s=No(e),r=s.boxSizing==="border-box",o=fn(s,"padding"),a=fn(s,"border","width"),{x:c,y:l,box:h}=eS(n,e),u=o.left+(h&&a.left),d=o.top+(h&&a.top);let{width:f,height:g}=t;return r&&(f-=o.width+a.width,g-=o.height+a.height),{x:Math.round((c-u)/f*e.width/i),y:Math.round((l-d)/g*e.height/i)}}function nS(n,t,e){let i,s;if(t===void 0||e===void 0){const r=kl(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=No(r),c=fn(a,"border","width"),l=fn(a,"padding");t=o.width-l.width-c.width,e=o.height-l.height-c.height,i=Gr(a.maxWidth,r,"clientWidth"),s=Gr(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:i||Wr,maxHeight:s||Wr}}const Js=n=>Math.round(n*10)/10;function iS(n,t,e,i){const s=No(n),r=fn(s,"margin"),o=Gr(s.maxWidth,n,"clientWidth")||Wr,a=Gr(s.maxHeight,n,"clientHeight")||Wr,c=nS(n,t,e);let{width:l,height:h}=c;if(s.boxSizing==="content-box"){const d=fn(s,"border","width"),f=fn(s,"padding");l-=f.width+d.width,h-=f.height+d.height}return l=Math.max(0,l-r.width),h=Math.max(0,i?l/i:h-r.height),l=Js(Math.min(l,o,c.maxWidth)),h=Js(Math.min(h,a,c.maxHeight)),l&&!h&&(h=Js(l/2)),(t!==void 0||e!==void 0)&&i&&c.height&&h>c.height&&(h=c.height,l=Js(Math.floor(h*i))),{width:l,height:h}}function wu(n,t,e){const i=t||1,s=Math.floor(n.height*i),r=Math.floor(n.width*i);n.height=Math.floor(n.height),n.width=Math.floor(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||o.height!==s||o.width!==r?(n.currentDevicePixelRatio=i,o.height=s,o.width=r,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const sS=function(){let n=!1;try{const t={get passive(){return n=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch{}return n}();function _u(n,t){const e=J_(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function en(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function rS(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function oS(n,t,e,i){const s={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=en(n,s,e),a=en(s,r,e),c=en(r,t,e),l=en(o,a,e),h=en(a,c,e);return en(l,h,e)}const aS=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},cS=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function jn(n,t,e){return n?aS(t,e):cS()}function Zp(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function tm(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function em(n){return n==="angle"?{between:us,compare:l_,normalize:qt}:{between:xe,compare:(t,e)=>t-e,normalize:t=>t}}function Su({start:n,end:t,count:e,loop:i,style:s}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:s}}function lS(n,t,e){const{property:i,start:s,end:r}=e,{between:o,normalize:a}=em(i),c=t.length;let{start:l,end:h,loop:u}=n,d,f;if(u){for(l+=c,h+=c,d=0,f=c;d<f&&o(a(t[l%c][i]),s,r);++d)l--,h--;l%=c,h%=c}return h<l&&(h+=c),{start:l,end:h,loop:u,style:n.style}}function nm(n,t,e){if(!e)return[n];const{property:i,start:s,end:r}=e,o=t.length,{compare:a,between:c,normalize:l}=em(i),{start:h,end:u,loop:d,style:f}=lS(n,t,e),g=[];let p=!1,m=null,y,b,w;const S=()=>c(s,w,y)&&a(s,w)!==0,x=()=>a(r,y)===0||c(r,w,y),E=()=>p||S(),I=()=>!p||x();for(let D=h,R=h;D<=u;++D)b=t[D%o],!b.skip&&(y=l(b[i]),y!==w&&(p=c(y,s,r),m===null&&E()&&(m=a(y,s)===0?D:R),m!==null&&I()&&(g.push(Su({start:m,end:D,loop:d,count:o,style:f})),m=null),R=D,w=y));return m!==null&&g.push(Su({start:m,end:u,loop:d,count:o,style:f})),g}function im(n,t){const e=[],i=n.segments;for(let s=0;s<i.length;s++){const r=nm(i[s],n.points,t);r.length&&e.push(...r)}return e}function hS(n,t,e,i){let s=0,r=t-1;if(e&&!i)for(;s<t&&!n[s].skip;)s++;for(;s<t&&n[s].skip;)s++;for(s%=t,e&&(r+=s);r>s&&n[r%t].skip;)r--;return r%=t,{start:s,end:r}}function uS(n,t,e,i){const s=n.length,r=[];let o=t,a=n[t],c;for(c=t+1;c<=e;++c){const l=n[c%s];l.skip||l.stop?a.skip||(i=!1,r.push({start:t%s,end:(c-1)%s,loop:i}),t=o=l.stop?c:null):(o=c,a.skip&&(t=c)),a=l}return o!==null&&r.push({start:t%s,end:o%s,loop:i}),r}function dS(n,t){const e=n.points,i=n.options.spanGaps,s=e.length;if(!s)return[];const r=!!n._loop,{start:o,end:a}=hS(e,s,r,i);if(i===!0)return Eu(n,[{start:o,end:a,loop:r}],e,t);const c=a<o?a+s:a,l=!!n._fullLoop&&o===0&&a===s-1;return Eu(n,uS(e,o,c,l),e,t)}function Eu(n,t,e,i){return!i||!i.setContext||!e?t:fS(n,t,e,i)}function fS(n,t,e,i){const s=n._chart.getContext(),r=Iu(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,c=e.length,l=[];let h=r,u=t[0].start,d=u;function f(g,p,m,y){const b=a?-1:1;if(g!==p){for(g+=c;e[g%c].skip;)g-=b;for(;e[p%c].skip;)p+=b;g%c!==p%c&&(l.push({start:g%c,end:p%c,loop:m,style:y}),h=y,u=p%c)}}for(const g of t){u=a?u:g.start;let p=e[u%c],m;for(d=u+1;d<=g.end;d++){const y=e[d%c];m=Iu(i.setContext(We(s,{type:"segment",p0:p,p1:y,p0DataIndex:(d-1)%c,p1DataIndex:d%c,datasetIndex:o}))),gS(m,h)&&f(u,d-1,g.loop,h),p=y,h=m}u<d-1&&f(u,d-1,g.loop,h)}return l}function Iu(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function gS(n,t){return t&&JSON.stringify(n)!==JSON.stringify(t)}/*!
 * Chart.js v4.2.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class pS{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const r=e.listeners[s],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Vp.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const r=i.items;let o=r.length-1,a=!1,c;for(;o>=0;--o)c=r[o],c._active?(c._total>i.duration&&(i.duration=c._total),c.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),r.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var fe=new pS;const Tu="transparent",mS={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=mu(n||Tu),s=i.valid&&mu(t||Tu);return s&&s.valid?s.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class yS{constructor(t,e,i,s){const r=e[i];s=Pi([t.to,s,r,t.from]);const o=Pi([t.from,r,s]);this._active=!0,this._fn=t.fn||mS[t.type||typeof o],this._easing=Hi[t.easing]||Hi.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=Pi([t.to,e,s,t.from]),this._from=Pi([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,r=this._from,o=this._loop,a=this._to;let c;if(this._active=r!==a&&(o||e<i),!this._active){this._target[s]=a,this._notify(!0);return}if(e<0){this._target[s]=r;return}c=e/i%2,c=o&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[s]=this._fn(r,a,c)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][e]()}}class sm{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!q(t))return;const e=Object.keys(ft.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const r=t[s];if(!q(r))return;const o={};for(const a of e)o[a]=r[a];(et(r.properties)&&r.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,o)})})}_animateOptions(t,e){const i=e.options,s=vS(t,i);if(!s)return[];const r=this._createAnimations(s,i);return i.$shared&&bS(t.options.$animations,i).then(()=>{t.options=i},()=>{}),r}_createAnimations(t,e){const i=this._properties,s=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let c;for(c=o.length-1;c>=0;--c){const l=o[c];if(l.charAt(0)==="$")continue;if(l==="options"){s.push(...this._animateOptions(t,e));continue}const h=e[l];let u=r[l];const d=i.get(l);if(u)if(d&&u.active()){u.update(d,h,a);continue}else u.cancel();if(!d||!d.duration){t[l]=h;continue}r[l]=u=new yS(d,t,l,h),s.push(u)}return s}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return fe.add(this._chart,i),!0}}function bS(n,t){const e=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const r=n[i[s]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function vS(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Du(n,t){const e=n&&n.options||{},i=e.reverse,s=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:i?r:s,end:i?s:r}}function xS(n,t,e){if(e===!1)return!1;const i=Du(n,e),s=Du(t,e);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function wS(n){let t,e,i,s;return q(n)?(t=n.top,e=n.right,i=n.bottom,s=n.left):t=e=i=s=n,{top:t,right:e,bottom:i,left:s,disabled:n===!1}}function rm(n,t){const e=[],i=n._getSortedDatasetMetas(t);let s,r;for(s=0,r=i.length;s<r;++s)e.push(i[s].index);return e}function Cu(n,t,e,i={}){const s=n.keys,r=i.mode==="single";let o,a,c,l;if(t!==null){for(o=0,a=s.length;o<a;++o){if(c=+s[o],c===e){if(i.all)continue;break}l=n.values[c],ct(l)&&(r||t===0||he(t)===he(l))&&(t+=l)}return t}}function _S(n){const t=Object.keys(n),e=new Array(t.length);let i,s,r;for(i=0,s=t.length;i<s;++i)r=t[i],e[i]={x:r,y:n[r]};return e}function ku(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function SS(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function ES(n){const{min:t,max:e,minDefined:i,maxDefined:s}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?e:Number.POSITIVE_INFINITY}}function IS(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function Au(n,t,e,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const r=n[s.index];if(e&&r>0||!e&&r<0)return s.index}return null}function Mu(n,t){const{chart:e,_cachedMeta:i}=n,s=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=i,c=r.axis,l=o.axis,h=SS(r,o,i),u=t.length;let d;for(let f=0;f<u;++f){const g=t[f],{[c]:p,[l]:m}=g,y=g._stacks||(g._stacks={});d=y[l]=IS(s,h,p),d[a]=m,d._top=Au(d,o,!0,i.type),d._bottom=Au(d,o,!1,i.type);const b=d._visualValues||(d._visualValues={});b[a]=m}}function na(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function TS(n,t){return We(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function DS(n,t,e){return We(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function _i(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const s of t){const r=s._stacks;if(!r||r[i]===void 0||r[i][e]===void 0)return;delete r[i][e],r[i]._visualValues!==void 0&&r[i]._visualValues[e]!==void 0&&delete r[i]._visualValues[e]}}}const ia=n=>n==="reset"||n==="none",Ou=(n,t)=>t?n:Object.assign({},n),CS=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:rm(e,!0),values:null};class ee{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=ku(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&_i(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(u,d,f,g)=>u==="x"?d:u==="r"?g:f,r=e.xAxisID=F(i.xAxisID,na(t,"x")),o=e.yAxisID=F(i.yAxisID,na(t,"y")),a=e.rAxisID=F(i.rAxisID,na(t,"r")),c=e.indexAxis,l=e.iAxisID=s(c,r,o,a),h=e.vAxisID=s(c,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&fu(this._data,this),t._stacked&&_i(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(q(e))this._data=_S(e);else if(i!==e){if(i){fu(i,this);const s=this._cachedMeta;_i(s),s._parsed=[]}e&&Object.isExtensible(e)&&f_(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const r=e._stacked;e._stacked=ku(e.vScale,e),e.stack!==i.stack&&(s=!0,_i(e),e.stack=i.stack),this._resyncElements(t),(s||r!==e._stacked)&&Mu(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:s}=this,{iScale:r,_stacked:o}=i,a=r.axis;let c=t===0&&e===s.length?!0:i._sorted,l=t>0&&i._parsed[t-1],h,u,d;if(this._parsing===!1)i._parsed=s,i._sorted=!0,d=s;else{et(s[t])?d=this.parseArrayData(i,s,t,e):q(s[t])?d=this.parseObjectData(i,s,t,e):d=this.parsePrimitiveData(i,s,t,e);const f=()=>u[a]===null||l&&u[a]<l[a];for(h=0;h<e;++h)i._parsed[h+t]=u=d[h],c&&(f()&&(c=!1),l=u);i._sorted=c}o&&Mu(this,d)}parsePrimitiveData(t,e,i,s){const{iScale:r,vScale:o}=t,a=r.axis,c=o.axis,l=r.getLabels(),h=r===o,u=new Array(s);let d,f,g;for(d=0,f=s;d<f;++d)g=d+i,u[d]={[a]:h||r.parse(l[g],g),[c]:o.parse(e[g],g)};return u}parseArrayData(t,e,i,s){const{xScale:r,yScale:o}=t,a=new Array(s);let c,l,h,u;for(c=0,l=s;c<l;++c)h=c+i,u=e[h],a[c]={x:r.parse(u[0],h),y:o.parse(u[1],h)};return a}parseObjectData(t,e,i,s){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,l=new Array(s);let h,u,d,f;for(h=0,u=s;h<u;++h)d=h+i,f=e[d],l[h]={x:r.parse(ze(f,a),d),y:o.parse(ze(f,c),d)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:rm(s,!0),values:e._stacks[t.axis]._visualValues};return Cu(a,o,r.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const r=i[e.axis];let o=r===null?NaN:r;const a=s&&i._stacks[e.axis];s&&a&&(s.values=a,o=Cu(s,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,r=i._sorted&&t===i.iScale,o=s.length,a=this._getOtherScale(t),c=CS(e,i,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:u}=ES(a);let d,f;function g(){f=s[d];const p=f[a.axis];return!ct(f[t.axis])||h>p||u<p}for(d=0;d<o&&!(!g()&&(this.updateRangeFromParsed(l,t,f,c),r));++d);if(r){for(d=o-1;d>=0;--d)if(!g()){this.updateRangeFromParsed(l,t,f,c);break}}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,r,o;for(s=0,r=e.length;s<r;++s)o=e[s][t.axis],ct(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:s?""+s.getLabelForValue(r[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=wS(F(this.options.clip,xS(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],r=e.chartArea,o=[],a=this._drawStart||0,c=this._drawCount||s.length-a,l=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,r,a,c),h=a;h<a+c;++h){const u=s[h];u.hidden||(u.active&&l?o.push(u):u.draw(t,r))}for(h=0;h<o.length;++h)o[h].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=DS(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=s.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=TS(this.chart.getContext(),this.index)),r.dataset=s,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],c=this.enableOptionSharing&&Xt(i);if(a)return Ou(a,c);const l=this.chart.config,h=l.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],d=l.getOptionScopes(this.getDataset(),h),f=Object.keys(ft.elements[t]),g=()=>this.getContext(i,s,e),p=l.resolveNamedOptions(d,f,g,u);return p.$shared&&(p.$shared=c,r[o]=Object.freeze(Ou(p,c))),p}_resolveAnimations(t,e,i){const s=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let c;if(s.options.animation!==!1){const h=this.chart.config,u=h.datasetAnimationScopeKeys(this._type,e),d=h.getOptionScopes(this.getDataset(),u);c=h.createResolver(d,this.getContext(t,i,e))}const l=new sm(s,c&&c.animations);return c&&c._cacheable&&(r[o]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||ia(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),s=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(e,r)||r!==s;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:o}}updateElement(t,e,i,s){ia(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!ia(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const r=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[a,c,l]of this._syncList)this[a](c,l);this._syncList=[];const s=i.length,r=e.length,o=Math.min(r,s);o&&this.parse(0,o),r>s?this._insertElements(s,r-s,t):r<s&&this._removeElements(r,s-r)}_insertElements(t,e,i=!0){const s=this._cachedMeta,r=s.data,o=t+e;let a;const c=l=>{for(l.length+=e,a=l.length-1;a>=o;a--)l[a]=l[a-e]};for(c(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&c(s._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&_i(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}A(ee,"defaults",{}),A(ee,"datasetElementType",null),A(ee,"dataElementType",null);function kS(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let i=[];for(let s=0,r=e.length;s<r;s++)i=i.concat(e[s].controller.getAllParsedValues(n));n._cache.$bar=Fp(i.sort((s,r)=>s-r))}return n._cache.$bar}function AS(n){const t=n.iScale,e=kS(t,n.type);let i=t._length,s,r,o,a;const c=()=>{o===32767||o===-32768||(Xt(a)&&(i=Math.min(i,Math.abs(o-a)||i)),a=o)};for(s=0,r=e.length;s<r;++s)o=t.getPixelForValue(e[s]),c();for(a=void 0,s=0,r=t.ticks.length;s<r;++s)o=t.getPixelForTick(s),c();return i}function MS(n,t,e,i){const s=e.barThickness;let r,o;return W(s)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=s*i,o=1),{chunk:r/i,ratio:o,start:t.pixels[n]-r/2}}function OS(n,t,e,i){const s=t.pixels,r=s[n];let o=n>0?s[n-1]:null,a=n<s.length-1?s[n+1]:null;const c=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const l=r-(r-Math.min(o,a))/2*c;return{chunk:Math.abs(a-o)/2*c/i,ratio:e.barPercentage,start:l}}function PS(n,t,e,i){const s=e.parse(n[0],i),r=e.parse(n[1],i),o=Math.min(s,r),a=Math.max(s,r);let c=o,l=a;Math.abs(o)>Math.abs(a)&&(c=a,l=o),t[e.axis]=l,t._custom={barStart:c,barEnd:l,start:s,end:r,min:o,max:a}}function om(n,t,e,i){return et(n)?PS(n,t,e,i):t[e.axis]=e.parse(n,i),t}function Pu(n,t,e,i){const s=n.iScale,r=n.vScale,o=s.getLabels(),a=s===r,c=[];let l,h,u,d;for(l=e,h=e+i;l<h;++l)d=t[l],u={},u[s.axis]=a||s.parse(o[l],l),c.push(om(d,u,r,l));return c}function sa(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function LS(n,t,e){return n!==0?he(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function RS(n){let t,e,i,s,r;return n.horizontal?(t=n.base>n.x,e="left",i="right"):(t=n.base<n.y,e="bottom",i="top"),t?(s="end",r="start"):(s="start",r="end"),{start:e,end:i,reverse:t,top:s,bottom:r}}function NS(n,t,e,i){let s=t.borderSkipped;const r={};if(!s){n.borderSkipped=r;return}if(s===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:c,top:l,bottom:h}=RS(n);s==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===i?s=l:(e._bottom||0)===i?s=h:(r[Lu(h,o,a,c)]=!0,s=l)),r[Lu(s,o,a,c)]=!0,n.borderSkipped=r}function Lu(n,t,e,i){return i?(n=FS(n,t,e),n=Ru(n,e,t)):n=Ru(n,t,e),n}function FS(n,t,e){return n===t?e:n===e?t:n}function Ru(n,t,e){return n==="start"?t:n==="end"?e:n}function VS(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class dr extends ee{parsePrimitiveData(t,e,i,s){return Pu(t,e,i,s)}parseArrayData(t,e,i,s){return Pu(t,e,i,s)}parseObjectData(t,e,i,s){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:c="y"}=this._parsing,l=r.axis==="x"?a:c,h=o.axis==="x"?a:c,u=[];let d,f,g,p;for(d=i,f=i+s;d<f;++d)p=e[d],g={},g[r.axis]=r.parse(ze(p,l),d),u.push(om(ze(p,h),g,o,d));return u}updateRangeFromParsed(t,e,i,s){super.updateRangeFromParsed(t,e,i,s);const r=i._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:s}=e,r=this.getParsed(t),o=r._custom,a=sa(o)?"["+o.start+", "+o.end+"]":""+s.getLabelForValue(r[s.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,s){const r=s==="reset",{index:o,_cachedMeta:{vScale:a}}=this,c=a.getBasePixel(),l=a.isHorizontal(),h=this._getRuler(),{sharedOptions:u,includeOptions:d}=this._getSharedOptions(e,s);for(let f=e;f<e+i;f++){const g=this.getParsed(f),p=r||W(g[a.axis])?{base:c,head:c}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,h),y=(g._stacks||{})[a.axis],b={horizontal:l,base:p.base,enableBorderRadius:!y||sa(g._custom)||o===y._top||o===y._bottom,x:l?p.head:m.center,y:l?m.center:p.head,height:l?m.size:Math.abs(p.size),width:l?Math.abs(p.size):m.size};d&&(b.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const w=b.options||t[f].options;NS(b,w,y,o),VS(b,w,h.ratio),this.updateElement(t[f],f,b,s)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(c=>c.controller.options.grouped),r=i.options.stacked,o=[],a=c=>{const l=c.controller.getParsed(e),h=l&&l[c.vScale.axis];if(W(h)||isNaN(h))return!0};for(const c of s)if(!(e!==void 0&&a(c))&&((r===!1||o.indexOf(c.stack)===-1||r===void 0&&c.stack===void 0)&&o.push(c.stack),c.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,i){const s=this._getStacks(t,i),r=e!==void 0?s.indexOf(e):-1;return r===-1?s.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,s=[];let r,o;for(r=0,o=e.data.length;r<o;++r)s.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const a=t.barThickness;return{min:a||AS(e),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:s},options:{base:r,minBarLength:o}}=this,a=r||0,c=this.getParsed(t),l=c._custom,h=sa(l);let u=c[e.axis],d=0,f=i?this.applyStack(e,c,i):u,g,p;f!==u&&(d=f-u,f=u),h&&(u=l.barStart,f=l.barEnd-l.barStart,u!==0&&he(u)!==he(l.barEnd)&&(d=0),d+=u);const m=!W(r)&&!h?r:d;let y=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=e.getPixelForValue(d+f):g=y,p=g-y,Math.abs(p)<o){p=LS(p,e,a)*o,u===a&&(y-=p/2);const b=e.getPixelForDecimal(0),w=e.getPixelForDecimal(1),S=Math.min(b,w),x=Math.max(b,w);y=Math.max(Math.min(y,x),S),g=y+p,i&&!h&&(c._stacks[e.axis]._visualValues[s]=e.getValueForPixel(g)-e.getValueForPixel(y))}if(y===e.getPixelForValue(a)){const b=he(p)*e.getLineWidthForValue(a)/2;y+=b,p-=b}return{size:p,base:y,head:g,center:g+p/2}}_calculateBarIndexPixels(t,e){const i=e.scale,s=this.options,r=s.skipNull,o=F(s.maxBarThickness,1/0);let a,c;if(e.grouped){const l=r?this._getStackCount(t):e.stackCount,h=s.barThickness==="flex"?OS(t,e,s,l):MS(t,e,s,l),u=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0);a=h.start+h.chunk*u+h.chunk/2,c=Math.min(o,h.chunk*h.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),c=Math.min(o,e.min*e.ratio);return{base:a-c/2,head:a+c/2,center:a,size:c}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,s=i.length;let r=0;for(;r<s;++r)this.getParsed(r)[e.axis]!==null&&i[r].draw(this._ctx)}}A(dr,"id","bar"),A(dr,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),A(dr,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class fr extends ee{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,s){const r=super.parsePrimitiveData(t,e,i,s);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+i).radius;return r}parseArrayData(t,e,i,s){const r=super.parseArrayData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=F(a[2],this.resolveDataElementOptions(o+i).radius)}return r}parseObjectData(t,e,i,s){const r=super.parseObjectData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=F(a&&a.r&&+a.r,this.resolveDataElementOptions(o+i).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),c=r.getLabelForValue(o.y),l=o._custom;return{label:i[t]||"",value:"("+a+", "+c+(l?", "+l:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:c,includeOptions:l}=this._getSharedOptions(e,s),h=o.axis,u=a.axis;for(let d=e;d<e+i;d++){const f=t[d],g=!r&&this.getParsed(d),p={},m=p[h]=r?o.getPixelForDecimal(.5):o.getPixelForValue(g[h]),y=p[u]=r?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(y),l&&(p.options=c||this.resolveDataElementOptions(d,f.active?"active":s),r&&(p.options.radius=0)),this.updateElement(f,d,p,s)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,e);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const r=s.radius;return e!=="active"&&(s.radius=0),s.radius+=F(i&&i._custom,r),s}}A(fr,"id","bubble"),A(fr,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),A(fr,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function BS(n,t,e){let i=1,s=1,r=0,o=0;if(t<nt){const a=n,c=a+t,l=Math.cos(a),h=Math.sin(a),u=Math.cos(c),d=Math.sin(c),f=(w,S,x)=>us(w,a,c,!0)?1:Math.max(S,S*e,x,x*e),g=(w,S,x)=>us(w,a,c,!0)?-1:Math.min(S,S*e,x,x*e),p=f(0,l,u),m=f(lt,h,d),y=g(rt,l,u),b=g(rt+lt,h,d);i=(p-y)/2,s=(m-b)/2,r=-(p+y)/2,o=-(m+b)/2}return{ratioX:i,ratioY:s,offsetX:r,offsetY:o}}class ln extends ee{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let r=c=>+i[c];if(q(i[t])){const{key:c="value"}=this._parsing;r=l=>+ze(i[l],c)}let o,a;for(o=t,a=t+e;o<a;++o)s._parsed[o]=r(o)}}_getRotation(){return te(this.options.rotation-90)}_getCircumference(){return te(this.options.circumference)}_getRotationExtents(){let t=nt,e=-nt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,r=s._getRotation(),o=s._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,s=this._cachedMeta,r=s.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),c=Math.min(Zw(this.options.cutout,a),1),l=this._getRingWeight(this.index),{circumference:h,rotation:u}=this._getRotationExtents(),{ratioX:d,ratioY:f,offsetX:g,offsetY:p}=BS(u,h,c),m=(i.width-o)/d,y=(i.height-o)/f,b=Math.max(Math.min(m,y)/2,0),w=Op(this.options.radius,b),S=Math.max(w*c,0),x=(w-S)/this._getVisibleDatasetWeightTotal();this.offsetX=g*w,this.offsetY=p*w,s.total=this.calculateTotal(),this.outerRadius=w-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*l,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const i=this.options,s=this._cachedMeta,r=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*r/nt)}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,a=o.chartArea,l=o.options.animation,h=(a.left+a.right)/2,u=(a.top+a.bottom)/2,d=r&&l.animateScale,f=d?0:this.innerRadius,g=d?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(e,s);let y=this._getRotation(),b;for(b=0;b<e;++b)y+=this._circumference(b,r);for(b=e;b<e+i;++b){const w=this._circumference(b,r),S=t[b],x={x:h+this.offsetX,y:u+this.offsetY,startAngle:y,endAngle:y+w,circumference:w,outerRadius:g,innerRadius:f};m&&(x.options=p||this.resolveDataElementOptions(b,S.active?"active":s)),y+=w,this.updateElement(S,b,x,s)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,s;for(s=0;s<e.length;s++){const r=t._parsed[s];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(s)&&!e[s].hidden&&(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?nt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=Rs(e._parsed[t],i.options.locale);return{label:s[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const i=this.chart;let s,r,o,a,c;if(!t){for(s=0,r=i.data.datasets.length;s<r;++s)if(i.isDatasetVisible(s)){o=i.getDatasetMeta(s),t=o.data,a=o.controller;break}}if(!t)return 0;for(s=0,r=t.length;s<r;++s)c=a.resolveDataElementOptions(s),c.borderAlign!=="inner"&&(e=Math.max(e,c.borderWidth||0,c.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,s=t.length;i<s;++i){const r=this.resolveDataElementOptions(i);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(F(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}A(ln,"id","doughnut"),A(ln,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),A(ln,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"}),A(ln,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return e.labels.map((r,o)=>{const c=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:s,lineWidth:c.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}});class gr extends ee{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:c}=zp(e,s,o);this._drawStart=a,this._drawCount=c,$p(e)&&(a=0,c=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=s;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:l},t),this.updateElements(s,a,c,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:c,_dataset:l}=this._cachedMeta,{sharedOptions:h,includeOptions:u}=this._getSharedOptions(e,s),d=o.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=ni(g)?g:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||s==="none",b=e+i,w=t.length;let S=e>0&&this.getParsed(e-1);for(let x=0;x<w;++x){const E=t[x],I=y?E:{};if(x<e||x>=b){I.skip=!0;continue}const D=this.getParsed(x),R=W(D[f]),z=I[d]=o.getPixelForValue(D[d],x),$=I[f]=r||R?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,D,c):D[f],x);I.skip=isNaN(z)||isNaN($)||R,I.stop=x>0&&Math.abs(D[d]-S[d])>m,p&&(I.parsed=D,I.raw=l.data[x]),u&&(I.options=h||this.resolveDataElementOptions(x,E.active?"active":s)),y||this.updateElement(E,x,I,s),S=D}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const r=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}A(gr,"id","line"),A(gr,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),A(gr,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Ki extends ee{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=Rs(e._parsed[t].r,i.options.locale);return{label:s[t]||"",value:r}}parseObjectData(t,e,i,s){return Qp.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const r=this.getParsed(s).r;!isNaN(r)&&this.chart.getDataVisibility(s)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,s=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(s/2,0),o=Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,c=o.options.animation,l=this._cachedMeta.rScale,h=l.xCenter,u=l.yCenter,d=l.getIndexAngle(0)-.5*rt;let f=d,g;const p=360/this.countVisibleElements();for(g=0;g<e;++g)f+=this._computeAngle(g,s,p);for(g=e;g<e+i;g++){const m=t[g];let y=f,b=f+this._computeAngle(g,s,p),w=o.getDataVisibility(g)?l.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=b,r&&(c.animateScale&&(w=0),c.animateRotate&&(y=b=d));const S={x:h,y:u,innerRadius:0,outerRadius:w,startAngle:y,endAngle:b,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,S,s)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?te(this.resolveDataElementOptions(t,e).angle||i):0}}A(Ki,"id","polarArea"),A(Ki,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),A(Ki,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return e.labels.map((r,o)=>{const c=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:c.backgroundColor,strokeStyle:c.borderColor,fontColor:s,lineWidth:c.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class tc extends ln{}A(tc,"id","pie"),A(tc,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class pr extends ee{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,s){return Qp.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta,i=e.dataset,s=e.data||[],r=e.iScale.getLabels();if(i.points=s,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===s.length,options:o};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,e,i,s){const r=this._cachedMeta.rScale,o=s==="reset";for(let a=e;a<e+i;a++){const c=t[a],l=this.resolveDataElementOptions(a,c.active?"active":s),h=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:h.x,d=o?r.yCenter:h.y,f={x:u,y:d,angle:h.angle,skip:isNaN(u)||isNaN(d),options:l};this.updateElement(c,a,f,s)}}}A(pr,"id","radar"),A(pr,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),A(pr,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class mr extends ee{getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),c=r.getLabelForValue(o.y);return{label:i[t]||"",value:"("+a+", "+c+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,s=this.chart._animationsDisabled;let{start:r,count:o}=zp(e,i,s);if(this._drawStart=r,this._drawCount=o,$p(e)&&(r=0,o=i.length),this.options.showLine){const{dataset:a,_dataset:c}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!c._decimated,a.points=i;const l=this.resolveDatasetElementOptions(t);l.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:l},t)}this.updateElements(i,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:c,_dataset:l}=this._cachedMeta,h=this.resolveDataElementOptions(e,s),u=this.getSharedOptions(h),d=this.includeOptions(s,u),f=o.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,y=ni(p)?p:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||r||s==="none";let w=e>0&&this.getParsed(e-1);for(let S=e;S<e+i;++S){const x=t[S],E=this.getParsed(S),I=b?x:{},D=W(E[g]),R=I[f]=o.getPixelForValue(E[f],S),z=I[g]=r||D?a.getBasePixel():a.getPixelForValue(c?this.applyStack(a,E,c):E[g],S);I.skip=isNaN(R)||isNaN(z)||D,I.stop=S>0&&Math.abs(E[f]-w[f])>y,m&&(I.parsed=E,I.raw=l.data[S]),d&&(I.options=u||this.resolveDataElementOptions(S,x.active?"active":s)),b||this.updateElement(x,S,I,s),w=E}this.updateSharedOptions(u,s,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let c=e.length-1;c>=0;--c)a=Math.max(a,e[c].size(this.resolveDataElementOptions(c))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!e.length)return s;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(s,r,o)/2}}A(mr,"id","scatter"),A(mr,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),A(mr,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var zS=Object.freeze({__proto__:null,BarController:dr,BubbleController:fr,DoughnutController:ln,LineController:gr,PolarAreaController:Ki,PieController:tc,RadarController:pr,ScatterController:mr});function Qe(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Al{static override(t){Object.assign(Al.prototype,t)}constructor(t){this.options=t||{}}init(){}formats(){return Qe()}parse(){return Qe()}format(){return Qe()}add(){return Qe()}diff(){return Qe()}startOf(){return Qe()}endOf(){return Qe()}}var $S={_date:Al};function US(n,t,e,i){const{controller:s,data:r,_sorted:o}=n,a=s._cachedMeta.iScale;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?u_:we;if(i){if(s._sharedOptions){const l=r[0],h=typeof l.getRange=="function"&&l.getRange(t);if(h){const u=c(r,t,e-h),d=c(r,t,e+h);return{lo:u.lo,hi:d.hi}}}}else return c(r,t,e)}return{lo:0,hi:r.length-1}}function Ns(n,t,e,i,s){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,c=r.length;a<c;++a){const{index:l,data:h}=r[a],{lo:u,hi:d}=US(r[a],t,o,s);for(let f=u;f<=d;++f){const g=h[f];g.skip||i(g,l,f)}}}function jS(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,s){const r=t?Math.abs(i.x-s.x):0,o=e?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function ra(n,t,e,i,s){const r=[];return!s&&!n.isPointInArea(t)||Ns(n,e,t,function(a,c,l){!s&&!ds(a,n.chartArea,0)||a.inRange(t.x,t.y,i)&&r.push({element:a,datasetIndex:c,index:l})},!0),r}function qS(n,t,e,i){let s=[];function r(o,a,c){const{startAngle:l,endAngle:h}=o.getProps(["startAngle","endAngle"],i),{angle:u}=Rp(o,{x:t.x,y:t.y});us(u,l,h)&&s.push({element:o,datasetIndex:a,index:c})}return Ns(n,e,t,r),s}function HS(n,t,e,i,s,r){let o=[];const a=jS(e);let c=Number.POSITIVE_INFINITY;function l(h,u,d){const f=h.inRange(t.x,t.y,s);if(i&&!f)return;const g=h.getCenterPoint(s);if(!(!!r||n.isPointInArea(g))&&!f)return;const m=a(t,g);m<c?(o=[{element:h,datasetIndex:u,index:d}],c=m):m===c&&o.push({element:h,datasetIndex:u,index:d})}return Ns(n,e,t,l),o}function oa(n,t,e,i,s,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!i?qS(n,t,e,s):HS(n,t,e,i,s,r)}function Nu(n,t,e,i,s){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Ns(n,e,t,(c,l,h)=>{c[o](t[e],s)&&(r.push({element:c,datasetIndex:l,index:h}),a=a||c.inRange(t.x,t.y,s))}),i&&!a?[]:r}var WS={evaluateInteractionItems:Ns,modes:{index(n,t,e,i){const s=tn(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?ra(n,s,r,i,o):oa(n,s,r,!1,i,o),c=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(l=>{const h=a[0].index,u=l.data[h];u&&!u.skip&&c.push({element:u,datasetIndex:l.index,index:h})}),c):[]},dataset(n,t,e,i){const s=tn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?ra(n,s,r,i,o):oa(n,s,r,!1,i,o);if(a.length>0){const c=a[0].datasetIndex,l=n.getDatasetMeta(c).data;a=[];for(let h=0;h<l.length;++h)a.push({element:l[h],datasetIndex:c,index:h})}return a},point(n,t,e,i){const s=tn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return ra(n,s,r,i,o)},nearest(n,t,e,i){const s=tn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return oa(n,s,r,e.intersect,i,o)},x(n,t,e,i){const s=tn(t,n);return Nu(n,s,"x",e.intersect,i)},y(n,t,e,i){const s=tn(t,n);return Nu(n,s,"y",e.intersect,i)}}};const am=["left","top","right","bottom"];function Si(n,t){return n.filter(e=>e.pos===t)}function Fu(n,t){return n.filter(e=>am.indexOf(e.pos)===-1&&e.box.axis===t)}function Ei(n,t){return n.sort((e,i)=>{const s=t?i:e,r=t?e:i;return s.weight===r.weight?s.index-r.index:s.weight-r.weight})}function KS(n){const t=[];let e,i,s,r,o,a;for(e=0,i=(n||[]).length;e<i;++e)s=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=s,t.push({index:e,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&r+o,stackWeight:a});return t}function GS(n){const t={};for(const e of n){const{stack:i,pos:s,stackWeight:r}=e;if(!i||!am.includes(s))continue;const o=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function YS(n,t){const e=GS(n),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:c}=a.box,l=e[a.stack],h=l&&a.stackWeight/l.weight;a.horizontal?(a.width=h?h*i:c&&t.availableWidth,a.height=s):(a.width=i,a.height=h?h*s:c&&t.availableHeight)}return e}function QS(n){const t=KS(n),e=Ei(t.filter(l=>l.box.fullSize),!0),i=Ei(Si(t,"left"),!0),s=Ei(Si(t,"right")),r=Ei(Si(t,"top"),!0),o=Ei(Si(t,"bottom")),a=Fu(t,"x"),c=Fu(t,"y");return{fullSize:e,leftAndTop:i.concat(r),rightAndBottom:s.concat(c).concat(o).concat(a),chartArea:Si(t,"chartArea"),vertical:i.concat(s).concat(c),horizontal:r.concat(o).concat(a)}}function Vu(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function cm(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function XS(n,t,e,i){const{pos:s,box:r}=e,o=n.maxPadding;if(!q(s)){e.size&&(n[s]-=e.size);const u=i[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,n[s]+=e.size}r.getPadding&&cm(o,r.getPadding());const a=Math.max(0,t.outerWidth-Vu(o,n,"left","right")),c=Math.max(0,t.outerHeight-Vu(o,n,"top","bottom")),l=a!==n.w,h=c!==n.h;return n.w=a,n.h=c,e.horizontal?{same:l,other:h}:{same:h,other:l}}function JS(n){const t=n.maxPadding;function e(i){const s=Math.max(t[i]-n[i],0);return n[i]+=s,s}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function ZS(n,t){const e=t.maxPadding;function i(s){const r={left:0,top:0,right:0,bottom:0};return s.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return i(n?["left","right"]:["top","bottom"])}function Li(n,t,e,i){const s=[];let r,o,a,c,l,h;for(r=0,o=n.length,l=0;r<o;++r){a=n[r],c=a.box,c.update(a.width||t.w,a.height||t.h,ZS(a.horizontal,t));const{same:u,other:d}=XS(t,e,a,i);l|=u&&s.length,h=h||d,c.fullSize||s.push(a)}return l&&Li(s,t,e,i)||h}function Zs(n,t,e,i,s){n.top=e,n.left=t,n.right=t+i,n.bottom=e+s,n.width=i,n.height=s}function Bu(n,t,e,i){const s=e.padding;let{x:r,y:o}=t;for(const a of n){const c=a.box,l=i[a.stack]||{count:1,placed:0,weight:1},h=a.stackWeight/l.weight||1;if(a.horizontal){const u=t.w*h,d=l.size||c.height;Xt(l.start)&&(o=l.start),c.fullSize?Zs(c,s.left,o,e.outerWidth-s.right-s.left,d):Zs(c,t.left+l.placed,o,u,d),l.start=o,l.placed+=u,o=c.bottom}else{const u=t.h*h,d=l.size||c.width;Xt(l.start)&&(r=l.start),c.fullSize?Zs(c,r,s.top,d,e.outerHeight-s.bottom-s.top):Zs(c,r,t.top+l.placed,d,u),l.start=r,l.placed+=u,r=c.right}}t.x=r,t.y=o}var At={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const s=Pt(n.options.layout.padding),r=Math.max(t-s.width,0),o=Math.max(e-s.height,0),a=QS(n.boxes),c=a.vertical,l=a.horizontal;Q(n.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const h=c.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:s,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/h,hBoxMaxHeight:o/2}),d=Object.assign({},s);cm(d,Pt(i));const f=Object.assign({maxPadding:d,w:r,h:o,x:s.left,y:s.top},s),g=YS(c.concat(l),u);Li(a.fullSize,f,u,g),Li(c,f,u,g),Li(l,f,u,g)&&Li(c,f,u,g),JS(f),Bu(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,Bu(a.rightAndBottom,f,u,g),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Q(a.chartArea,p=>{const m=p.box;Object.assign(m,n.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class lm{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class tE extends lm{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const yr="$chartjs",eE={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},zu=n=>n===null||n==="";function nE(n,t){const e=n.style,i=n.getAttribute("height"),s=n.getAttribute("width");if(n[yr]={initial:{height:i,width:s,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",zu(s)){const r=_u(n,"width");r!==void 0&&(n.width=r)}if(zu(i))if(n.style.height==="")n.height=n.width/(t||2);else{const r=_u(n,"height");r!==void 0&&(n.height=r)}return n}const hm=sS?{passive:!0}:!1;function iE(n,t,e){n.addEventListener(t,e,hm)}function sE(n,t,e){n.canvas.removeEventListener(t,e,hm)}function rE(n,t){const e=eE[n.type]||n.type,{x:i,y:s}=tn(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:s!==void 0?s:null}}function Yr(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function oE(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Yr(a.addedNodes,i),o=o&&!Yr(a.removedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}function aE(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Yr(a.removedNodes,i),o=o&&!Yr(a.addedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}const gs=new Map;let $u=0;function um(){const n=window.devicePixelRatio;n!==$u&&($u=n,gs.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function cE(n,t){gs.size||window.addEventListener("resize",um),gs.set(n,t)}function lE(n){gs.delete(n),gs.size||window.removeEventListener("resize",um)}function hE(n,t,e){const i=n.canvas,s=i&&kl(i);if(!s)return;const r=Bp((a,c)=>{const l=s.clientWidth;e(a,c),l<s.clientWidth&&e()},window),o=new ResizeObserver(a=>{const c=a[0],l=c.contentRect.width,h=c.contentRect.height;l===0&&h===0||r(l,h)});return o.observe(s),cE(n,r),o}function aa(n,t,e){e&&e.disconnect(),t==="resize"&&lE(n)}function uE(n,t,e){const i=n.canvas,s=Bp(r=>{n.ctx!==null&&e(rE(r,n))},n);return iE(i,t,s),s}class dE extends lm{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(nE(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[yr])return!1;const i=e[yr].initial;["height","width"].forEach(r=>{const o=i[r];W(o)?e.removeAttribute(r):e.setAttribute(r,o)});const s=i.style||{};return Object.keys(s).forEach(r=>{e.style[r]=s[r]}),e.width=e.width,delete e[yr],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),o={attach:oE,detach:aE,resize:hE}[e]||uE;s[e]=o(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:aa,detach:aa,resize:aa}[e]||sE)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return iS(t,e,i,s)}isAttached(t){const e=kl(t);return!!(e&&e.isConnected)}}function fE(n){return!Jp()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?tE:dE}class ie{constructor(){A(this,"active",!1)}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return ni(this.x)&&ni(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach(r=>{s[r]=i[r]&&i[r].active()?i[r]._to:this[r]}),s}}A(ie,"defaults",{}),A(ie,"defaultRoutes");function gE(n,t){const e=n.options.ticks,i=pE(n),s=Math.min(e.maxTicksLimit||i,i),r=e.major.enabled?yE(t):[],o=r.length,a=r[0],c=r[o-1],l=[];if(o>s)return bE(t,l,r,o/s),l;const h=mE(r,t,s);if(o>0){let u,d;const f=o>1?Math.round((c-a)/(o-1)):null;for(tr(t,l,h,W(f)?0:a-f,a),u=0,d=o-1;u<d;u++)tr(t,l,h,r[u],r[u+1]);return tr(t,l,h,c,W(f)?t.length:c+f),l}return tr(t,l,h),l}function pE(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),s=n._maxLength/e;return Math.floor(Math.min(i,s))}function mE(n,t,e){const i=vE(n),s=t.length/e;if(!i)return Math.max(s,1);const r=a_(i);for(let o=0,a=r.length-1;o<a;o++){const c=r[o];if(c>s)return c}return Math.max(s,1)}function yE(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function bE(n,t,e,i){let s=0,r=e[0],o;for(i=Math.ceil(i),o=0;o<n.length;o++)o===r&&(t.push(n[o]),s++,r=e[s*i])}function tr(n,t,e,i,s){const r=F(i,0),o=Math.min(F(s,n.length),n.length);let a=0,c,l,h;for(e=Math.ceil(e),s&&(c=s-i,e=c/Math.floor(c/e)),h=r;h<0;)a++,h=Math.round(r+a*e);for(l=Math.max(r,0);l<o;l++)l===h&&(t.push(n[l]),a++,h=Math.round(r+a*e))}function vE(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const xE=n=>n==="left"?"right":n==="right"?"left":n,Uu=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e;function ju(n,t){const e=[],i=n.length/t,s=n.length;let r=0;for(;r<s;r+=i)e.push(n[Math.floor(r)]);return e}function wE(n,t,e){const i=n.ticks.length,s=Math.min(t,i-1),r=n._startPixel,o=n._endPixel,a=1e-6;let c=n.getPixelForTick(s),l;if(!(e&&(i===1?l=Math.max(c-r,o-c):t===0?l=(n.getPixelForTick(1)-c)/2:l=(c-n.getPixelForTick(s-1))/2,c+=s<t?l:-l,c<r-a||c>o+a)))return c}function _E(n,t){Q(n,e=>{const i=e.gc,s=i.length/2;let r;if(s>t){for(r=0;r<s;++r)delete e.data[i[r]];i.splice(0,s)}})}function Ii(n){return n.drawTicks?n.tickLength:0}function qu(n,t){if(!n.display)return 0;const e=mt(n.font,t),i=Pt(n.padding);return(et(n.text)?n.text.length:1)*e.lineHeight+i.height}function SE(n,t){return We(n,{scale:t,type:"scale"})}function EE(n,t,e){return We(n,{tick:e,index:t,type:"tick"})}function IE(n,t,e){let i=El(n);return(e&&t!=="right"||!e&&t==="right")&&(i=xE(i)),i}function TE(n,t,e,i){const{top:s,left:r,bottom:o,right:a,chart:c}=n,{chartArea:l,scales:h}=c;let u=0,d,f,g;const p=o-s,m=a-r;if(n.isHorizontal()){if(f=kt(i,r,a),q(e)){const y=Object.keys(e)[0],b=e[y];g=h[y].getPixelForValue(b)+p-t}else e==="center"?g=(l.bottom+l.top)/2+p-t:g=Uu(n,e,t);d=a-r}else{if(q(e)){const y=Object.keys(e)[0],b=e[y];f=h[y].getPixelForValue(b)-m+t}else e==="center"?f=(l.left+l.right)/2-m+t:f=Uu(n,e,t);g=kt(i,o,s),u=e==="left"?-lt:lt}return{titleX:f,titleY:g,maxWidth:d,rotation:u}}class kn extends ie{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=jt(t,Number.POSITIVE_INFINITY),e=jt(e,Number.NEGATIVE_INFINITY),i=jt(i,Number.POSITIVE_INFINITY),s=jt(s,Number.NEGATIVE_INFINITY),{min:jt(t,i),max:jt(e,s),minDefined:ct(t),maxDefined:ct(e)}}getMinMax(t){let{min:e,max:i,minDefined:s,maxDefined:r}=this.getUserBounds(),o;if(s&&r)return{min:e,max:i};const a=this.getMatchingVisibleMetas();for(let c=0,l=a.length;c<l;++c)o=a[c].controller.getMinMax(this,t),s||(e=Math.min(e,o.min)),r||(i=Math.max(i,o.max));return e=r&&e>i?i:e,i=s&&e>i?e:i,{min:jt(e,jt(i,e)),max:jt(i,jt(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){tt(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=R_(this,r,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=a<this.ticks.length;this._convertTicksToLabels(c?ju(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=gE(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){tt(this.options.afterUpdate,[this])}beforeSetDimensions(){tt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){tt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),tt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){tt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,r;for(i=0,s=t.length;i<s;i++)r=t[i],r.label=tt(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){tt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){tt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=this.ticks.length,s=e.minRotation||0,r=e.maxRotation;let o=s,a,c,l;if(!this._isVisible()||!e.display||s>=r||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const h=this._getLabelSizes(),u=h.widest.width,d=h.highest.height,f=vt(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),c=this.maxHeight-Ii(t.grid)-e.padding-qu(t.title,this.chart.options.font),l=Math.sqrt(u*u+d*d),o=_l(Math.min(Math.asin(vt((h.highest.height+6)/a,-1,1)),Math.asin(vt(c/l,-1,1))-Math.asin(vt(d/l,-1,1)))),o=Math.max(s,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){tt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){tt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const c=qu(s,e.options.font);if(a?(t.width=this.maxWidth,t.height=Ii(r)+c):(t.height=this.maxHeight,t.width=Ii(r)+c),i.display&&this.ticks.length){const{first:l,last:h,widest:u,highest:d}=this._getLabelSizes(),f=i.padding*2,g=te(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const y=i.mirror?0:m*u.width+p*d.height;t.height=Math.min(this.maxHeight,t.height+y+f)}else{const y=i.mirror?0:p*u.width+m*d.height;t.width=Math.min(this.maxWidth,t.width+y+f)}this._calculatePadding(l,h,m,p)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:r,padding:o},position:a}=this.options,c=this.labelRotation!==0,l=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let d=0,f=0;c?l?(d=s*t.width,f=i*e.height):(d=i*t.height,f=s*e.width):r==="start"?f=e.width:r==="end"?d=t.width:r!=="inner"&&(d=t.width/2,f=e.width/2),this.paddingLeft=Math.max((d-h+o)*this.width/(this.width-h),0),this.paddingRight=Math.max((f-u+o)*this.width/(this.width-u),0)}else{let h=e.height/2,u=t.height/2;r==="start"?(h=0,u=t.height):r==="end"&&(h=e.height,u=0),this.paddingTop=h+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){tt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)W(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=ju(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length)}return t}_computeLabelSizes(t,e){const{ctx:i,_longestTextCache:s}=this,r=[],o=[];let a=0,c=0,l,h,u,d,f,g,p,m,y,b,w;for(l=0;l<e;++l){if(d=t[l].label,f=this._resolveTickFontOptions(l),i.font=g=f.string,p=s[g]=s[g]||{data:{},gc:[]},m=f.lineHeight,y=b=0,!W(d)&&!et(d))y=Kr(i,p.data,p.gc,y,d),b=m;else if(et(d))for(h=0,u=d.length;h<u;++h)w=d[h],!W(w)&&!et(w)&&(y=Kr(i,p.data,p.gc,y,w),b+=m);r.push(y),o.push(b),a=Math.max(y,a),c=Math.max(b,c)}_E(s,e);const S=r.indexOf(a),x=o.indexOf(c),E=I=>({width:r[I]||0,height:o[I]||0});return{first:E(0),last:E(e-1),widest:E(S),highest:E(x),widths:r,heights:o}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return h_(this._alignToPixels?Ye(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=EE(this.getContext(),t,i))}return this.$context||(this.$context=SE(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=te(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,c=r?r.highest.height+o:0;return this.isHorizontal()?c*i>a*s?a/i:c/s:c*s<a*i?c/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:r,position:o,border:a}=s,c=r.offset,l=this.isHorizontal(),u=this.ticks.length+(c?1:0),d=Ii(r),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,y=function(it){return Ye(i,it,p)};let b,w,S,x,E,I,D,R,z,$,K,_t;if(o==="top")b=y(this.bottom),I=this.bottom-d,R=b-m,$=y(t.top)+m,_t=t.bottom;else if(o==="bottom")b=y(this.top),$=t.top,_t=y(t.bottom)-m,I=b+m,R=this.top+d;else if(o==="left")b=y(this.right),E=this.right-d,D=b-m,z=y(t.left)+m,K=t.right;else if(o==="right")b=y(this.left),z=t.left,K=y(t.right)-m,E=b+m,D=this.left+d;else if(e==="x"){if(o==="center")b=y((t.top+t.bottom)/2+.5);else if(q(o)){const it=Object.keys(o)[0],dt=o[it];b=y(this.chart.scales[it].getPixelForValue(dt))}$=t.top,_t=t.bottom,I=b+m,R=I+d}else if(e==="y"){if(o==="center")b=y((t.left+t.right)/2);else if(q(o)){const it=Object.keys(o)[0],dt=o[it];b=y(this.chart.scales[it].getPixelForValue(dt))}E=b-m,D=E-d,z=t.left,K=t.right}const Ut=F(s.ticks.maxTicksLimit,u),J=Math.max(1,Math.ceil(u/Ut));for(w=0;w<u;w+=J){const it=this.getContext(w),dt=r.setContext(it),Jt=a.setContext(it),Ct=dt.lineWidth,An=dt.color,Fs=Jt.dash||[],Mn=Jt.dashOffset,ui=dt.tickWidth,di=dt.tickColor,fi=dt.tickBorderDash||[],gi=dt.tickBorderDashOffset;S=wE(this,w,c),S!==void 0&&(x=Ye(i,S,Ct),l?E=D=z=K=x:I=R=$=_t=x,f.push({tx1:E,ty1:I,tx2:D,ty2:R,x1:z,y1:$,x2:K,y2:_t,width:Ct,color:An,borderDash:Fs,borderDashOffset:Mn,tickWidth:ui,tickColor:di,tickBorderDash:fi,tickBorderDashOffset:gi}))}return this._ticksLength=u,this._borderValue=b,f}_computeLabelItems(t){const e=this.axis,i=this.options,{position:s,ticks:r}=i,o=this.isHorizontal(),a=this.ticks,{align:c,crossAlign:l,padding:h,mirror:u}=r,d=Ii(i.grid),f=d+h,g=u?-h:f,p=-te(this.labelRotation),m=[];let y,b,w,S,x,E,I,D,R,z,$,K,_t="middle";if(s==="top")E=this.bottom-g,I=this._getXAxisLabelAlignment();else if(s==="bottom")E=this.top+g,I=this._getXAxisLabelAlignment();else if(s==="left"){const J=this._getYAxisLabelAlignment(d);I=J.textAlign,x=J.x}else if(s==="right"){const J=this._getYAxisLabelAlignment(d);I=J.textAlign,x=J.x}else if(e==="x"){if(s==="center")E=(t.top+t.bottom)/2+f;else if(q(s)){const J=Object.keys(s)[0],it=s[J];E=this.chart.scales[J].getPixelForValue(it)+f}I=this._getXAxisLabelAlignment()}else if(e==="y"){if(s==="center")x=(t.left+t.right)/2-f;else if(q(s)){const J=Object.keys(s)[0],it=s[J];x=this.chart.scales[J].getPixelForValue(it)}I=this._getYAxisLabelAlignment(d).textAlign}e==="y"&&(c==="start"?_t="top":c==="end"&&(_t="bottom"));const Ut=this._getLabelSizes();for(y=0,b=a.length;y<b;++y){w=a[y],S=w.label;const J=r.setContext(this.getContext(y));D=this.getPixelForTick(y)+r.labelOffset,R=this._resolveTickFontOptions(y),z=R.lineHeight,$=et(S)?S.length:1;const it=$/2,dt=J.color,Jt=J.textStrokeColor,Ct=J.textStrokeWidth;let An=I;o?(x=D,I==="inner"&&(y===b-1?An=this.options.reverse?"left":"right":y===0?An=this.options.reverse?"right":"left":An="center"),s==="top"?l==="near"||p!==0?K=-$*z+z/2:l==="center"?K=-Ut.highest.height/2-it*z+z:K=-Ut.highest.height+z/2:l==="near"||p!==0?K=z/2:l==="center"?K=Ut.highest.height/2-it*z:K=Ut.highest.height-$*z,u&&(K*=-1),p!==0&&!J.showLabelBackdrop&&(x+=z/2*Math.sin(p))):(E=D,K=(1-$)*z/2);let Fs;if(J.showLabelBackdrop){const Mn=Pt(J.backdropPadding),ui=Ut.heights[y],di=Ut.widths[y];let fi=K-Mn.top,gi=0-Mn.left;switch(_t){case"middle":fi-=ui/2;break;case"bottom":fi-=ui;break}switch(I){case"center":gi-=di/2;break;case"right":gi-=di;break}Fs={left:gi,top:fi,width:di+Mn.width,height:ui+Mn.height,color:J.backdropColor}}m.push({label:S,font:R,textOffset:K,options:{rotation:p,color:dt,strokeColor:Jt,strokeWidth:Ct,textAlign:An,textBaseline:_t,translation:[x,E],backdrop:Fs}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-te(this.labelRotation))return t==="top"?"left":"right";let s="center";return e.align==="start"?s="left":e.align==="end"?s="right":e.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,c=o.widest.width;let l,h;return e==="left"?s?(h=this.right+r,i==="near"?l="left":i==="center"?(l="center",h+=c/2):(l="right",h+=c)):(h=this.right-a,i==="near"?l="right":i==="center"?(l="center",h-=c/2):(l="left",h=this.left)):e==="right"?s?(h=this.left+r,i==="near"?l="right":i==="center"?(l="center",h-=c/2):(l="left",h-=c)):(h=this.left+a,i==="near"?l="left":i==="center"?(l="center",h+=c/2):(l="right",h=this.right)):l="right",{textAlign:l,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const s=this.ticks.findIndex(r=>r.value===t);return s>=0?e.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(c,l,h)=>{!h.width||!h.color||(i.save(),i.lineWidth=h.width,i.strokeStyle=h.color,i.setLineDash(h.borderDash||[]),i.lineDashOffset=h.borderDashOffset,i.beginPath(),i.moveTo(c.x,c.y),i.lineTo(l.x,l.y),i.stroke(),i.restore())};if(e.display)for(r=0,o=s.length;r<o;++r){const c=s[r];e.drawOnChartArea&&a({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),e.drawTicks&&a({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:s}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const a=s.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let l,h,u,d;this.isHorizontal()?(l=Ye(t,this.left,o)-o/2,h=Ye(t,this.right,a)+a/2,u=d=c):(u=Ye(t,this.top,o)-o/2,d=Ye(t,this.bottom,a)+a/2,l=h=c),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(l,u),e.lineTo(h,d),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&Lo(i,s);const r=this.getLabelItems(t);for(const o of r){const a=o.options,c=o.font,l=o.label,h=o.textOffset;En(i,l,0,h,c,a)}s&&Ro(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:s}}=this;if(!i.display)return;const r=mt(i.font),o=Pt(i.padding),a=i.align;let c=r.lineHeight/2;e==="bottom"||e==="center"||q(e)?(c+=o.bottom,et(i.text)&&(c+=r.lineHeight*(i.text.length-1))):c+=o.top;const{titleX:l,titleY:h,maxWidth:u,rotation:d}=TE(this,c,e,a);En(t,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:d,textAlign:IE(a,e,s),textBaseline:"middle",translation:[l,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=F(t.grid&&t.grid.z,-1),s=F(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==kn.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return mt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class er{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;kE(e)&&(i=this.register(e));const s=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in s||(s[r]=t,DE(t,o,i),this.override&&ft.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in ft[s]&&(delete ft[s][i],this.override&&delete Sn[i])}}function DE(n,t,e){const i=hs(Object.create(null),[e?ft.get(e):{},ft.get(t),n.defaults]);ft.set(t,i),n.defaultRoutes&&CE(t,n.defaultRoutes),n.descriptors&&ft.describe(t,n.descriptors)}function CE(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),s=i.pop(),r=[n].concat(i).join("."),o=t[e].split("."),a=o.pop(),c=o.join(".");ft.route(r,s,c,a)})}function kE(n){return"id"in n&&"defaults"in n}class AE{constructor(){this.controllers=new er(ee,"datasets",!0),this.elements=new er(ie,"elements"),this.plugins=new er(Object,"plugins"),this.scales=new er(kn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(s=>{const r=i||this._getRegistryForType(s);i||r.isForType(s)||r===this.plugins&&s.id?this._exec(t,r,s):Q(s,o=>{const a=i||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,i){const s=wl(t);tt(i["before"+s],[],i),e[t](i),tt(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var re=new AE;class ME{constructor(){this._init=[]}notify(t,e,i,s){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const r=s?this._descriptors(t).filter(s):this._descriptors(t),o=this._notify(r,t,e,i);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall")),o}_notify(t,e,i,s){s=s||{};for(const r of t){const o=r.plugin,a=o[i],c=[e,s,r.options];if(tt(a,c,o)===!1&&s.cancelable)return!1}return!0}invalidate(){W(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=F(i.options&&i.options.plugins,{}),r=OE(i);return s===!1&&!e?[]:LE(t,r,s,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(r,o)=>r.filter(a=>!o.some(c=>a.plugin.id===c.plugin.id));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function OE(n){const t={},e=[],i=Object.keys(re.plugins.items);for(let r=0;r<i.length;r++)e.push(re.getPlugin(i[r]));const s=n.plugins||[];for(let r=0;r<s.length;r++){const o=s[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function PE(n,t){return!t&&n===!1?null:n===!0?{}:n}function LE(n,{plugins:t,localIds:e},i,s){const r=[],o=n.getContext();for(const a of t){const c=a.id,l=PE(i[c],s);l!==null&&r.push({plugin:a,options:RE(n.config,{plugin:a,local:e[c]},l,o)})}return r}function RE(n,{plugin:t,local:e},i,s){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(i,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function ec(n,t){const e=ft.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function NE(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function FE(n,t){return n===t?"_index_":"_value_"}function VE(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Qr(n,t){if(n==="x"||n==="y"||n==="r"||(n=t.axis||VE(t.position)||n.length>1&&Qr(n[0].toLowerCase(),t),n))return n;throw new Error(`Cannot determine type of '${name}' axis. Please provide 'axis' or 'position' option.`)}function BE(n,t){const e=Sn[n.type]||{scales:{}},i=t.scales||{},s=ec(n.type,t),r=Object.create(null);return Object.keys(i).forEach(o=>{const a=i[o];if(!q(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const c=Qr(o,a),l=FE(c,s),h=e.scales||{};r[o]=ji(Object.create(null),[{axis:c},a,h[c],h[l]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,c=o.indexAxis||ec(a,t),h=(Sn[a]||{}).scales||{};Object.keys(h).forEach(u=>{const d=NE(u,c),f=o[d+"AxisID"]||d;r[f]=r[f]||Object.create(null),ji(r[f],[{axis:d},i[f],h[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];ji(a,[ft.scales[a.type],ft.scale])}),r}function dm(n){const t=n.options||(n.options={});t.plugins=F(t.plugins,{}),t.scales=BE(n,t)}function fm(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function zE(n){return n=n||{},n.data=fm(n.data),dm(n),n}const Hu=new Map,gm=new Set;function nr(n,t){let e=Hu.get(n);return e||(e=t(),Hu.set(n,e),gm.add(e)),e}const Ti=(n,t,e)=>{const i=ze(t,e);i!==void 0&&n.add(i)};class $E{constructor(t){this._config=zE(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=fm(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),dm(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return nr(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return nr(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return nr(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return nr(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return(!s||e)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:r}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const c=new Set;e.forEach(h=>{t&&(c.add(t),h.forEach(u=>Ti(c,t,u))),h.forEach(u=>Ti(c,s,u)),h.forEach(u=>Ti(c,Sn[r]||{},u)),h.forEach(u=>Ti(c,ft,u)),h.forEach(u=>Ti(c,Ja,u))});const l=Array.from(c);return l.length===0&&l.push(Object.create(null)),gm.has(e)&&o.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,Sn[e]||{},ft.datasets[e]||{},{type:e},ft,Ja]}resolveNamedOptions(t,e,i,s=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=Wu(this._resolverCache,t,s);let c=o;if(jE(o,e)){r.$shared=!1,i=$e(i)?i():i;const l=this.createResolver(t,i,a);c=ii(o,i,l)}for(const l of e)r[l]=c[l];return r}createResolver(t,e,i=[""],s){const{resolver:r}=Wu(this._resolverCache,t,i);return q(e)?ii(r,e,void 0,s):r}}function Wu(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const s=e.join();let r=i.get(s);return r||(r={resolver:Tl(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,r)),r}const UE=n=>q(n)&&Object.getOwnPropertyNames(n).reduce((t,e)=>t||$e(n[e]),!1);function jE(n,t){const{isScriptable:e,isIndexable:i}=Wp(n);for(const s of t){const r=e(s),o=i(s),a=(o||r)&&n[s];if(r&&($e(a)||UE(a))||o&&et(a))return!0}return!1}var qE="4.2.0";const HE=["top","bottom","left","right","chartArea"];function Ku(n,t){return n==="top"||n==="bottom"||HE.indexOf(n)===-1&&t==="x"}function Gu(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function Yu(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),tt(e&&e.onComplete,[n],t)}function WE(n){const t=n.chart,e=t.options.animation;tt(e&&e.onProgress,[n],t)}function pm(n){return Jp()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const br={},Qu=n=>{const t=pm(n);return Object.values(br).filter(e=>e.canvas===t).pop()};function KE(n,t,e){const i=Object.keys(n);for(const s of i){const r=+s;if(r>=t){const o=n[s];delete n[s],(e>0||r>t)&&(n[r+e]=o)}}}function GE(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}function YE(n){const{xScale:t,yScale:e}=n;if(t&&e)return{left:t.left,right:t.right,top:e.top,bottom:e.bottom}}class me{static register(...t){re.add(...t),Xu()}static unregister(...t){re.remove(...t),Xu()}constructor(t,e){const i=this.config=new $E(e),s=pm(t),r=Qu(s);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||fE(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,o.aspectRatio),c=a&&a.canvas,l=c&&c.height,h=c&&c.width;if(this.id=Jw(),this.ctx=a,this.canvas=c,this.width=h,this.height=l,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new ME,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=g_(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],br[this.id]=this,!a||!c){console.error("Failed to create chart: can't acquire context from the given item");return}fe.listen(this,"complete",Yu),fe.listen(this,"progress",WE),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:s,_aspectRatio:r}=this;return W(t)?e&&r?r:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return re}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():wu(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return bu(this.canvas,this.ctx),this}stop(){return fe.stop(this),this}resize(t,e){fe.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,t,e,r),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,wu(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),tt(i.onResize,[this,o],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};Q(e,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],c=Qr(o,a),l=c==="r",h=c==="x";return{options:a,dposition:l?"chartArea":h?"bottom":"left",dtype:l?"radialLinear":h?"category":"linear"}}))),Q(r,o=>{const a=o.options,c=a.id,l=Qr(c,a),h=F(a.type,o.dtype);(a.position===void 0||Ku(a.position,l)!==Ku(o.dposition))&&(a.position=o.dposition),s[c]=!0;let u=null;if(c in i&&i[c].type===h)u=i[c];else{const d=re.getScale(h);u=new d({id:c,type:h,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),Q(s,(o,a)=>{o||delete i[a]}),Q(i,o=>{At.configure(this,o,o.options),At.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((s,r)=>s.index-r.index),i>e){for(let s=e;s<i;++s)this._destroyDatasetMeta(s);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(Gu("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,s)=>{e.filter(r=>r===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const r=e[i];let o=this.getDatasetMeta(i);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(i),o=this.getDatasetMeta(i)),o.type=a,o.indexAxis=r.indexAxis||ec(a,this.options),o.order=r.order||0,o.index=i,o.label=""+r.label,o.visible=this.isDatasetVisible(i),o.controller)o.controller.updateIndex(i),o.controller.linkScales();else{const c=re.getController(a),{datasetElementType:l,dataElementType:h}=ft.datasets[a];Object.assign(c,{dataElementType:re.getElement(h),datasetElementType:l&&re.getElement(l)}),o.controller=new c(this,i),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){Q(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let l=0,h=this.data.datasets.length;l<h;l++){const{controller:u}=this.getDatasetMeta(l),d=!s&&r.indexOf(u)===-1;u.buildOrUpdateElements(d),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),s||Q(r,l=>{l.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Gu("z","_idx"));const{_active:a,_lastEvent:c}=this;c?this._eventHandler(c,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){Q(this.scales,t=>{At.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!lu(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:r}of e){const o=i==="_removeElements"?-r:r;KE(t,s,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),s=i(0);for(let r=1;r<e;r++)if(!lu(s,i(r)))return;return Array.from(s).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;At.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],Q(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,r)=>{s._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,$e(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(fe.has(this)?this.attached&&!fe.running(this)&&fe.start(this):(this.draw(),Yu({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resize(i,s),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,r;for(s=0,r=e.length;s<r;++s){const o=e[s];(!t||o.visible)&&i.push(o)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i=t._clip,s=!i.disabled,r=YE(t)||this.chartArea,o={meta:t,index:t.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",o)!==!1&&(s&&Lo(e,{left:i.left===!1?0:r.left-i.left,right:i.right===!1?this.width:r.right+i.right,top:i.top===!1?0:r.top-i.top,bottom:i.bottom===!1?this.height:r.bottom+i.bottom}),t.controller.draw(),s&&Ro(e),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}isPointInArea(t){return ds(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,s){const r=WS.modes[e];return typeof r=="function"?r(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter(r=>r&&r._dataset===e).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=We(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,s);Xt(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(r,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),fe.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),bu(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete br[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},s=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};Q(this.options.events,r=>i(r,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(c,l)=>{e.addEventListener(this,c,l),t[c]=l},s=(c,l)=>{t[c]&&(e.removeEventListener(this,c,l),delete t[c])},r=(c,l)=>{this.canvas&&this.resize(c,l)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,s("resize",r),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){Q(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},Q(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let r,o,a,c;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+s+"DatasetHoverStyle"]()),a=0,c=t.length;a<c;++a){o=t[a];const l=o&&this.getDatasetMeta(o.datasetIndex).controller;l&&l[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!qr(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const s=this.options.hover,r=(c,l)=>c.filter(h=>!l.some(u=>h.datasetIndex===u.datasetIndex&&h.index===u.index)),o=r(e,t),a=i?t:r(t,e);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},s=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:r}=this,o=e,a=this._getActiveElements(t,s,i,o),c=s_(t),l=GE(t,this._lastEvent,i,c);i&&(this._lastEvent=null,tt(r.onHover,[t,a,this],this),c&&tt(r.onClick,[t,a,this],this));const h=!qr(a,s);return(h||e)&&(this._active=a,this._updateHoverStyles(a,s,e)),this._lastEvent=l,h}_getActiveElements(t,e,i,s){if(t.type==="mouseout")return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,s)}}A(me,"defaults",ft),A(me,"instances",br),A(me,"overrides",Sn),A(me,"registry",re),A(me,"version",qE),A(me,"getChart",Qu);function Xu(){return Q(me.instances,n=>n._plugins.invalidate())}function QE(n,t,e){const{startAngle:i,pixelMargin:s,x:r,y:o,outerRadius:a,innerRadius:c}=t;let l=s/a;n.beginPath(),n.arc(r,o,a,i-l,e+l),c>s?(l=s/c,n.arc(r,o,c,e+l,i-l,!0)):n.arc(r,o,s,e+lt,i-lt),n.closePath(),n.clip()}function XE(n){return Il(n,["outerStart","outerEnd","innerStart","innerEnd"])}function JE(n,t,e,i){const s=XE(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,i*t/2),a=c=>{const l=(e-Math.min(r,c))*i/2;return vt(c,0,Math.min(r,l))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:vt(s.innerStart,0,o),innerEnd:vt(s.innerEnd,0,o)}}function Rn(n,t,e,i){return{x:e+n*Math.cos(t),y:i+n*Math.sin(t)}}function Xr(n,t,e,i,s,r){const{x:o,y:a,startAngle:c,pixelMargin:l,innerRadius:h}=t,u=Math.max(t.outerRadius+i+e-l,0),d=h>0?h+i+e+l:0;let f=0;const g=s-c;if(i){const J=h>0?h-i:0,it=u>0?u-i:0,dt=(J+it)/2,Jt=dt!==0?g*dt/(dt+i):g;f=(g-Jt)/2}const p=Math.max(.001,g*u-e/rt)/u,m=(g-p)/2,y=c+m+f,b=s-m-f,{outerStart:w,outerEnd:S,innerStart:x,innerEnd:E}=JE(t,d,u,b-y),I=u-w,D=u-S,R=y+w/I,z=b-S/D,$=d+x,K=d+E,_t=y+x/$,Ut=b-E/K;if(n.beginPath(),r){const J=(R+z)/2;if(n.arc(o,a,u,R,J),n.arc(o,a,u,J,z),S>0){const Ct=Rn(D,z,o,a);n.arc(Ct.x,Ct.y,S,z,b+lt)}const it=Rn(K,b,o,a);if(n.lineTo(it.x,it.y),E>0){const Ct=Rn(K,Ut,o,a);n.arc(Ct.x,Ct.y,E,b+lt,Ut+Math.PI)}const dt=(b-E/d+(y+x/d))/2;if(n.arc(o,a,d,b-E/d,dt,!0),n.arc(o,a,d,dt,y+x/d,!0),x>0){const Ct=Rn($,_t,o,a);n.arc(Ct.x,Ct.y,x,_t+Math.PI,y-lt)}const Jt=Rn(I,y,o,a);if(n.lineTo(Jt.x,Jt.y),w>0){const Ct=Rn(I,R,o,a);n.arc(Ct.x,Ct.y,w,y-lt,R)}}else{n.moveTo(o,a);const J=Math.cos(R)*u+o,it=Math.sin(R)*u+a;n.lineTo(J,it);const dt=Math.cos(z)*u+o,Jt=Math.sin(z)*u+a;n.lineTo(dt,Jt)}n.closePath()}function ZE(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a}=t;let c=t.endAngle;if(r){Xr(n,t,e,i,c,s);for(let l=0;l<r;++l)n.fill();isNaN(a)||(c=o+(a%nt||nt))}return Xr(n,t,e,i,c,s),n.fill(),c}function tI(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a,options:c}=t,{borderWidth:l,borderJoinStyle:h}=c,u=c.borderAlign==="inner";if(!l)return;u?(n.lineWidth=l*2,n.lineJoin=h||"round"):(n.lineWidth=l,n.lineJoin=h||"bevel");let d=t.endAngle;if(r){Xr(n,t,e,i,d,s);for(let f=0;f<r;++f)n.stroke();isNaN(a)||(d=o+(a%nt||nt))}u&&QE(n,t,d),r||(Xr(n,t,e,i,d,s),n.stroke())}class vr extends ie{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.getProps(["x","y"],i),{angle:r,distance:o}=Rp(s,{x:t,y:e}),{startAngle:a,endAngle:c,innerRadius:l,outerRadius:h,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),d=this.options.spacing/2,g=F(u,c-a)>=nt||us(r,a,c),p=xe(o,l+d,h+d);return g&&p}getCenterPoint(t){const{x:e,y:i,startAngle:s,endAngle:r,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:c,spacing:l}=this.options,h=(s+r)/2,u=(o+a+l+c)/2;return{x:e+Math.cos(h)*u,y:i+Math.sin(h)*u}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,s=(e.offset||0)/4,r=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin=e.borderAlign==="inner"?.33:0,this.fullCircles=i>nt?Math.floor(i/nt):0,i===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const a=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(a)*s,Math.sin(a)*s);const c=1-Math.sin(Math.min(rt,i||0)),l=s*c;t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,ZE(t,this,l,r,o),tI(t,this,l,r,o),t.restore()}}A(vr,"id","arc"),A(vr,"defaults",{borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),A(vr,"defaultRoutes",{backgroundColor:"backgroundColor"});function mm(n,t,e=t){n.lineCap=F(e.borderCapStyle,t.borderCapStyle),n.setLineDash(F(e.borderDash,t.borderDash)),n.lineDashOffset=F(e.borderDashOffset,t.borderDashOffset),n.lineJoin=F(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=F(e.borderWidth,t.borderWidth),n.strokeStyle=F(e.borderColor,t.borderColor)}function eI(n,t,e){n.lineTo(e.x,e.y)}function nI(n){return n.stepped?T_:n.tension||n.cubicInterpolationMode==="monotone"?D_:eI}function ym(n,t,e={}){const i=n.length,{start:s=0,end:r=i-1}=e,{start:o,end:a}=t,c=Math.max(s,o),l=Math.min(r,a),h=s<o&&r<o||s>a&&r>a;return{count:i,start:c,loop:t.loop,ilen:l<c&&!h?i+l-c:l-c}}function iI(n,t,e,i){const{points:s,options:r}=t,{count:o,start:a,loop:c,ilen:l}=ym(s,e,i),h=nI(r);let{move:u=!0,reverse:d}=i||{},f,g,p;for(f=0;f<=l;++f)g=s[(a+(d?l-f:f))%o],!g.skip&&(u?(n.moveTo(g.x,g.y),u=!1):h(n,p,g,d,r.stepped),p=g);return c&&(g=s[(a+(d?l:0))%o],h(n,p,g,d,r.stepped)),!!c}function sI(n,t,e,i){const s=t.points,{count:r,start:o,ilen:a}=ym(s,e,i),{move:c=!0,reverse:l}=i||{};let h=0,u=0,d,f,g,p,m,y;const b=S=>(o+(l?a-S:S))%r,w=()=>{p!==m&&(n.lineTo(h,m),n.lineTo(h,p),n.lineTo(h,y))};for(c&&(f=s[b(0)],n.moveTo(f.x,f.y)),d=0;d<=a;++d){if(f=s[b(d)],f.skip)continue;const S=f.x,x=f.y,E=S|0;E===g?(x<p?p=x:x>m&&(m=x),h=(u*h+S)/++u):(w(),n.lineTo(S,x),g=E,u=0,p=m=x),y=x}w()}function nc(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?sI:iI}function rI(n){return n.stepped?rS:n.tension||n.cubicInterpolationMode==="monotone"?oS:en}function oI(n,t,e,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,e,i)&&s.closePath()),mm(n,t.options),n.stroke(s)}function aI(n,t,e,i){const{segments:s,options:r}=t,o=nc(t);for(const a of s)mm(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const cI=typeof Path2D=="function";function lI(n,t,e,i){cI&&!t.options.segment?oI(n,t,e,i):aI(n,t,e,i)}class Ae extends ie{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;X_(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=dS(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],r=this.points,o=im(this,{property:e,start:s,end:s});if(!o.length)return;const a=[],c=rI(i);let l,h;for(l=0,h=o.length;l<h;++l){const{start:u,end:d}=o[l],f=r[u],g=r[d];if(f===g){a.push(f);continue}const p=Math.abs((s-f[e])/(g[e]-f[e])),m=c(f,g,p,i.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,i){return nc(this)(t,this,e,i)}path(t,e,i){const s=this.segments,r=nc(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of s)o&=r(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,s){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),lI(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}A(Ae,"id","line"),A(Ae,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),A(Ae,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),A(Ae,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function Ju(n,t,e,i){const s=n.options,{[e]:r}=n.getProps([e],i);return Math.abs(t-r)<s.radius+s.hitRadius}class xr extends ie{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.options,{x:r,y:o}=this.getProps(["x","y"],i);return Math.pow(t-r,2)+Math.pow(e-o,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(t,e){return Ju(this,t,"x",e)}inYRange(t,e){return Ju(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){t=t||this.options||{};let e=t.radius||0;e=Math.max(e,e&&t.hoverRadius||0);const i=e&&t.borderWidth||0;return(e+i)*2}draw(t,e){const i=this.options;this.skip||i.radius<.1||!ds(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Za(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}A(xr,"id","point"),A(xr,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),A(xr,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function bm(n,t){const{x:e,y:i,base:s,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,c,l,h,u;return n.horizontal?(u=o/2,a=Math.min(e,s),c=Math.max(e,s),l=i-u,h=i+u):(u=r/2,a=e-u,c=e+u,l=Math.min(i,s),h=Math.max(i,s)),{left:a,top:l,right:c,bottom:h}}function Me(n,t,e,i){return n?0:vt(t,e,i)}function hI(n,t,e){const i=n.options.borderWidth,s=n.borderSkipped,r=Hp(i);return{t:Me(s.top,r.top,0,e),r:Me(s.right,r.right,0,t),b:Me(s.bottom,r.bottom,0,e),l:Me(s.left,r.left,0,t)}}function uI(n,t,e){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),s=n.options.borderRadius,r=dn(s),o=Math.min(t,e),a=n.borderSkipped,c=i||q(s);return{topLeft:Me(!c||a.top||a.left,r.topLeft,0,o),topRight:Me(!c||a.top||a.right,r.topRight,0,o),bottomLeft:Me(!c||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:Me(!c||a.bottom||a.right,r.bottomRight,0,o)}}function dI(n){const t=bm(n),e=t.right-t.left,i=t.bottom-t.top,s=hI(n,e/2,i/2),r=uI(n,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:r},inner:{x:t.left+s.l,y:t.top+s.t,w:e-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,r.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(s.b,s.r))}}}}function ca(n,t,e,i){const s=t===null,r=e===null,a=n&&!(s&&r)&&bm(n,i);return a&&(s||xe(t,a.left,a.right))&&(r||xe(e,a.top,a.bottom))}function fI(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function gI(n,t){n.rect(t.x,t.y,t.w,t.h)}function la(n,t,e={}){const i=n.x!==e.x?-t:0,s=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-i,o=(n.y+n.h!==e.y+e.h?t:0)-s;return{x:n.x+i,y:n.y+s,w:n.w+r,h:n.h+o,radius:n.radius}}class wr extends ie{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:s}}=this,{inner:r,outer:o}=dI(this),a=fI(o.radius)?fs:gI;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,la(o,e,r)),t.clip(),a(t,la(r,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,la(r,e)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,e,i){return ca(this,t,e,i)}inXRange(t,e){return ca(this,t,null,e)}inYRange(t,e){return ca(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:s,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+s)/2:e,y:r?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}A(wr,"id","bar"),A(wr,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),A(wr,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var pI=Object.freeze({__proto__:null,ArcElement:vr,LineElement:Ae,PointElement:xr,BarElement:wr});const ic=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Zu=ic.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function vm(n){return ic[n%ic.length]}function xm(n){return Zu[n%Zu.length]}function mI(n,t){return n.borderColor=vm(t),n.backgroundColor=xm(t),++t}function yI(n,t){return n.backgroundColor=n.data.map(()=>vm(t++)),t}function bI(n,t){return n.backgroundColor=n.data.map(()=>xm(t++)),t}function vI(n){let t=0;return(e,i)=>{const s=n.getDatasetMeta(i).controller;s instanceof ln?t=yI(e,t):s instanceof Ki?t=bI(e,t):s&&(t=mI(e,t))}}function td(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function xI(n){return n&&(n.borderColor||n.backgroundColor)}var wI={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:i},options:s}=n.config,{elements:r}=s;if(!e.forceOverride&&(td(i)||xI(s)||r&&td(r)))return;const o=vI(n);i.forEach(o)}};function _I(n,t,e,i,s){const r=s.samples||i;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let c=0;const l=t+e-1;let h=t,u,d,f,g,p;for(o[c++]=n[h],u=0;u<r-2;u++){let m=0,y=0,b;const w=Math.floor((u+1)*a)+1+t,S=Math.min(Math.floor((u+2)*a)+1,e)+t,x=S-w;for(b=w;b<S;b++)m+=n[b].x,y+=n[b].y;m/=x,y/=x;const E=Math.floor(u*a)+1+t,I=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:D,y:R}=n[h];for(f=g=-1,b=E;b<I;b++)g=.5*Math.abs((D-m)*(n[b].y-R)-(D-n[b].x)*(y-R)),g>f&&(f=g,d=n[b],p=b);o[c++]=d,h=p}return o[c++]=n[l],o}function SI(n,t,e,i){let s=0,r=0,o,a,c,l,h,u,d,f,g,p;const m=[],y=t+e-1,b=n[t].x,S=n[y].x-b;for(o=t;o<t+e;++o){a=n[o],c=(a.x-b)/S*i,l=a.y;const x=c|0;if(x===h)l<g?(g=l,u=o):l>p&&(p=l,d=o),s=(r*s+a.x)/++r;else{const E=o-1;if(!W(u)&&!W(d)){const I=Math.min(u,d),D=Math.max(u,d);I!==f&&I!==E&&m.push({...n[I],x:s}),D!==f&&D!==E&&m.push({...n[D],x:s})}o>0&&E!==f&&m.push(n[E]),m.push(a),h=x,r=0,g=p=l,u=d=f=o}}return m}function wm(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{value:t})}}function ed(n){n.data.datasets.forEach(t=>{wm(t)})}function EI(n,t){const e=t.length;let i=0,s;const{iScale:r}=n,{min:o,max:a,minDefined:c,maxDefined:l}=r.getUserBounds();return c&&(i=vt(we(t,r.axis,o).lo,0,e-1)),l?s=vt(we(t,r.axis,a).hi+1,i,e)-i:s=e-i,{start:i,count:s}}var II={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){ed(n);return}const i=n.width;n.data.datasets.forEach((s,r)=>{const{_data:o,indexAxis:a}=s,c=n.getDatasetMeta(r),l=o||s.data;if(Pi([a,n.options.indexAxis])==="y"||!c.controller.supportsDecimation)return;const h=n.scales[c.xAxisID];if(h.type!=="linear"&&h.type!=="time"||n.options.parsing)return;let{start:u,count:d}=EI(c,l);const f=e.threshold||4*i;if(d<=f){wm(s);return}W(o)&&(s._data=l,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(e.algorithm){case"lttb":g=_I(l,u,d,i,e);break;case"min-max":g=SI(l,u,d,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}s._decimated=g})},destroy(n){ed(n)}};function TI(n,t,e){const i=n.segments,s=n.points,r=t.points,o=[];for(const a of i){let{start:c,end:l}=a;l=Ml(c,l,s);const h=sc(e,s[c],s[l],a.loop);if(!t.segments){o.push({source:a,target:h,start:s[c],end:s[l]});continue}const u=im(t,h);for(const d of u){const f=sc(e,r[d.start],r[d.end],d.loop),g=nm(a,s,f);for(const p of g)o.push({source:p,target:d,start:{[e]:nd(h,f,"start",Math.max)},end:{[e]:nd(h,f,"end",Math.min)}})}}return o}function sc(n,t,e,i){if(i)return;let s=t[n],r=e[n];return n==="angle"&&(s=qt(s),r=qt(r)),{property:n,start:s,end:r}}function DI(n,t){const{x:e=null,y:i=null}=n||{},s=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Ml(o,a,s);const c=s[o],l=s[a];i!==null?(r.push({x:c.x,y:i}),r.push({x:l.x,y:i})):e!==null&&(r.push({x:e,y:c.y}),r.push({x:e,y:l.y}))}),r}function Ml(n,t,e){for(;t>n;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function nd(n,t,e,i){return n&&t?i(n[e],t[e]):n?n[e]:t?t[e]:0}function _m(n,t){let e=[],i=!1;return et(n)?(i=!0,e=n):e=DI(n,t),e.length?new Ae({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function id(n){return n&&n.fill!==!1}function CI(n,t,e){let s=n[t].fill;const r=[t];let o;if(!e)return s;for(;s!==!1&&r.indexOf(s)===-1;){if(!ct(s))return s;if(o=n[s],!o)return!1;if(o.visible)return s;r.push(s),s=o.fill}return!1}function kI(n,t,e){const i=PI(n);if(q(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return ct(s)&&Math.floor(s)===s?AI(i[0],t,s,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function AI(n,t,e,i){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function MI(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:q(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function OI(n,t,e){let i;return n==="start"?i=e:n==="end"?i=t.options.reverse?t.min:t.max:q(n)?i=n.value:i=t.getBaseValue(),i}function PI(n){const t=n.options,e=t.fill;let i=F(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function LI(n){const{scale:t,index:e,line:i}=n,s=[],r=i.segments,o=i.points,a=RI(t,e);a.push(_m({x:null,y:t.bottom},i));for(let c=0;c<r.length;c++){const l=r[c];for(let h=l.start;h<=l.end;h++)NI(s,o[h],a)}return new Ae({points:s,options:{}})}function RI(n,t){const e=[],i=n.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const r=i[s];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function NI(n,t,e){const i=[];for(let s=0;s<e.length;s++){const r=e[s],{first:o,last:a,point:c}=FI(r,t,"x");if(!(!c||o&&a)){if(o)i.unshift(c);else if(n.push(c),!a)break}}n.push(...i)}function FI(n,t,e){const i=n.interpolate(t,e);if(!i)return{};const s=i[e],r=n.segments,o=n.points;let a=!1,c=!1;for(let l=0;l<r.length;l++){const h=r[l],u=o[h.start][e],d=o[h.end][e];if(xe(s,u,d)){a=s===u,c=s===d;break}}return{first:a,last:c,point:i}}class Sm{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:s,y:r,radius:o}=this;return e=e||{start:0,end:nt},t.arc(s,r,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:s}=this,r=t.angle;return{x:e+Math.cos(r)*s,y:i+Math.sin(r)*s,angle:r}}}function VI(n){const{chart:t,fill:e,line:i}=n;if(ct(e))return BI(t,e);if(e==="stack")return LI(n);if(e==="shape")return!0;const s=zI(n);return s instanceof Sm?s:_m(s,i)}function BI(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function zI(n){return(n.scale||{}).getPointPositionForValue?UI(n):$I(n)}function $I(n){const{scale:t={},fill:e}=n,i=MI(e,t);if(ct(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function UI(n){const{scale:t,fill:e}=n,i=t.options,s=t.getLabels().length,r=i.reverse?t.max:t.min,o=OI(e,t,r),a=[];if(i.grid.circular){const c=t.getPointPositionForValue(0,r);return new Sm({x:c.x,y:c.y,radius:t.getDistanceFromCenterForValue(o)})}for(let c=0;c<s;++c)a.push(t.getPointPositionForValue(c,o));return a}function ha(n,t,e){const i=VI(t),{line:s,scale:r,axis:o}=t,a=s.options,c=a.fill,l=a.backgroundColor,{above:h=l,below:u=l}=c||{};i&&s.points.length&&(Lo(n,e),jI(n,{line:s,target:i,above:h,below:u,area:e,scale:r,axis:o}),Ro(n))}function jI(n,t){const{line:e,target:i,above:s,below:r,area:o,scale:a}=t,c=e._loop?"angle":t.axis;n.save(),c==="x"&&r!==s&&(sd(n,i,o.top),rd(n,{line:e,target:i,color:s,scale:a,property:c}),n.restore(),n.save(),sd(n,i,o.bottom)),rd(n,{line:e,target:i,color:r,scale:a,property:c}),n.restore()}function sd(n,t,e){const{segments:i,points:s}=t;let r=!0,o=!1;n.beginPath();for(const a of i){const{start:c,end:l}=a,h=s[c],u=s[Ml(c,l,s)];r?(n.moveTo(h.x,h.y),r=!1):(n.lineTo(h.x,e),n.lineTo(h.x,h.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function rd(n,t){const{line:e,target:i,property:s,color:r,scale:o}=t,a=TI(e,i,s);for(const{source:c,target:l,start:h,end:u}of a){const{style:{backgroundColor:d=r}={}}=c,f=i!==!0;n.save(),n.fillStyle=d,qI(n,o,f&&sc(s,h,u)),n.beginPath();const g=!!e.pathSegment(n,c);let p;if(f){g?n.closePath():od(n,i,u,s);const m=!!i.pathSegment(n,l,{move:g,reverse:!0});p=g&&m,p||od(n,i,h,s)}n.closePath(),n.fill(p?"evenodd":"nonzero"),n.restore()}}function qI(n,t,e){const{top:i,bottom:s}=t.chart.chartArea,{property:r,start:o,end:a}=e||{};r==="x"&&(n.beginPath(),n.rect(o,i,a-o,s-i),n.clip())}function od(n,t,e,i){const s=t.interpolate(e,i);s&&n.lineTo(s.x,s.y)}var HI={id:"filler",afterDatasetsUpdate(n,t,e){const i=(n.data.datasets||[]).length,s=[];let r,o,a,c;for(o=0;o<i;++o)r=n.getDatasetMeta(o),a=r.dataset,c=null,a&&a.options&&a instanceof Ae&&(c={visible:n.isDatasetVisible(o),index:o,fill:kI(a,o,i),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=c,s.push(c);for(o=0;o<i;++o)c=s[o],!(!c||c.fill===!1)&&(c.fill=CI(s,o,e.propagate))},beforeDraw(n,t,e){const i=e.drawTime==="beforeDraw",s=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=s.length-1;o>=0;--o){const a=s[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),i&&a.fill&&ha(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const r=i[s].$filler;id(r)&&ha(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const i=t.meta.$filler;!id(i)||e.drawTime!=="beforeDatasetDraw"||ha(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const ad=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},WI=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class cd extends ie{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=tt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=mt(i.font),r=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:c}=ad(i,r);let l,h;e.font=s.string,this.isHorizontal()?(l=this.maxWidth,h=this._fitRows(o,r,a,c)+10):(h=this.maxHeight,l=this._fitCols(o,s,a,c)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],l=this.lineWidths=[0],h=s+a;let u=t;r.textAlign="left",r.textBaseline="middle";let d=-1,f=-h;return this.legendItems.forEach((g,p)=>{const m=i+e/2+r.measureText(g.text).width;(p===0||l[l.length-1]+m+2*a>o)&&(u+=h,l[l.length-(p>0?0:1)]=0,f+=h,d++),c[p]={left:0,top:f,row:d,width:m,height:s},l[l.length-1]+=m+a}),u}_fitCols(t,e,i,s){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,c=this.legendHitBoxes=[],l=this.columnSizes=[],h=o-t;let u=a,d=0,f=0,g=0,p=0;return this.legendItems.forEach((m,y)=>{const{itemWidth:b,itemHeight:w}=KI(i,e,r,m,s);y>0&&f+w+2*a>h&&(u+=d+a,l.push({width:d,height:f}),g+=d+a,p++,d=f=0),c[y]={left:g,top:f,col:p,width:b,height:w},d=Math.max(d,b),f+=w+a}),u+=d,l.push({width:d,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:r}}=this,o=jn(r,this.left,this.width);if(this.isHorizontal()){let a=0,c=kt(i,this.left+s,this.right-this.lineWidths[a]);for(const l of e)a!==l.row&&(a=l.row,c=kt(i,this.left+s,this.right-this.lineWidths[a])),l.top+=this.top+t+s,l.left=o.leftForLtr(o.x(c),l.width),c+=l.width+s}else{let a=0,c=kt(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const l of e)l.col!==a&&(a=l.col,c=kt(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),l.top=c,l.left+=this.left+s,l.left=o.leftForLtr(o.x(l.left),l.width),c+=l.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Lo(t,this),this._draw(),Ro(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:r,labels:o}=t,a=ft.color,c=jn(t.rtl,this.left,this.width),l=mt(o.font),{padding:h}=o,u=l.size,d=u/2;let f;this.drawTitle(),s.textAlign=c.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=l.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=ad(o,u),y=function(E,I,D){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const R=F(D.lineWidth,1);if(s.fillStyle=F(D.fillStyle,a),s.lineCap=F(D.lineCap,"butt"),s.lineDashOffset=F(D.lineDashOffset,0),s.lineJoin=F(D.lineJoin,"miter"),s.lineWidth=R,s.strokeStyle=F(D.strokeStyle,a),s.setLineDash(F(D.lineDash,[])),o.usePointStyle){const z={radius:p*Math.SQRT2/2,pointStyle:D.pointStyle,rotation:D.rotation,borderWidth:R},$=c.xPlus(E,g/2),K=I+d;qp(s,z,$,K,o.pointStyleWidth&&g)}else{const z=I+Math.max((u-p)/2,0),$=c.leftForLtr(E,g),K=dn(D.borderRadius);s.beginPath(),Object.values(K).some(_t=>_t!==0)?fs(s,{x:$,y:z,w:g,h:p,radius:K}):s.rect($,z,g,p),s.fill(),R!==0&&s.stroke()}s.restore()},b=function(E,I,D){En(s,D.text,E,I+m/2,l,{strikethrough:D.hidden,textAlign:c.textAlign(D.textAlign)})},w=this.isHorizontal(),S=this._computeTitleHeight();w?f={x:kt(r,this.left+h,this.right-i[0]),y:this.top+h+S,line:0}:f={x:this.left+h,y:kt(r,this.top+S+h,this.bottom-e[0].height),line:0},Zp(this.ctx,t.textDirection);const x=m+h;this.legendItems.forEach((E,I)=>{s.strokeStyle=E.fontColor,s.fillStyle=E.fontColor;const D=s.measureText(E.text).width,R=c.textAlign(E.textAlign||(E.textAlign=o.textAlign)),z=g+d+D;let $=f.x,K=f.y;c.setWidth(this.width),w?I>0&&$+z+h>this.right&&(K=f.y+=x,f.line++,$=f.x=kt(r,this.left+h,this.right-i[f.line])):I>0&&K+x>this.bottom&&($=f.x=$+e[f.line].width+h,f.line++,K=f.y=kt(r,this.top+S+h,this.bottom-e[f.line].height));const _t=c.x($);if(y(_t,K,E),$=p_(R,$+g+d,w?$+z:this.right,t.rtl),b(c.x($),K,E),w)f.x+=z+h;else if(typeof E.text!="string"){const Ut=l.lineHeight;f.y+=Em(E,Ut)}else f.y+=x}),tm(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=mt(e.font),s=Pt(e.padding);if(!e.display)return;const r=jn(t.rtl,this.left,this.width),o=this.ctx,a=e.position,c=i.size/2,l=s.top+c;let h,u=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),h=this.top+l,u=kt(t.align,u,this.right-d);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);h=l+kt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=kt(a,u,u+d);o.textAlign=r.textAlign(El(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,En(o,e.text,f,h,i)}_computeTitleHeight(){const t=this.options.title,e=mt(t.font),i=Pt(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,r;if(xe(t,this.left,this.right)&&xe(e,this.top,this.bottom)){for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(s=r[i],xe(t,s.left,s.left+s.width)&&xe(e,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!QI(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,r=WI(s,i);s&&!r&&tt(e.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!r&&tt(e.onHover,[t,i,this],this)}else i&&tt(e.onClick,[t,i,this],this)}}function KI(n,t,e,i,s){const r=GI(i,n,t,e),o=YI(s,i,t.lineHeight);return{itemWidth:r,itemHeight:o}}function GI(n,t,e,i){let s=n.text;return s&&typeof s!="string"&&(s=s.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+i.measureText(s).width}function YI(n,t,e){let i=n;return typeof t.text!="string"&&(i=Em(t,e)),i}function Em(n,t){const e=n.text?n.text.length+.5:0;return t*e}function QI(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var XI={id:"legend",_element:cd,start(n,t,e){const i=n.legend=new cd({ctx:n.ctx,options:e,chart:n});At.configure(n,i,e),At.addBox(n,i)},stop(n){At.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;At.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,s=e.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(c=>{const l=c.controller.getStyle(e?0:void 0),h=Pt(l.borderWidth);return{text:t[c.index].label,fillStyle:l.backgroundColor,fontColor:r,hidden:!c.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:s||l.textAlign,borderRadius:o&&(a||l.borderRadius),datasetIndex:c.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Ol extends ie{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const s=et(i.text)?i.text.length:1;this._padding=Pt(i.padding);const r=s*mt(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:s,right:r,options:o}=this,a=o.align;let c=0,l,h,u;return this.isHorizontal()?(h=kt(a,i,r),u=e+t,l=r-i):(o.position==="left"?(h=i+t,u=kt(a,s,e),c=rt*-.5):(h=r-t,u=kt(a,e,s),c=rt*.5),l=s-e),{titleX:h,titleY:u,maxWidth:l,rotation:c}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=mt(e.font),r=i.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:c,rotation:l}=this._drawArgs(r);En(t,e.text,0,0,i,{color:e.color,maxWidth:c,rotation:l,textAlign:El(e.align),textBaseline:"middle",translation:[o,a]})}}function JI(n,t){const e=new Ol({ctx:n.ctx,options:t,chart:n});At.configure(n,e,t),At.addBox(n,e),n.titleBlock=e}var ZI={id:"title",_element:Ol,start(n,t,e){JI(n,e)},stop(n){const t=n.titleBlock;At.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;At.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ir=new WeakMap;var tT={id:"subtitle",start(n,t,e){const i=new Ol({ctx:n.ctx,options:e,chart:n});At.configure(n,i,e),At.addBox(n,i),ir.set(n,i)},stop(n){At.removeBox(n,ir.get(n)),ir.delete(n)},beforeUpdate(n,t,e){const i=ir.get(n);At.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ri={average(n){if(!n.length)return!1;let t,e,i=0,s=0,r=0;for(t=0,e=n.length;t<e;++t){const o=n[t].element;if(o&&o.hasValue()){const a=o.tooltipPosition();i+=a.x,s+=a.y,++r}}return{x:i/r,y:s/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,s=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const c=n[r].element;if(c&&c.hasValue()){const l=c.getCenterPoint(),h=Xa(t,l);h<s&&(s=h,a=c)}}if(a){const c=a.tooltipPosition();e=c.x,i=c.y}return{x:e,y:i}}};function se(n,t){return t&&(et(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function ge(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function eT(n,t){const{element:e,datasetIndex:i,index:s}=t,r=n.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(s);return{chart:n,label:o,parsed:r.getParsed(s),raw:n.data.datasets[i].data[s],formattedValue:a,dataset:r.getDataset(),dataIndex:s,datasetIndex:i,element:e}}function ld(n,t){const e=n.chart.ctx,{body:i,footer:s,title:r}=n,{boxWidth:o,boxHeight:a}=t,c=mt(t.bodyFont),l=mt(t.titleFont),h=mt(t.footerFont),u=r.length,d=s.length,f=i.length,g=Pt(t.padding);let p=g.height,m=0,y=i.reduce((S,x)=>S+x.before.length+x.lines.length+x.after.length,0);if(y+=n.beforeBody.length+n.afterBody.length,u&&(p+=u*l.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),y){const S=t.displayColors?Math.max(a,c.lineHeight):c.lineHeight;p+=f*S+(y-f)*c.lineHeight+(y-1)*t.bodySpacing}d&&(p+=t.footerMarginTop+d*h.lineHeight+(d-1)*t.footerSpacing);let b=0;const w=function(S){m=Math.max(m,e.measureText(S).width+b)};return e.save(),e.font=l.string,Q(n.title,w),e.font=c.string,Q(n.beforeBody.concat(n.afterBody),w),b=t.displayColors?o+2+t.boxPadding:0,Q(i,S=>{Q(S.before,w),Q(S.lines,w),Q(S.after,w)}),b=0,e.font=h.string,Q(n.footer,w),e.restore(),m+=g.width,{width:m,height:p}}function nT(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function iT(n,t,e,i){const{x:s,width:r}=i,o=e.caretSize+e.caretPadding;if(n==="left"&&s+r+o>t.width||n==="right"&&s-r-o<0)return!0}function sT(n,t,e,i){const{x:s,width:r}=e,{width:o,chartArea:{left:a,right:c}}=n;let l="center";return i==="center"?l=s<=(a+c)/2?"left":"right":s<=r/2?l="left":s>=o-r/2&&(l="right"),iT(l,n,t,e)&&(l="center"),l}function hd(n,t,e){const i=e.yAlign||t.yAlign||nT(n,e);return{xAlign:e.xAlign||t.xAlign||sT(n,t,e,i),yAlign:i}}function rT(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function oT(n,t,e){let{y:i,height:s}=n;return t==="top"?i+=e:t==="bottom"?i-=s+e:i-=s/2,i}function ud(n,t,e,i){const{caretSize:s,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:c}=e,l=s+r,{topLeft:h,topRight:u,bottomLeft:d,bottomRight:f}=dn(o);let g=rT(t,a);const p=oT(t,c,l);return c==="center"?a==="left"?g+=l:a==="right"&&(g-=l):a==="left"?g-=Math.max(h,d)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:vt(g,0,i.width-t.width),y:vt(p,0,i.height-t.height)}}function sr(n,t,e){const i=Pt(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function dd(n){return se([],ge(n))}function aT(n,t,e){return We(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function fd(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const Im={beforeTitle:de,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:de,beforeBody:de,beforeLabel:de,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return W(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:de,afterBody:de,beforeFooter:de,footer:de,afterFooter:de};function Vt(n,t,e,i){const s=n[t].call(e,i);return typeof s>"u"?Im[t].call(e,i):s}class rc extends ie{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,r=new sm(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=aT(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,s=Vt(i,"beforeTitle",this,t),r=Vt(i,"title",this,t),o=Vt(i,"afterTitle",this,t);let a=[];return a=se(a,ge(s)),a=se(a,ge(r)),a=se(a,ge(o)),a}getBeforeBody(t,e){return dd(Vt(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,s=[];return Q(t,r=>{const o={before:[],lines:[],after:[]},a=fd(i,r);se(o.before,ge(Vt(a,"beforeLabel",this,r))),se(o.lines,Vt(a,"label",this,r)),se(o.after,ge(Vt(a,"afterLabel",this,r))),s.push(o)}),s}getAfterBody(t,e){return dd(Vt(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,s=Vt(i,"beforeFooter",this,t),r=Vt(i,"footer",this,t),o=Vt(i,"afterFooter",this,t);let a=[];return a=se(a,ge(s)),a=se(a,ge(r)),a=se(a,ge(o)),a}_createItems(t){const e=this._active,i=this.chart.data,s=[],r=[],o=[];let a=[],c,l;for(c=0,l=e.length;c<l;++c)a.push(eT(this.chart,e[c]));return t.filter&&(a=a.filter((h,u,d)=>t.filter(h,u,d,i))),t.itemSort&&(a=a.sort((h,u)=>t.itemSort(h,u,i))),Q(a,h=>{const u=fd(t.callbacks,h);s.push(Vt(u,"labelColor",this,h)),r.push(Vt(u,"labelPointStyle",this,h)),o.push(Vt(u,"labelTextColor",this,h))}),this.labelColors=s,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let r,o=[];if(!s.length)this.opacity!==0&&(r={opacity:0});else{const a=Ri[i.position].call(this,s,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const c=this._size=ld(this,i),l=Object.assign({},a,c),h=hd(this.chart,i,l),u=ud(i,l,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,r={opacity:1,x:u.x,y:u.y,width:c.width,height:c.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const r=this.getCaretPosition(t,i,s);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:r}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:c,topRight:l,bottomLeft:h,bottomRight:u}=dn(a),{x:d,y:f}=t,{width:g,height:p}=e;let m,y,b,w,S,x;return r==="center"?(S=f+p/2,s==="left"?(m=d,y=m-o,w=S+o,x=S-o):(m=d+g,y=m+o,w=S-o,x=S+o),b=m):(s==="left"?y=d+Math.max(c,h)+o:s==="right"?y=d+g-Math.max(l,u)-o:y=this.caretX,r==="top"?(w=f,S=w-o,m=y-o,b=y+o):(w=f+p,S=w+o,m=y+o,b=y-o),x=w),{x1:m,x2:y,x3:b,y1:w,y2:S,y3:x}}drawTitle(t,e,i){const s=this.title,r=s.length;let o,a,c;if(r){const l=jn(i.rtl,this.x,this.width);for(t.x=sr(this,i.titleAlign,i),e.textAlign=l.textAlign(i.titleAlign),e.textBaseline="middle",o=mt(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,c=0;c<r;++c)e.fillText(s[c],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,c+1===r&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,s,r){const o=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:c,boxWidth:l,boxPadding:h}=r,u=mt(r.bodyFont),d=sr(this,"left",r),f=s.x(d),g=c<u.lineHeight?(u.lineHeight-c)/2:0,p=e.y+g;if(r.usePointStyle){const m={radius:Math.min(l,c)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},y=s.leftForLtr(f,l)+l/2,b=p+c/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Za(t,m,y,b),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Za(t,m,y,b)}else{t.lineWidth=q(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const m=s.leftForLtr(f,l-h),y=s.leftForLtr(s.xPlus(f,1),l-h-2),b=dn(o.borderRadius);Object.values(b).some(w=>w!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,fs(t,{x:m,y:p,w:l,h:c,radius:b}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),fs(t,{x:y,y:p+1,w:l-2,h:c-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(m,p,l,c),t.strokeRect(m,p,l,c),t.fillStyle=o.backgroundColor,t.fillRect(y,p+1,l-2,c-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:c,boxWidth:l,boxPadding:h}=i,u=mt(i.bodyFont);let d=u.lineHeight,f=0;const g=jn(i.rtl,this.x,this.width),p=function(D){e.fillText(D,g.x(t.x+f),t.y+d/2),t.y+=d+r},m=g.textAlign(o);let y,b,w,S,x,E,I;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=sr(this,m,i),e.fillStyle=i.bodyColor,Q(this.beforeBody,p),f=a&&m!=="right"?o==="center"?l/2+h:l+2+h:0,S=0,E=s.length;S<E;++S){for(y=s[S],b=this.labelTextColors[S],e.fillStyle=b,Q(y.before,p),w=y.lines,a&&w.length&&(this._drawColorBox(e,t,S,g,i),d=Math.max(u.lineHeight,c)),x=0,I=w.length;x<I;++x)p(w[x]),d=u.lineHeight;Q(y.after,p)}f=0,d=u.lineHeight,Q(this.afterBody,p),t.y-=r}drawFooter(t,e,i){const s=this.footer,r=s.length;let o,a;if(r){const c=jn(i.rtl,this.x,this.width);for(t.x=sr(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=c.textAlign(i.footerAlign),e.textBaseline="middle",o=mt(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(s[a],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:r,yAlign:o}=this,{x:a,y:c}=t,{width:l,height:h}=i,{topLeft:u,topRight:d,bottomLeft:f,bottomRight:g}=dn(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(a+u,c),o==="top"&&this.drawCaret(t,e,i,s),e.lineTo(a+l-d,c),e.quadraticCurveTo(a+l,c,a+l,c+d),o==="center"&&r==="right"&&this.drawCaret(t,e,i,s),e.lineTo(a+l,c+h-g),e.quadraticCurveTo(a+l,c+h,a+l-g,c+h),o==="bottom"&&this.drawCaret(t,e,i,s),e.lineTo(a+f,c+h),e.quadraticCurveTo(a,c+h,a,c+h-f),o==="center"&&r==="left"&&this.drawCaret(t,e,i,s),e.lineTo(a,c+u),e.quadraticCurveTo(a,c,a+u,c),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,r=i&&i.y;if(s||r){const o=Ri[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=ld(this,t),c=Object.assign({},o,this._size),l=hd(e,t,c),h=ud(t,c,l,e);(s._to!==h.x||r._to!==h.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=Pt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,s,e),Zp(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),tm(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map(({datasetIndex:a,index:c})=>{const l=this.chart.getDatasetMeta(a);if(!l)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:l.data[c],index:c}}),r=!qr(i,s),o=this._positionChanged(s,e);(r||o)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,i),a=this._positionChanged(o,t),c=e||!qr(o,r)||a;return c&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),c}_getActiveElements(t,e,i,s){const r=this.options;if(t.type==="mouseout")return[];if(!s)return e;const o=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:s,options:r}=this,o=Ri[r.position].call(this,t,e);return o!==!1&&(i!==o.x||s!==o.y)}}A(rc,"positioners",Ri);var cT={id:"tooltip",_element:rc,positioners:Ri,afterInit(n,t,e){e&&(n.tooltip=new rc({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Im},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},lT=Object.freeze({__proto__:null,Colors:wI,Decimation:II,Filler:HI,Legend:XI,SubTitle:tT,Title:ZI,Tooltip:cT});const hT=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function uT(n,t,e,i){const s=n.indexOf(t);if(s===-1)return hT(n,t,e,i);const r=n.lastIndexOf(t);return s!==r?e:s}const dT=(n,t)=>n===null?null:vt(Math.round(n),0,t);function gd(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class oc extends kn{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:s,label:r}of e)i[s]===r&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(W(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:uT(i,t,F(e,t),this._addedLabels),dT(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let o=t;o<=e;o++)s.push({value:o});return s}getLabelForValue(t){return gd.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}A(oc,"id","category"),A(oc,"defaults",{ticks:{callback:gd}});function fT(n,t){const e=[],{bounds:s,step:r,min:o,max:a,precision:c,count:l,maxTicks:h,maxDigits:u,includeBounds:d}=n,f=r||1,g=h-1,{min:p,max:m}=t,y=!W(o),b=!W(a),w=!W(l),S=(m-p)/(u+1);let x=uu((m-p)/g/f)*f,E,I,D,R;if(x<1e-14&&!y&&!b)return[{value:p},{value:m}];R=Math.ceil(m/x)-Math.floor(p/x),R>g&&(x=uu(R*x/g/f)*f),W(c)||(E=Math.pow(10,c),x=Math.ceil(x*E)/E),s==="ticks"?(I=Math.floor(p/x)*x,D=Math.ceil(m/x)*x):(I=p,D=m),y&&b&&r&&c_((a-o)/r,x/1e3)?(R=Math.round(Math.min((a-o)/x,h)),x=(a-o)/R,I=o,D=a):w?(I=y?o:I,D=b?a:D,R=l-1,x=(D-I)/R):(R=(D-I)/x,qi(R,Math.round(R),x/1e3)?R=Math.round(R):R=Math.ceil(R));const z=Math.max(du(x),du(I));E=Math.pow(10,W(c)?z:c),I=Math.round(I*E)/E,D=Math.round(D*E)/E;let $=0;for(y&&(d&&I!==o?(e.push({value:o}),I<o&&$++,qi(Math.round((I+$*x)*E)/E,o,pd(o,S,n))&&$++):I<o&&$++);$<R;++$)e.push({value:Math.round((I+$*x)*E)/E});return b&&d&&D!==a?e.length&&qi(e[e.length-1].value,a,pd(a,S,n))?e[e.length-1].value=a:e.push({value:a}):(!b||D===a)&&e.push({value:D}),e}function pd(n,t,{horizontal:e,minRotation:i}){const s=te(i),r=(e?Math.sin(s):Math.cos(s))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class Jr extends kn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return W(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:r}=this;const o=c=>s=e?s:c,a=c=>r=i?r:c;if(t){const c=he(s),l=he(r);c<0&&l<0?a(0):c>0&&l>0&&o(0)}if(s===r){let c=r===0?1:Math.abs(r*.05);a(r+c),t||o(s-c)}this.min=s,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),e=e||11),e&&(s=Math.min(e,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=fT(s,r);return t.bounds==="ticks"&&Lp(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return Rs(t,this.chart.options.locale,this.options.ticks.format)}}class ac extends Jr{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=ct(t)?t:0,this.max=ct(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=te(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}A(ac,"id","linear"),A(ac,"defaults",{ticks:{callback:Po.formatters.numeric}});const ps=n=>Math.floor(ke(n)),Xe=(n,t)=>Math.pow(10,ps(n)+t);function md(n){return n/Math.pow(10,ps(n))===1}function yd(n,t,e){const i=Math.pow(10,e),s=Math.floor(n/i);return Math.ceil(t/i)-s}function gT(n,t){const e=t-n;let i=ps(e);for(;yd(n,t,i)>10;)i++;for(;yd(n,t,i)<10;)i--;return Math.min(i,ps(n))}function pT(n,{min:t,max:e}){t=jt(n.min,t);const i=[],s=ps(t);let r=gT(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),c=s>r?Math.pow(10,s):0,l=Math.round((t-c)*o)/o,h=Math.floor((t-c)/a/10)*a*10;let u=Math.floor((l-h)/Math.pow(10,r)),d=jt(n.min,Math.round((c+h+u*Math.pow(10,r))*o)/o);for(;d<e;)i.push({value:d,major:md(d),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),d=Math.round((c+h+u*Math.pow(10,r))*o)/o;const f=jt(n.max,d);return i.push({value:f,major:md(f),significand:u}),i}class cc extends kn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=Jr.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return ct(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=ct(t)?Math.max(0,t):null,this.max=ct(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ct(this._userMin)&&(this.min=t===Xe(this.min,0)?Xe(this.min,-1):Xe(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,s=this.max;const r=a=>i=t?i:a,o=a=>s=e?s:a;i===s&&(i<=0?(r(1),o(10)):(r(Xe(i,-1)),o(Xe(s,1)))),i<=0&&r(Xe(s,-1)),s<=0&&o(Xe(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=pT(e,this);return t.bounds==="ticks"&&Lp(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Rs(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=ke(t),this._valueRange=ke(this.max)-ke(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(ke(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}A(cc,"id","logarithmic"),A(cc,"defaults",{ticks:{callback:Po.formatters.logarithmic,major:{enabled:!0}}});function lc(n){const t=n.ticks;if(t.display&&n.display){const e=Pt(t.backdropPadding);return F(t.font&&t.font.size,ft.font.size)+e.height}return 0}function mT(n,t,e){return e=et(e)?e:[e],{w:I_(n,t.string,e),h:e.length*t.lineHeight}}function bd(n,t,e,i,s){return n===i||n===s?{start:t-e/2,end:t+e/2}:n<i||n>s?{start:t-e,end:t}:{start:t,end:t+e}}function yT(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),i=[],s=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?rt/r:0;for(let c=0;c<r;c++){const l=o.setContext(n.getPointLabelContext(c));s[c]=l.padding;const h=n.getPointPosition(c,n.drawingArea+s[c],a),u=mt(l.font),d=mT(n.ctx,u,n._pointLabels[c]);i[c]=d;const f=qt(n.getIndexAngle(c)+a),g=Math.round(_l(f)),p=bd(g,h.x,d.w,0,180),m=bd(g,h.y,d.h,90,270);bT(e,t,f,p,m)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=vT(n,i,s)}function bT(n,t,e,i,s){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,c=0;i.start<t.l?(a=(t.l-i.start)/r,n.l=Math.min(n.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),s.start<t.t?(c=(t.t-s.start)/o,n.t=Math.min(n.t,t.t-c)):s.end>t.b&&(c=(s.end-t.b)/o,n.b=Math.max(n.b,t.b+c))}function vT(n,t,e){const i=[],s=n._pointLabels.length,r=n.options,o=lc(r)/2,a=n.drawingArea,c=r.pointLabels.centerPointLabels?rt/s:0;for(let l=0;l<s;l++){const h=n.getPointPosition(l,a+o+e[l],c),u=Math.round(_l(qt(h.angle+lt))),d=t[l],f=_T(h.y,d.h,u),g=xT(u),p=wT(h.x,d.w,g);i.push({x:h.x,y:f,textAlign:g,left:p,top:f,right:p+d.w,bottom:f+d.h})}return i}function xT(n){return n===0||n===180?"center":n<180?"left":"right"}function wT(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function _T(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function ST(n,t){const{ctx:e,options:{pointLabels:i}}=n;for(let s=t-1;s>=0;s--){const r=i.setContext(n.getPointLabelContext(s)),o=mt(r.font),{x:a,y:c,textAlign:l,left:h,top:u,right:d,bottom:f}=n._pointLabelItems[s],{backdropColor:g}=r;if(!W(g)){const p=dn(r.borderRadius),m=Pt(r.backdropPadding);e.fillStyle=g;const y=h-m.left,b=u-m.top,w=d-h+m.width,S=f-u+m.height;Object.values(p).some(x=>x!==0)?(e.beginPath(),fs(e,{x:y,y:b,w,h:S,radius:p}),e.fill()):e.fillRect(y,b,w,S)}En(e,n._pointLabels[s],a,c+o.lineHeight/2,o,{color:r.color,textAlign:l,textBaseline:"middle"})}}function Tm(n,t,e,i){const{ctx:s}=n;if(e)s.arc(n.xCenter,n.yCenter,t,0,nt);else{let r=n.getPointPosition(0,t);s.moveTo(r.x,r.y);for(let o=1;o<i;o++)r=n.getPointPosition(o,t),s.lineTo(r.x,r.y)}}function ET(n,t,e,i,s){const r=n.ctx,o=t.circular,{color:a,lineWidth:c}=t;!o&&!i||!a||!c||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=c,r.setLineDash(s.dash),r.lineDashOffset=s.dashOffset,r.beginPath(),Tm(n,e,o,i),r.closePath(),r.stroke(),r.restore())}function IT(n,t,e){return We(n,{label:e,index:t,type:"pointLabel"})}class Ni extends Jr{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Pt(lc(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=ct(t)&&!isNaN(t)?t:0,this.max=ct(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/lc(this.options))}generateTickLabels(t){Jr.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const s=tt(this.options.pointLabels.callback,[e,i],this);return s||s===0?s:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?yT(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,s){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,s))}getIndexAngle(t){const e=nt/(this._pointLabels.length||1),i=this.options.startAngle||0;return qt(t*e+te(i))}getDistanceFromCenterForValue(t){if(W(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(W(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return IT(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const s=this.getIndexAngle(t)-lt+i;return{x:Math.cos(s)*e+this.xCenter,y:Math.sin(s)*e+this.yCenter,angle:s}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:s,bottom:r}=this._pointLabelItems[t];return{left:e,top:i,right:s,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Tm(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:s,border:r}=e,o=this._pointLabels.length;let a,c,l;if(e.pointLabels.display&&ST(this,o),s.display&&this.ticks.forEach((h,u)=>{if(u!==0){c=this.getDistanceFromCenterForValue(h.value);const d=this.getContext(u),f=s.setContext(d),g=r.setContext(d);ET(this,f,c,o,g)}}),i.display){for(t.save(),a=o-1;a>=0;a--){const h=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:d}=h;!d||!u||(t.lineWidth=d,t.strokeStyle=u,t.setLineDash(h.borderDash),t.lineDashOffset=h.borderDashOffset,c=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),l=this.getPointPosition(a,c),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,c)=>{if(c===0&&!e.reverse)return;const l=i.setContext(this.getContext(c)),h=mt(l.font);if(r=this.getDistanceFromCenterForValue(this.ticks[c].value),l.showLabelBackdrop){t.font=h.string,o=t.measureText(a.label).width,t.fillStyle=l.backdropColor;const u=Pt(l.backdropPadding);t.fillRect(-o/2-u.left,-r-h.size/2-u.top,o+u.width,h.size+u.height)}En(t,a.label,0,-r,h,{color:l.color})}),t.restore()}drawTitle(){}}A(Ni,"id","radialLinear"),A(Ni,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Po.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),A(Ni,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),A(Ni,"descriptors",{angleLines:{_fallback:"grid"}});const Fo={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},zt=Object.keys(Fo);function TT(n,t){return n-t}function vd(n,t){if(W(t))return null;const e=n._adapter,{parser:i,round:s,isoWeekday:r}=n._parseOpts;let o=t;return typeof i=="function"&&(o=i(o)),ct(o)||(o=typeof i=="string"?e.parse(o,i):e.parse(o)),o===null?null:(s&&(o=s==="week"&&(ni(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,s)),+o)}function xd(n,t,e,i){const s=zt.length;for(let r=zt.indexOf(n);r<s-1;++r){const o=Fo[zt[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=i)return zt[r]}return zt[s-1]}function DT(n,t,e,i,s){for(let r=zt.length-1;r>=zt.indexOf(e);r--){const o=zt[r];if(Fo[o].common&&n._adapter.diff(s,i,o)>=t-1)return o}return zt[e?zt.indexOf(e):0]}function CT(n){for(let t=zt.indexOf(n)+1,e=zt.length;t<e;++t)if(Fo[zt[t]].common)return zt[t]}function wd(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:s}=Sl(e,t),r=e[i]>=t?e[i]:e[s];n[r]=!0}}function kT(n,t,e,i){const s=n._adapter,r=+s.startOf(t[0].value,i),o=t[t.length-1].value;let a,c;for(a=r;a<=o;a=+s.add(a,1,i))c=e[a],c>=0&&(t[c].major=!0);return t}function _d(n,t,e){const i=[],s={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],s[a]=o,i.push({value:a,major:!1});return r===0||!e?i:kT(n,i,s,e)}class ms extends kn{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),s=this._adapter=new $S._date(t.adapters.date);s.init(e),ji(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:vd(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function c(l){!o&&!isNaN(l.min)&&(s=Math.min(s,l.min)),!a&&!isNaN(l.max)&&(r=Math.max(r,l.max))}(!o||!a)&&(c(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&c(this.getMinMax(!1))),s=ct(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),r=ct(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,r-1),this.max=Math.max(s+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const r=this.min,o=this.max,a=d_(s,r,o);return this._unit=e.unit||(i.autoSkip?xd(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):DT(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:CT(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),_d(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,s,r;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?e=1-s:e=(this.getDecimalForValue(t[1])-s)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?i=r:i=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=vt(e,0,o),i=vt(i,0,o),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,r=s.time,o=r.unit||xd(r.minUnit,e,i,this._getLabelCapacity(e)),a=F(s.ticks.stepSize,1),c=o==="week"?r.isoWeekday:!1,l=ni(c)||c===!0,h={};let u=e,d,f;if(l&&(u=+t.startOf(u,"isoWeek",c)),u=+t.startOf(u,l?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(d=u,f=0;d<i;d=+t.add(d,a,o),f++)wd(h,d,g);return(d===i||s.bounds==="ticks"||f===1)&&wd(h,d,g),Object.keys(h).sort((p,m)=>p-m).map(p=>+p)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const s=this.options.time.displayFormats,r=this._unit,o=e||s[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,i,s){const r=this.options,o=r.ticks.callback;if(o)return tt(o,[t,e,i],this);const a=r.time.displayFormats,c=this._unit,l=this._majorUnit,h=c&&a[c],u=l&&a[l],d=i[e],f=l&&u&&d&&d.major;return this._adapter.format(t,s||(f?u:h))}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=te(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*r+a*o,h:i*o+a*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,_d(this,[t],this._majorUnit),s),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(e=0,i=s.length;e<i;++e)t=t.concat(s[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(vd(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Fp(t.sort(TT))}}A(ms,"id","time"),A(ms,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function rr(n,t,e){let i=0,s=n.length-1,r,o,a,c;e?(t>=n[i].pos&&t<=n[s].pos&&({lo:i,hi:s}=we(n,"pos",t)),{pos:r,time:a}=n[i],{pos:o,time:c}=n[s]):(t>=n[i].time&&t<=n[s].time&&({lo:i,hi:s}=we(n,"time",t)),{time:r,pos:a}=n[i],{time:o,pos:c}=n[s]);const l=o-r;return l?a+(c-a)*(t-r)/l:a}class hc extends ms{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=rr(e,this.min),this._tableRange=rr(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],r=[];let o,a,c,l,h;for(o=0,a=t.length;o<a;++o)l=t[o],l>=e&&l<=i&&s.push(l);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=s.length;o<a;++o)h=s[o+1],c=s[o-1],l=s[o],Math.round((h+c)/2)!==l&&r.push({time:l,pos:o/(a-1)});return r}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(rr(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return rr(this._table,i*this._tableRange+this._minPos,!0)}}A(hc,"id","timeseries"),A(hc,"defaults",ms.defaults);var AT=Object.freeze({__proto__:null,CategoryScale:oc,LinearScale:ac,LogarithmicScale:cc,RadialLinearScale:Ni,TimeScale:ms,TimeSeriesScale:hc});const MT=[zS,pI,lT,AT];me.register(...MT);const OT={radius:{duration:400,easing:"linear",loop:n=>n.active}},PT={animations:OT,hoverRadius:8,hoverBackgroundColor:"yellow",interaction:{mode:"nearest",intersect:!1,axis:"x"},responsive:!0,maintainAspectRatio:!1,scales:{x:{}},plugins:{legend:{display:!1}}};class Pl extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get styles(){return`
      :host {
        --border-rect-color: #999;
        --fill-rect-color: #000;
      }

      .chart-card {
        width: 100%;
        max-width: 100%;
        overflow-x: scroll;
        position: relative;
      }

      canvas {
        min-height: 200px;
        max-height: 250px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        position: sticky;
        left: 0;
      }

      .legend {
        font-size: 0.9rem;
        font-weight: 500;
      }

      .rect {
        width: 35px;
        height: 10px;
        border: 2px solid var(--border-rect-color);
        background: var(--fill-rect-color);
      }
    `}setValues(t){const e=this.shadowRoot.querySelector(".rect");this.myChart.config.data.datasets[0].borderColor=t.borderColor,this.myChart.config.data.datasets[0].backgroundColor=t.color,e.style.setProperty("--border-rect-color",t.borderColor),e.style.setProperty("--fill-rect-color",t.color),this.myChart.update()}setData(t,e){const i=[],s=[],r={hour:"numeric",minute:"numeric"};t.forEach(l=>{const h=new Date(l.data().date.seconds*1e3);s.push(new Intl.DateTimeFormat("es-BO",r).format(h)),i.push(l.data().value)}),this.myChart.config.data.labels=s,this.myChart.config.data.datasets[0].data=i;const o=this.shadowRoot.querySelector(".legend");o.textContent=e;const a=this.shadowRoot.querySelector(".chart-box"),c=this.myChart.config.data.labels.length;if(c>30){const l=350+(c-30)*10;a.style.width=`${l}px`}this.myChart.update()}initChart(t){this.myChart=new me(this.shadowRoot.querySelector(".my-chart"),t)}init(){const t={type:"line",data:{labels:[],datasets:[{label:"",data:[],borderWidth:2,radius:2,tension:.1,fill:!0}]},options:PT};this.initChart(t)}connectedCallback(){this.render(),this.init()}render(){this.shadowRoot.innerHTML=`
    <style>${Pl.styles}</style>
    <div class="chart-card">
      <div class="header">
        <div class="rect"></div>
        <div class="legend"></div>
      </div>
      <div class="chart-box">
        <canvas class="my-chart"></canvas>
      </div>
    </div>
    `}}customElements.define("chart-line",Pl);const LT=n=>n.length!==0?{min:Math.min(...n),max:Math.max(...n)}:{min:0,max:0},RT=(n,t)=>{let e,i;if(t==="date"&&(e=new Date(`${n}T00:00:00`),i=new Date(`${n}T23:59:00`)),t==="week"){const s=+n.split("-W")[0],r=+n.split("-W")[1];e=new Date(s,0,(r-1)*7+2),i=new Date(s,0,(r-1)*7+8),i.setHours(23,59)}if(t==="month"){const s=new Date(n.replace("-",","));e=new Date(s.getFullYear(),s.getMonth(),1),i=new Date(s.getFullYear(),s.getMonth()+1,0),i.setHours(23,59)}return t==="year"&&(e=new Date(`${n}-01-01T00:00:00`),i=new Date(`${n}-12-31T23:59:00`)),{start:e,end:i}},Dm=document.querySelector(".container-cards"),ua=document.querySelector(".container-charts"),ys=document.querySelector("select-date");document.addEventListener("btn:range-date",n=>{const t=n.detail.message;ys.setType(t)});document.addEventListener("date:select-date",async()=>{const n=Dm.querySelectorAll("card-parameter"),t=RT(ys.getDate(),ys.getType());n.forEach(async e=>{const i=e.getAttribute("title"),s=await Cw(i,t.start,t.end),r=[];e.setData(s),s.forEach(o=>{r.push(parseFloat(o.data().value))}),e.setValues(LT(r))})});document.addEventListener("btn:add-parameter",n=>{console.log(n.detail.message)});document.addEventListener("card:card-parameter",async n=>{const t=n.detail.message,e=ys.getDate(),i=Dm.querySelector(`[title=${t[1]}`);if(e===""){i.disableCard(),ys.setAnimation();return}if(t[0]==="enable"){const s=document.createElement("chart-line");s.setAttribute("title",t[1]),ua.appendChild(s);const r=i.getData();s.setData(r,t[1]),s.setValues(i.getValues())}else{const s=ua.querySelector(`[title=${t[1]}`);ua.removeChild(s)}});
